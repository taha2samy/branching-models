<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
h1, h2, h3, h4, h5 { white-space: pre-wrap; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; border-color: transparent !important; padding-top: 0px !important; padding-bottom: 0px !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  #write > p:nth-child(1) { margin-top: 0px; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
  figure { overflow-x: visible; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; overflow-wrap: anywhere; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }
mjx-container { break-inside: avoid; }
.md-alert.md-alert-note { border-left-color: rgb(9, 105, 218); }
.md-alert.md-alert-important { border-left-color: rgb(130, 80, 223); }
.md-alert.md-alert-warning { border-left-color: rgb(154, 103, 0); }
.md-alert.md-alert-tip { border-left-color: rgb(31, 136, 61); }
.md-alert.md-alert-caution { border-left-color: rgb(207, 34, 46); }
.md-alert { padding: 0px 1em; margin-bottom: 16px; color: inherit; border-left: 0.25em solid rgb(0, 0, 0); }
.md-alert-text-note { color: rgb(9, 105, 218); }
.md-alert-text-important { color: rgb(130, 80, 223); }
.md-alert-text-warning { color: rgb(154, 103, 0); }
.md-alert-text-tip { color: rgb(31, 136, 61); }
.md-alert-text-caution { color: rgb(207, 34, 46); }
.md-alert-text { font-size: 0.9rem; font-weight: 700; }
.md-alert-text svg { fill: currentcolor; position: relative; top: 0.125em; margin-right: 1ch; overflow: visible; }
.md-alert-text-container::after { content: attr(data-text); text-transform: capitalize; pointer-events: none; margin-right: 1ch; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


/* Theme adapted from https://codemirror.net/theme/dracula.css */
/*
    Name:       dracula
    Author:     Michael Kaminsky (http://github.com/mkaminsky11)

    Original dracula color scheme by Zeno Rocha (https://github.com/zenorocha/dracula-theme)
*/

.cm-s-inner {
  padding: 0.5rem 0.2rem;
  border: 1px solid var(--accent-color) !important;
  border-radius: 0.25rem;
}

.cm-s-inner.CodeMirror, .cm-s-inner .CodeMirror-gutters {
  background-color: #282a36 !important;
  color: #f8f8f2 !important;
  border: none;
}

.cm-s-inner .CodeMirror-gutters {
  width: 5ch;
  color: #282a36;
}
.cm-s-inner .CodeMirror-cursor { border-left: solid thin #f8f8f2 !important; }
.cm-s-inner .CodeMirror-linenumber {
  width: 4ch !important;
  color: #6D8A88;
}

.cm-s-inner .CodeMirror-line::selection,
.cm-s-inner .CodeMirror-line > span::selection,
.cm-s-inner .CodeMirror-line > span > span::selection { background: rgba(255, 255, 255, 0.10); }
.cm-s-inner .CodeMirror-line::-moz-selection,
.cm-s-inner .CodeMirror-line > span::-moz-selection,
.cm-s-inner .CodeMirror-line > span > span::-moz-selection { background: rgba(255, 255, 255, 0.10); }
.cm-s-inner span.cm-comment { color: #6272a4; }
.cm-s-inner span.cm-string, .cm-s-inner span.cm-string-2 { color: #f1fa8c; }
.cm-s-inner span.cm-number { color: #bd93f9; }
.cm-s-inner span.cm-variable, .cm-s-inner span.cm-variable-2 { color: #50fa7b; }
.cm-s-inner span.cm-def { color: white; }
.cm-s-inner span.cm-operator { color: #ff79c6; }
.cm-s-inner span.cm-keyword { color: #ff79c6; }
.cm-s-inner span.cm-atom { color: #bd93f9; }
.cm-s-inner span.cm-meta { color: #f8f8f2; }
.cm-s-inner span.cm-tag { color: #ff79c6; }
.cm-s-inner span.cm-attribute { color: #50fa7b; }
.cm-s-inner span.cm-qualifier { color: #50fa7b; }
.cm-s-inner span.cm-property { color: #66d9ef; }
.cm-s-inner span.cm-builtin { color: #50fa7b; }
.cm-s-inner span.cm-variable-3, .cm-s-inner span.cm-type { color: #ffb86c; }

.cm-s-inner .CodeMirror-activeline-background { background: rgba(255,255,255,0.1); }
.cm-s-inner .CodeMirror-matchingbracket {
  text-decoration: underline;
  color: white !important;
}
.CodeMirror-selectedtext, .CodeMirror-selected {
  background: #313746 !important;
  text-shadow: none;
}
/* 
  Middle East - Night
  Typora RTL theme
  design: isapanah.com
  date: 2019
  version: 1.1
*/

@import url("file:////home/Taha/.config/Typora/themes/");

/*
  Vazir provided by Rastikerdar
  Downloaded from `https://github.com/rastikerdar/vazir-font`
*/
/*
	Cousine provided by Steve Matteson from Google Fonts
	Downloaded from `https://fonts.google.com/specimen/Cousine`
*/
/** ROOT VARIABLES **/

:root {
  --bg-color: #1e2022; /* change background */
  --text-color: #dddddd; /* change text color */
  --md-char-color: #5b5b5b; /* change color of mbeta characetrs like `*` in markdown */
  --meta-content-color: #757575; /* change color of meta contents like image text or link address in markdown */
  --link-color: #6bcafb; /* change color of hyperlinks */

  --primary-color: #428bca; /* primary color */
  --primary-btn-border-color: #285e8e; /* primary color for buttons */
  --primary-btn-text-color: #fff; /* primary text color for buttons */
  --accent-color: #3c3c3c; /* background accent color */

  --window-border: 1px solid #16161a; /* border for sidebar, etc*/

  --active-file-bg-color: #16161a; /* background color if list item in file tree or file list*/
  --active-file-text-color: inherit; /* text color for selected file */
  --active-file-border-color: #777; /* border color for selected file */
  --active-search-item-bg-color: #212121; /* background color for active search item */

  --side-bar-bg-color: #2b2b2b; /* change background of sidebar*/
  --item-hover-bg-color: var(--bg-color); /* background of control items when hover, like menu in sidebar*/
  --item-hover-text-color: white; /* text color upon hovering over menu items */
  --search-hit-bg-color: #428bca40;
  --search-select-text-color: var(--text-color); /* Text color for selected searched text */
  --search-select-bg-color: #428bca90; /* Background color for selected searched text */
  --rawblock-edit-panel-bd: var(--accent-color); /* Background color for inline HTML "edit panel" blocks */
  --monospace: "Cousine"; /* monospace font for codes, fences */

  --megamenu-bg-color: var(--side-bar-bg-color); /* background color for unibody megamenu */
  --megamenu-sidebar-bg-color: var(--bg-color); /* background color for megamenu sidebar */
  --megamenu-sidebar-hover-bg-color: #161819; /* background color for hovering megamenu sidebar items */
  --megamenu-sidebar-active-bg-color: #101010; /* background color for active megamenu sidebar items */
  --megamenu-button-border-color: #9292928f; /* background color for megamenu buttons */
  --megamenu-item-hover-bg-color: var(--bg-color); /* background color for hovering megamenu items */
  --megamenu-item-hover-text-color: white; /* text color for hovering megamenu items */
}

/** TAGS **/

html,
body {
  font-family: "Vazir", "Lato", sans-serif;
}

body {
  font-size: 14px;
}

h1,
h2,
h3,
h4,
h5,
h6, p, a, del, mark, #write p, #write a, #write del, #write mark, #write ul, #write li, #write ol,
#write table, #write tr, #write td, table, tr, td {
  direction: rtl;
}

.outline-item{
  direction: rtl;
}
.outline-h2, .outline-h3, .outline-h4,
 .outline-h5, .outline-h6 {
  margin-right: 10px !important;
}

#md-notification, #md-notification *{
  direction: ltr;
}

h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: "Vazir-Bold";
}

h1 {
  font-size: 1.8rem;
  margin: 1rem 0;
}

h2 {
  font-size: 1.4rem;
  margin: 0.7rem 0;
}

h3 {
  font-size: 1.2rem;
  margin: 0.5rem 0;
}

h4 {
  font-size: 1.1rem;
  margin: 0.2rem 0;
}

h5 {
  font-size: 1rem;
  margin: 0;
}

h6 {
  font-size: 1rem;
  margin: 0;
}

p {
  margin: 0.5rem 0;
}

a {
  color: var(--link-color);
}

del {
  color: var(--md-char-color);
}

mark {
  padding: 2px 1px;
  background: #fee405;
}

/* Writing area -> line height */
#write {
	line-height: 1.6;
}

/* Custom list-style */
#write ol,
#write ul {
  padding-left: 2rem;
  margin: 0.5rem 0;
  margin-left: 0 !important;
  padding-left: 0 !important;
}

#write ul {
  list-style-type: disc;
}

#write ol > li,
#write ul > li {
  color: var(--primary-color);
  padding-left: 0.25em;
}

#write ol li > *,
#write ul li > * {
  color: var(--text-color);
}

#write .md-task-list-item {
  transition: all 0.3s;
}

#write .md-task-list-item > input {
  -webkit-appearance: initial;
  display: block;
  position: absolute;
  border: 1px solid var(--md-char-color);
  border-radius: 0.25rem;
  margin-top: 0.1rem;
  margin-right: -1.8rem;
  height: 1.2rem;
  width: 1.2rem;
  transition: background 0.4s;
  right: 0;
}

#write .md-task-list-item > input:focus {
  outline: none;
  box-shadow: none;
}

#write .md-task-list-item > input:hover {
  background: var(--accent-color);
}

#write .md-task-list-item.task-list-done > p {
  color: var(--md-char-color);
  text-decoration: line-through;
}

#write .md-task-list-item > input[checked]::before {
  content: "";
  position: absolute;
  top: 20%;
  left: 50%;
  height: 60%;
  width: 2px;
  transform: rotate(40deg);
  background: var(--text-color);
}

#write .md-task-list-item > input[checked]::after {
  content: "";
  position: absolute;
  top: 46%;
  left: 25%;
  height: 30%;
  width: 2px;
  transform: rotate(-40deg);
  background: var(--text-color);
}

blockquote {
  margin: 1rem 0rem 1rem 0;
  font-family: "Vazir-Bold";
}

blockquote p::before {
  content: "";
  position: absolute;
  right: -2rem;
  height: 100%;
  width: 0.25rem;
  background: var(--primary-color);
}

blockquote p:not(:last-child):before {
  height: calc(100% + 1rem);
}

code,
.md-fences,
tt {
  font-family: "Cousine", monospace;
  font-size: 1rem;
}

code {
  border: 1px solid var(--accent-color);
  border-radius: 0.25rem;
  padding: 0 0.125rem;
}

/* Code auto-suggest list menu */
#fences-auto-suggest .active {
  background: var(--accent-color);
}

hr {
  border-color: var(--md-char-color);
}

/* YAML */
pre.md-meta-block {
  background-color: transparent;
  border-bottom: 1px solid var(--md-char-color);
  padding-bottom: 1rem;
  opacity: 0.8;
}

/* Tables */
table {
  border: 1px solid var(--md-char-color);
  margin: 1rem 0;
}

thead {
  background: #4d4d4d;
}

table tr:nth-child(2n) {
  background: var(--accent-color);
}

td,
th {
  padding: 0.35rem 0.7rem;
  border: 1px solid var(--md-char-color);
}

/* Table toolbar */
.md-table-edit {
  border-top: 1px solid var(--meta-content-color);
  margin-top: -29px !important;
  padding: 3px 0;
}

/* Table drag areas */
.typora-table-drag-area::after {
  content: "";
  position: absolute;
  border: 2px solid var(--text-color);
  opacity: 0;
  transition: opacity 0.4s;
}

#typora-table-row-tracker .typora-table-drag-area::after {
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 100%;
}

#typora-table-col-tracker .typora-table-drag-area::after {
  top: 50%;
  left: 0;
  transform: translateY(-50%);
  width: 100%;
  height: 0;
}

#typora-table-row-tracker .typora-table-drag-area:hover::after,
#typora-table-col-tracker .typora-table-drag-area:hover::after {
  opacity: 1;
}

/* Table of contents */
.md-toc-tooltip {
  z-index: 10;
}

span.md-toc-item {
  font-size: 1.1rem;
  color: var(--primary-btn-border-color);
}

span.md-toc-h1 {
  font-family: "Vazir-Bold";
  font-size: 1.3rem;
}

span.md-toc-h2 {
  font-size: 1.2rem;
}

/* Footnote */
sup.md-footnote {
  font-family: "Vazir-Bold";
  font-size: 0.8rem;
  padding: 0 4px;
}

span.md-def-split {
  min-width: 1ch;
}

.md-def-name::before,
.md-def-name::after {
  color: var(--meta-content-color);
}

/* Writing area */
#write {
  width: 90%;
  max-width: 700px;
}

/* Fill whole width of container */
#write h1,
#write h2,
#write h3,
#write h4,
#write h5,
#write h6,
#write p,
#write pre {
  width: auto;
}

/* Header prefix symbol */
/* Disable default header symbol */
#write h3.md-focus::before,
#write h4.md-focus::before,
#write h5.md-focus::before,
#write h6.md-focus::before {
  border: none;
  border-radius: 0;
  left: auto;
  float: none;
  padding: 0;
  vertical-align: baseline;
  line-height: 20px;
}

#write h1::before,
#write h2::before,
#write h3::before,
#write h4::before,
#write h5::before,
#write h6::before {
  position: absolute;
  top: 0;
  right: calc(100% + 10px);
  color: var(--md-char-color);
  font-size: 1rem;
  font-weight: bold;
  font-variant: "small-caps";
}

#write h1::before {
  content: "H1";
  top: 0.7rem;
}

#write h2::before {
  content: "H2";
  top: 0.37rem;
}

#write h3::before {
  content: "H3";
  top: 0.15rem;
}

#write h4::before {
  content: "H4";
}

#write h5::before {
  content: "H5";
}

#write h6::before {
  content: "H6";
}

/* Image meta text */
#write .md-image > .md-meta {
  color: var(--meta-content-color);
}

/* Inline styles */
.md-rawblock-tooltip {
  top: -1.5rem;
  height: 1.5rem;
  padding: 0.25rem;
}

/* Search results */
.md-search-hit {
  background: var(--search-hit-bg-color);
  border-radius: 0.125em;
}

.md-search-select {
  background: var(--search-select-bg-color);
  border: 1px solid var(--megamenu-button-border-color);
  padding: 0 1px;
}

/* Focus mode */
.on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) *,
.on-focus-mode pre.md-end-block:not(.md-focus):not(.md-focus-container) {
  color: var(--md-char-color) !important;
}

.on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) img,
.on-focus-mode
  blockquote
  .md-end-block:not(.md-focus):not(.md-focus-container)::before,
.on-focus-mode li:not(.md-focus-container)::before {
  opacity: 0.5;
}

.on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) mark {
  background: var(--accent-color);
}

/* UI Sidebar */
#typora-sidebar {
  border-right: 1px solid #19191c;
}

.sidebar-tabs {
  font-family: "Vazir-Bold";
  border-bottom: 1px solid black;
}

.file-list-item-file-name {
  font-family: "Vazir-Bold";
  font-size: 1.2rem;
}

input.file-list-item-file-name, input.file-tree-rename-input {
  background: var(--side-bar-bg-color);
}

#file-library-search .file-list-item-file-name {
  font-size: 1.1rem;
}

#file-library-search .ty-search-item.active {
  background: var(--active-search-item-bg-color);
}

#file-library-search-input {
  background: var(--side-bar-bg-color);
}

.file-list-item-summary,
.ty-search-item-line {
  font-family: "Vazir", "Lato", sans-serif;
}

.ty-file-search-match-text,
.ty-outline-hit {
  font-weight: bold;
  background: transparent;
}

#outline-content {
  line-height: 1.4em;
}

#outline-content .outline-h1 > .outline-item {
  font-family: "Vazir-Bold";
}

.file-library-node,
.file-library-node .file-node-background {
  transition: background 0.4s;
}

.file-tree-node.file-library-file-node:not(.active):hover .file-node-background,
.file-list-item.file-library-node:not(.active):hover {
  background: var(--item-hover-bg-color);
}

.file-tree-node.file-library-file-node.active .file-node-background,
.file-list-item.file-library-file-node.active {
  border-left: 5px solid var(--primary-color);
}

/* Remove blinking animation when updating filename */
.blink-area {
  animation: none;
}

#ty-sidebar-footer {
  border-top: 1px solid black;
}

.sidebar-footer-item {
  transition: background 0.3s;
}

.outline-title-wrapper,
.outline-item-wrapper.outline-h1 > .outline-item {
  font-family: "Vazir-Bold";
  font-weight: bold;
}

/* Windows-specific */
/* Context and dropdown menus */
ul.dropdown-menu li.active a,
ul.dropdown-menu li.has-extra-menu.active a,
ul.dropdown-menu li.has-btn-submenu a.menu-style-btn.active,
#footer-word-count-info .ty-footer-word-count-all tr:hover,
#ty-spell-check-dict-missing-menu li:hover,
.ty-spell-check-panel-item.ty-active,
.ty-spell-check-panel-item:hover {
  background: var(--text-color) !important;
  color: var(--bg-color) !important;
}

/* Windows Unibody */
footer.ty-footer {
  border-top: 0;
}

.footer-item:hover {
  background: var(--text-color) !important;
  color: var(--bg-color) !important;
}

.form-control:focus {
  border-color: var(--primary-color);
  box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 2px var(--primary-color);
}

/* Windows Unibody megamenu */
.megamenu-opened header {
  background-image: none;
}

#top-titlebar, #top-titlebar * {
  color: inherit;
}

#megamenu-content {
  padding-top: 28px;
  background: var(--megamenu-bg-color);
  color: var(--text-color);
}

.megamenu-menu-panel:not(:first-of-type) {
  margin-top: 48px;
}

#megamenu-content .long-btn {
  border-color: var(--megamenu-button-border-color);
  transition: all 0.4s;
}

#megamenu-content .long-btn:hover {
  border-color: var(--primary-color);
  background: var(--megamenu-item-hover-bg-color);
  color: var(--megamenu-item-hover-text-color) !important;
}

#recent-file-panel-action-btn {
  background: inherit;
  border-color: var(--megamenu-button-border-color);
  transition: all 0.4s;
}

#recent-file-panel-action-btn:hover {
  border-color: var(--primary-color);
  background: var(--megamenu-item-hover-bg-color);
  color: var(--megamenu-item-hover-text-color);
}

#recent-document-table {
  border: 1px solid var(--accent-color);
}

#recent-file-panel tbody tr:nth-child(2n-1) {
  background-color: inherit;
}

#recent-file-panel tbody tr:hover {
  background-color: var(--megamenu-item-hover-bg-color) !important;
}

#recent-file-panel tbody tr:hover td:nth-child(1) {
  color: var(--megamenu-item-hover-text-color);
}

/* Windows Unibody sidebar */
#megamenu-menu-sidebar {
  background: var(--megamenu-sidebar-bg-color);
  color: var(--text-color);
}

.megamenu-menu-header, .megamenu-menu-list li:not(.saved) a {
  transition: all 0.4s;
}

.megamenu-menu-header {
  border-bottom: var(--window-border);
}

.megamenu-menu-header:hover, .megamenu-menu-list li:not(.saved) a:not(.active):hover {
  background: var(--megamenu-sidebar-hover-bg-color);
}

.megamenu-menu-list li a.active {
  background: var(--megamenu-sidebar-active-bg-color) !important;
}

#m-saved {
  background: inherit;
  color: inherit;
}

#megamenu-menu-list {
  margin: 0;
}

.theme-preview-div {
  transition: all 0.4s;
}

.theme-preview-div:hover {
  border: 4px solid var(--primary-btn-border-color);
}

.theme-preview-div.active, .theme-preview-div.active:hover {
  border: 4px solid var(--primary-color);
}

.theme-preview-div.active i {
  color: var(--primary-color);
}

/* Source Code */
.cm-s-typora-default .cm-s-inner.CodeMirror-line {
  border: 0 !important;
}

/* Print/PDF */
@media print {
  #write ol > li,
  #write ul > li {
    color: var(--text-color);
  }
  #write h1::before, #write h2::before, #write h3::before,
  #write h4::before, #write h5::before, #write h6::before {
    display: none;
  }
}




</style><title>الفصل التاني إزاي تبدأ مع Terraform</title>
</head>
<body class='typora-export'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='الفصل-التاني-إزاي-تبدأ-مع-terraform'><strong><span>الفصل التاني: إزاي تبدأ مع Terraform</span></strong></h1><p><span>في الفصل ده، هتتعلم أساسيات إزاي تستخدم Terraform. هي أداة سهلة في التعلم، فعشان كده في خلال حوالي 40 صفحة، هتتنقل من إنك تشغل أول أوامر Terraform ليك لحد ما توصل إنك تستخدم Terraform عشان تعمل deploy لـ cluster من الـ servers ومعاه load balancer بيوزع الـ traffic عليهم. الـ infrastructure دي تعتبر نقطة بداية كويسة عشان تشغل web services تكون scalable وhighly available. في الفصول الجاية، هنطوّر المثال ده أكتر كمان.</span></p><div class="md-alert md-alert-caution caution"><p><span class='md-alert-text md-alert-text-caution'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Caution</span><br></p><p><span>ملحوظة مهمة قوي الكتاب ماشي طول الفصول على الشغل على default vpc و 2 subnet اللي موجودين بشكل default  </span></p><p><span>دي نقطة مهمة الكتاب مش مركز على امثلة كبيرة بقدر ماهو مركز على فهمك لـterraform </span></p><p><span>بس برده </span></p><p><a href='https://github.com/taha2samy/examples/tree/master/ch2' target='_blank' class='url'>https://github.com/taha2samy/examples/tree/master/ch2</a></p><p><span>دي الامثلة بتاع الفصل ده مبينه من الصفر من vpc الى اخر حاجة بس نصيحة افهم الاول الفصل وبعدها بص عليهم اخر حاجة </span></p></div><p><span>Terraform تقدر تعمل provision لـ infrastructure على public cloud providers زي AWS، وAzure، وGoogle Cloud، وDigitalOcean، وكمان على private cloud ومنصات virtualization زي OpenStack و VMware. تقريبًا كل أمثلة الكود (code examples) في الفصل ده وباقي الكتاب، هنستخدم فيها AWS. AWS اختيار كويس عشان تتعلم Terraform للأسباب دي:</span></p><ul><li><p><span>AWS هي أشهر cloud infrastructure provider، وبفرق كبير. حصتها 32% من سوق الـ cloud infrastructure، وده أكتر من حصة أكبر تلات منافسين بعدها (Microsoft، وGoogle، وIBM) مجتمعين.</span></p></li><li><p><span>AWS بتقدم مجموعة ضخمة من خدمات الـ cloud-hosting اللي تقدر تعتمد عليها وتكون scalable، ومنها Amazon Elastic Compute Cloud (Amazon EC2)، اللي ممكن تستخدمه عشان تعمل deploy لـ virtual servers؛ وAuto Scaling Groups (ASGs)، اللي بتسهل إدارة cluster من الـ virtual servers؛ وElastic Load Balancers (ELBs)، اللي ممكن تستخدمه عشان توزع الـ traffic على الـ cluster بتاع الـ virtual servers.</span></p></li><li><p><span>AWS بتقدم Free Tier لأول سنة، والمفروض إنها تسمح لك تشغل كل الأمثلة دي ببلاش أو بتكلفة قليلة جدًا. لو خلصت الـ credits بتاعة الـ Free Tier بتاعتك، الأمثلة اللي في الكتاب ده برضه مش المفروض تكلفك أكتر من كام دولار.</span></p></li></ul><p><span>لو عمرك ما استخدمت AWS أو Terraform قبل كده، متقلقش؛ الـ tutorial ده مصمم للمبتدئين في الاتنين. همشي معاك في الخطوات دي:</span></p><ol start='' ><li><p><span>تجهيز الـ AWS account بتاعك</span></p></li><li><p><span>تسطيب Terraform</span></p></li><li><p><span>Deploy لـ single server</span></p></li><li><p><span>Deploy لـ single web server</span></p></li><li><p><span>Deploy لـ configurable web server</span></p></li><li><p><span>Deploy لـ cluster of web servers</span></p></li><li><p><span>Deploy لـ load balancer</span></p></li><li><p><span>التنضيف</span></p></li></ol><h2 id='تجهيز-الـ-aws-account-بتاعك'><span>تجهيز الـ AWS account بتاعك</span></h2><p><span>بنفكرك، إنك تقدر تلاقي كل الأمثلة بتاعة الكود اللي في الكتاب على GitHub.</span></p><p><img src="imgs/image-20250615092333728.png" referrerpolicy="no-referrer" alt="image-20250615092333728"></p><p>&nbsp;</p><p><span>دوس على زرار </span><code>Next</code><span>. </span><code>AWS</code><span> هيطلب منك تضيف </span><code>permissions</code><span> للـ </span><code>user</code><span> ده. بشكل افتراضي، الـ </span><code>IAM users</code><span> الجداد مش بيكون عندهم أي </span><code>permissions</code><span> خالص ومش بيقدروا يعملوا أي حاجة في الـ </span><code>AWS account</code><span>. عشان تدي الـ </span><code>IAM user</code><span> بتاعك القدرة إنه يعمل حاجة، محتاج تربط </span><code>IAM Policy</code><span> واحدة أو أكتر بالـ </span><code>account</code><span> بتاع اليوزر ده. الـ </span><code>IAM Policy</code><span> دي عبارة عن ملف </span><code>JSON</code><span> بيحدد إيه اللي الـ </span><code>user</code><span> مسموح له يعمله وإيه اللي مش مسموح له يعمله. أنت ممكن تعمل </span><code>IAM Policies</code><span> خاصة بيك، أو تستخدم شوية من الـ </span><code>IAM Policies</code><span> اللي متعرفة أصلًا وموجودة في الـ </span><code>AWS account</code><span> بتاعك، ودي معروفة باسم </span><code>Managed Policies</code><span>.</span></p><p><span>عشان تشغل الأمثلة اللي في الكتاب ده، أسهل طريقة تبدأ بيها هي إنك تضيف الـ </span><code>Managed Policy</code><span> اللي اسمها </span><code>AdministratorAccess</code><span> للـ </span><code>IAM user</code><span> بتاعك (اعمل </span><code>search</code><span> عليها، ودوس على الـ </span><code>checkbox</code><span> اللي جنبها)، زي ما هو واضح في شكل 2-2.</span></p><p><img src="imgs/image-20250615100520739.png" referrerpolicy="no-referrer" alt="image-20250615100520739"></p><p><span>دوس على </span><code>Next</code><span> كام مرة كمان وبعد كده على زرار “Create user”. </span><code>AWS</code><span> هيوريك الـ </span><code>security credentials</code><span> بتاعة اليوزر ده، واللي هي عبارة عن </span><code>Access Key ID</code><span> و </span><code>Secret Access Key</code><span>، زي ما هو واضح في شكل 2-3. لازم تسيفهم حالًا عشان هما مش هيظهروا تاني أبدًا، وهتحتاجهم بعدين في الـ </span><code>tutorial</code><span> ده. خد بالك إن الـ </span><code>credentials</code><span> دي بتديك </span><code>access</code><span> على الـ </span><code>AWS account</code><span> بتاعك، عشان كده خزّنهم في مكان آمن (زي </span><code>password manager</code><span> زي </span><code>1Password</code><span>، </span><code>LastPass</code><span>، أو </span><code>macOS Keychain</code><span>)، وأوعى تشاركهم مع أي حد.</span></p><p><span>بعد ما تسيف الـ </span><code>credentials</code><span> بتاعتك، دوس على زرار </span><code>Close</code><span>. كده أنت جاهز تبدأ تستخدم </span><code>Terraform</code><span>.</span></p><blockquote><p><strong><span>ملحوظة بخصوص الـ </span><code>Default Virtual Private Clouds</code></strong></p><p><span>كل أمثلة </span><code>AWS</code><span> في الكتاب ده بتستخدم الـ </span><code>Default VPC</code><span> اللي في الـ </span><code>AWS account</code><span> بتاعك. الـ </span><code>VPC</code><span>، أو </span><code>virtual private cloud</code><span>، هي منطقة معزولة في الـ </span><code>AWS account</code><span> بتاعك ليها شبكة افتراضية (</span><code>virtual network</code><span>) و </span><code>IP address</code><span> خاصة بيها. تقريبًا كل </span><code>AWS resource</code><span> بيتعمله </span><code>deploy</code><span> جوه </span><code>VPC</code><span>. لو محددتش </span><code>VPC</code><span> بشكل صريح، الـ </span><code>resource</code><span> هيتعمله </span><code>deploy</code><span> في الـ </span><code>Default VPC</code><span>، اللي هو جزء من أي </span><code>AWS account</code><span> اتعمل بعد 2013. لو لأي سبب مسحت الـ </span><code>Default VPC</code><span> اللي في الـ </span><code>account</code><span> بتاعك، يا إما تستخدم </span><code>region</code><span> تانية (كل </span><code>region</code><span> ليها </span><code>Default VPC</code><span> خاصة بيها) أو تعمل </span><code>Default VPC</code><span> جديد باستخدام الـ </span><code>AWS Web Console</code><span>. غير كده، هتحتاج تعدل تقريبًا كل مثال عشان تضيف </span><code>parameter</code><span> اسمه </span><code>vpc_id</code><span> أو </span><code>subnet_id</code><span> بيشاور على </span><code>custom VPC</code><span>.</span></p></blockquote><h2 id='تسطيب-terraform'><strong><span>تسطيب </span><code>Terraform</code></strong></h2><p><span>أسهل طريقة عشان تسطب </span><code>Terraform</code><span> هي إنك تستخدم الـ </span><code>package manager</code><span> بتاع نظام التشغيل بتاعك. على سبيل المثال، على </span><code>macOS</code><span>، لو أنت بتستخدم </span><code>Homebrew</code><span>، ممكن تشغل التالي:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0234px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ brew</span> tap hashicorp/tap</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ brew</span> install hashicorp/tap/terraform</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>على </span><code>Windows</code><span>، لو أنت بتستخدم </span><code>Chocolatey</code><span>، ممكن تشغل التالي:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0234px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ choco</span> install terraform</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>بص على الـ </span><code>documentation</code><span> بتاع </span><code>Terraform</code><span> عشان تشوف تعليمات التسطيب على أنظمة التشغيل التانية، واللي منها الأنواع المختلفة من </span><code>Linux</code><span>.</span></p><p><span>أو كحل بديل، ممكن تسطب </span><code>Terraform</code><span> يدويًا بإنك تروح على الصفحة الرئيسية بتاعة </span><code>Terraform</code><span>، وتدوس على لينك التحميل، وتختار الـ </span><code>package</code><span> المناسب لنظام التشغيل بتاعك، وتنزل الـ </span><code>ZIP archive</code><span>، وتفكه في الـ </span><code>directory</code><span> اللي عايز تسطب </span><code>Terraform</code><span> فيه. الأرشيف هيفك </span><code>binary</code><span> واحد اسمه </span><code>terraform</code><span>، واللي هتبقى عايز تضيفه للـ </span><code>PATH environment variable</code><span> بتاعك.</span></p><p><span>عشان تتأكد إن الدنيا شغالة، شغل الـ </span><code>command</code><span> بتاع </span><code>terraform</code><span>، والمفروض تشوف تعليمات الاستخدام:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0236px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$ terraform</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Usage: terraform [global options] &lt;subcommand&gt; [args]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">The available commands for execution are listed below.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">The primary workflow commands are given first, followed by</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">less common or more advanced commands.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Main commands:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  init &nbsp; &nbsp; &nbsp; &nbsp;  Prepare your working directory for other commands</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  validate &nbsp; &nbsp;  Check whether the configuration is valid</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  plan &nbsp; &nbsp; &nbsp; &nbsp;  Show changes required by the current configuration</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  apply &nbsp; &nbsp; &nbsp; &nbsp; Create or update infrastructure</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  destroy &nbsp; &nbsp; &nbsp; Destroy previously-created infrastructure</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(...)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 314px;"></div><div class="CodeMirror-gutters" style="display: none; height: 314px;"></div></div></div></pre><p><span>عشان </span><code>Terraform</code><span> يقدر يعمل تغييرات في الـ </span><code>AWS account</code><span> بتاعك، هتحتاج تظبط (</span><code>set</code><span>) الـ </span><code>AWS credentials</code><span> بتاعة الـ </span><code>IAM user</code><span> اللي عملته قبل كده كـ </span><code>environment variables</code><span> اللي هما </span><code>AWS_ACCESS_KEY_ID</code><span> و </span><code>AWS_SECRET_ACCESS_KEY</code><span>.</span>
<span>على سبيل المثال، ده إزاي ممكن تعمله في </span><code>terminal</code><span> بتاع </span><code>Unix/Linux/macOS</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0231px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ export</span> <span class="cm-def">AWS_ACCESS_KEY_ID</span><span class="cm-operator">=</span>(your access key id)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ export</span> <span class="cm-def">AWS_SECRET_ACCESS_KEY</span><span class="cm-operator">=</span>(your secret access key)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>وده إزاي ممكن تعمله في </span><code>command terminal</code><span> بتاع </span><code>Windows</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="powershell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0231px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">$</span> <span class="cm-builtin">set</span> <span class="cm-identifier">AWS_ACCESS_KEY_ID</span><span class="cm-operator">=</span><span class="cm-punctuation">(</span><span class="cm-identifier">your</span> <span class="cm-identifier">access</span> <span class="cm-identifier">key</span> <span class="cm-identifier">id</span><span class="cm-punctuation">)</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-error">$</span> <span class="cm-builtin">set</span> <span class="cm-identifier">AWS_SECRET_ACCESS_KEY</span><span class="cm-operator">=</span><span class="cm-punctuation">(</span><span class="cm-identifier">your</span> <span class="cm-identifier">secret</span> <span class="cm-identifier">access</span> <span class="cm-identifier">key</span><span class="cm-punctuation">)</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>خد بالك إن الـ </span><code>environment variables</code><span> دي بتتطبق بس على الـ </span><code>shell</code><span> الحالية، فعشان كده لو عملت </span><code>reboot</code><span> لجهازك أو فتحت </span><code>terminal window</code><span> جديدة، هتحتاج تعمل </span><code>export</code><span> للـ </span><code>variables</code><span> دي تاني.</span></p><div class="md-alert md-alert-important important"><p><span class='md-alert-text md-alert-text-important'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</span><br></p><p>&nbsp;</p><p><span>تمام، خلينا نفصّص حتة الـ </span><code>authentication</code><span> دي أكتر، لأن طريقة الـ </span><code>environment variables</code><span> اللي شرحناها بتنفع لو شغال لوحدك على جهازك وبتجرب، لكن في الشغل الحقيقي ومع فريق، أو لما الكود بتاعك يشتغل على </span><code>server</code><span>، هتحتاج طرق أنضف وأكتر أمانًا.</span></p><p><code>Terraform</code><span>، زيه زي أي أداة بتتعامل مع </span><code>AWS</code><span>، ذكي كفاية إنه بيدور على الـ </span><code>credentials</code><span> بتاعتك في كذا مكان بالترتيب. لو لقاها في مكان، بيستخدمها ويكمل. الأماكن دي هي:</span></p><ol start='' ><li><p><strong><span>الـ </span><code>Credentials</code><span> في كود الـ </span><code>Provider</code><span> نفسه (لا يُنصح بها أبدًا!)</span></strong><span>: ممكن تكتب الـ keys جوه ملف الـ </span><code>.tf</code><span>، بس دي أسوأ طريقة ممكنة لأنك كده بتنشر Credentials في الـ </span><code>code</code><span> وأي حد معاه </span><code>access</code><span> على الـ </span><code>code</code><span> هيشوفها. أوعى تعمل كده.</span></p></li><li><p><strong><code>Environment Variables</code><span> (اللي لسة شارحينها)</span></strong><span>: </span><code>Terraform</code><span> بيبص على </span><code>AWS_ACCESS_KEY_ID</code><span> و </span><code>AWS_SECRET_ACCESS_KEY</code><span>. دي طريقة سريعة للتجارب على جهازك.</span></p></li></ol><p><span>لو ملقاش دول، بيروح يدور على الطريقتين اللي جايين دول، وهما الأهم والأكتر استخدامًا في الشغل:</span></p><hr /><h3 id='الطريقة-الأولى-ملف-الـ-credentials-the-credentials-file'><strong><span>الطريقة الأولى: ملف الـ </span><code>Credentials</code><span> (The Credentials File)</span></strong></h3><p><span>دي الطريقة المفضلة للشغل على جهازك  (</span><code>local machine</code><span>).</span></p><ul><li><p><strong><span>إيه هو؟</span></strong>
<span>ده ملف نصي بسيط اسمه </span><code>credentials</code><span> بيتحط جوه فولدر اسمه </span><code>.aws</code><span> في الـ </span><code>home directory</code><span> بتاعك (يعني المسار بيبقى </span><code>~/.aws/credentials</code><span> على Linux/macOS أو </span><code>C:\Users\YOUR_USERNAME\.aws\credentials</code><span> على Windows). الملف ده عامل زي &quot;دفتر&quot; بتسجل فيه الـ </span><code>keys</code><span> بتاعة كل الـ </span><code>AWS accounts</code><span> اللي بتتعامل معاها.</span></p></li><li><p><strong><span>بيشتغل إزاي؟</span></strong>
<span>أسهل طريقة تعمله هي إنك تسطب الـ </span><code>AWS CLI</code><span> وتشغل أمر واحد:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0236px; left: 7.63022px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">aws configure</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>الأمر ده هيسألك على الـ </span><code>Access Key ID</code><span>، والـ </span><code>Secret Access Key</code><span>، والـ </span><code>Default region</code><span>، والـ </span><code>Default output format</code><span>. هو لوحده هيعمل الفولدر والملف ويكتب فيهم الـ </span><code>credentials</code><span> بتاعتك. شكل الملف من جوه بيبقى كده:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="ini"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="ini"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0236px; left: 74.8438px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-header">[default]</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">aws_access_key_id </span>=<span class="cm-quote"> AKIAIOSFODNN7EXAMPLE</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">aws_secret_access_key </span>=<span class="cm-quote"> wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 67px;"></div><div class="CodeMirror-gutters" style="display: none; height: 67px;"></div></div></div></pre><p><code>Terraform</code><span> أوتوماتيكيًا بيروح يقرأ من الـ </span><code>profile</code><span> اللي اسمه </span><code>[default]</code><span> في الملف ده لو ملقاش </span><code>environment variables</code><span>.</span></p></li><li><p><strong><span>الميزة الكبيرة: الـ </span><code>Profiles</code></strong>
<span>لو بتشتغل على أكتر من </span><code>account</code><span> (مثلًا </span><code>development</code><span> و </span><code>production</code><span>)، تقدر تعمل </span><code>profiles</code><span> مختلفة جوه نفس الملف:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="ini"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="ini"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0231px; left: 74.8438px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-header">[default]</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">aws_access_key_id </span>=<span class="cm-quote"> ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">aws_secret_access_key </span>=<span class="cm-quote"> ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-header">[prod]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">aws_access_key_id </span>=<span class="cm-quote"> AKIA...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">aws_secret_access_key </span>=<span class="cm-quote"> ZZZZ...</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre><p><span>وبعدين في كود </span><code>Terraform</code><span> بتاعك، تقدر تقوله يستخدم أنهي </span><code>profile</code><span>:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0231px; left: 7.63019px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">provider "aws" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  region  = "us-east-1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  profile = "prod" &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p><p><span>دي طريقة أنضف وأكتر تنظيمًا بكتير من الـ </span><code>environment variables</code><span>.</span></p><hr /><h3 id='الطريقة-الثانية-الـ-iam-roles-الأكثر-أمانًا-والأفضل-للـ-servers'><strong><span>الطريقة الثانية: الـ </span><code>IAM Roles</code><span> (الأكثر أمانًا والأفضل للـ </span><code>Servers</code><span>)</span></strong></h3><p><span>دي هي الـ </span><code>best practice</code><span> والأكتر أمانًا، وخصوصًا لما كود </span><code>Terraform</code><span> بتاعك بيشتغل من على </span><code>resource</code><span> جوه </span><code>AWS</code><span> نفسها، زي </span><code>EC2 instance</code><span> أو </span><code>CI/CD pipeline</code><span>.</span></p><ul><li><p><strong><span>إيه هي؟</span></strong>
<span>فكر فيها كده: بدل ما تخزن </span><code>keys</code><span> ثابتة على الـ </span><code>server</code><span> (ولو الـ </span><code>server</code><span> اتعمله </span><code>hack</code><span> الـ </span><code>keys</code><span> تتسرق)، أنت بتدي للـ </span><code>server</code><span> نفسه &quot;هوية&quot; أو </span><code>permission</code><span> إنه ياخد </span><code>credentials</code><span> مؤقتة وصلاحيتها بتنتهي بعد فترة قصيرة (زي ساعة مثلًا).</span></p></li><li><p><strong><span>بتشتغل إزاي؟</span></strong></p><ol start='' ><li><p><span>بتروح على </span><code>IAM</code><span> في </span><code>AWS</code><span> وتعمل </span><code>IAM Role</code><span>.</span></p></li><li><p><span>بتدي للـ </span><code>Role</code><span> ده الـ </span><code>permissions</code><span> اللي محتاجها (مثلًا، يقدر يعمل </span><code>EC2 instances</code><span> ويمسحها).</span></p></li><li><p><span>أهم خطوة، بتعمل &quot;Trust Relationship&quot;، يعني بتقول مين مسموح له ياخد الـ </span><code>Role</code><span> ده. في حالتنا، بتقول إن خدمة </span><code>EC2</code><span> مسموح لها تاخده.</span></p></li><li><p><span>لما تيجي تعمل </span><code>launch</code><span> للـ </span><code>EC2 instance</code><span> اللي هتشغل عليه </span><code>Terraform</code><span>، بتربط الـ </span><code>IAM Role</code><span> ده بالـ </span><code>instance</code><span>.</span></p></li><li><p><strong><span>السحر بيحصل هنا:</span></strong><span> الـ </span><code>instance</code><span> دي أوتوماتيكيًا بتاخد </span><code>credentials</code><span> مؤقتة وصلاحيتها بتتجدد لوحدها. </span><code>Terraform</code><span> (وأي </span><code>AWS SDK</code><span>) لما بيشتغل على الـ </span><code>instance</code><span> دي، بيكلم خدمة داخلية اسمها </span><code>EC2 Metadata Service</code><span> وياخد منها الـ </span><code>credentials</code><span> المؤقتة دي ويستخدمها.</span></p></li></ol></li><li><p><strong><span>ليه دي أفضل طريقة؟</span></strong></p><ul><li><p><strong><span>أمان مطلق:</span></strong><span> مفيش أي </span><code>long-lived keys</code><span> متخزنة على الـ </span><code>server</code><span> أبدًا. لو الـ </span><code>server</code><span> اتسرق، المهاجم مش هيلاقي </span><code>keys</code><span> يستخدمها.</span></p></li><li><p><strong><span>صلاحيات مؤقتة:</span></strong><span> الـ </span><code>credentials</code><span> بتنتهي صلاحيتها وبتتجدد أوتوماتيك، فبتقلل الخطر جدًا.</span></p></li><li><p><strong><span>إدارة مركزية:</span></strong><span> كل الصلاحيات بتتحكم فيها من مكان واحد وهو الـ </span><code>IAM Role</code><span>، وتقدر تعدلها في أي وقت من غير ما تلمس الـ </span><code>server</code><span>.</span></p></li></ul></li></ul></div><p>&nbsp;</p><h2 id='deploy-لـ-single-server'><strong><code>Deploy</code><span> لـ </span><code>single server</code></strong></h2><p><span>كود </span><code>Terraform</code><span> بيتكتب بلغة اسمها </span><code>HashiCorp Configuration Language</code><span> أو </span><code>(HCL)</code><span>، في فايلات الـ </span><code>extension</code><span> بتاعها </span><code>.tf</code><span>. هي لغة </span><code>declarative</code><span> ، فهدفك هو إنك توصف الـ </span><code>infrastructure</code><span> اللي أنت عايزها، و</span><code>Terraform</code><span> هو اللي هيعرف إزاي يعملها. </span><code>Terraform</code><span> يقدر يعمل </span><code>infrastructure</code><span> على منصات كتير مختلفة، أو اللي هو بيسميها </span><code>providers</code><span>، زي </span><code>AWS</code><span>, </span><code>Azure</code><span>, </span><code>Google Cloud</code><span>, </span><code>DigitalOcean</code><span>، وغيرهم كتير.</span></p><p><span>تقدر تكتب كود </span><code>Terraform</code><span> في أي </span><code>text editor</code><span> تقريبًا. لو دورت شوية، هتلاقي </span><code>syntax highlighting support</code><span> لـ </span><code>Terraform</code><span> لمعظم الـ </span><code>editors</code><span> (خد بالك إنك ممكن تحتاج تدور على كلمة </span><code>HCL</code><span> بدل </span><code>Terraform</code><span>)، ومنهم </span><code>vim</code><span>, </span><code>emacs</code><span>, </span><code>Sublime Text</code><span>, </span><code>Atom</code><span>, </span><code>Visual Studio Code</code><span>, و</span><code>IntelliJ</code><span> (الأخير ده حتى فيه دعم للـ </span><code>refactoring</code><span>, </span><code>find usages</code><span>, و </span><code>go to declaration</code><span>).</span></p><p><span>أول خطوة عشان تستخدم </span><code>Terraform</code><span> هي عادةً إنك تعمل </span><code>configure</code><span> للـ </span><code>provider(s)</code><span> اللي عايز تستخدمهم. اعمل فولدر فاضي وحط فيه ملف اسمه </span><code>main.tf</code><span> فيه المحتوى ده:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0236px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">provider</span> <span class="cm-string">"aws"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">region</span> <span class="cm-operator">=</span> <span class="cm-string">"us-east-2"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 67px;"></div><div class="CodeMirror-gutters" style="display: none; height: 67px;"></div></div></div></pre><p><span>ده بيقول لـ </span><code>Terraform</code><span> إنك هتستخدم </span><code>AWS</code><span> كـ </span><code>provider</code><span> بتاعك، وإنك عايز تعمل </span><code>deploy</code><span> للـ </span><code>infrastructure</code><span> بتاعتك في </span><code>region</code><span> اسمها </span><code>us-east-2</code><span>. </span><code>AWS</code><span> عندها </span><code>datacenters</code><span> في كل حتة في العالم، متجمعة في </span><code>regions</code><span>. الـ </span><code>AWS region</code><span> هي منطقة جغرافية منفصلة، زي </span><code>us-east-2</code><span> (Ohio)</span>
<span>، </span><code>eu-west-1</code><span> (Ireland)، و </span><code>ap-southeast-2</code><span> (Sydney). وجوه كل </span><code>region</code><span>، فيه </span><code>datacenters</code><span> معزولة كتير معروفة باسم </span><code>Availability Zones (AZs)</code><span>، زي </span><code>us-east-2a</code><span>, </span><code>us-east-2b</code><span>، وهكذا. فيه إعدادات تانية كتير ممكن تعملها </span><code>configure</code><span> على الـ </span><code>provider</code><span> ده، بس دلوقتي خلينا نبسط الموضوع، وهنبص على الـ </span><code>provider configuration</code><span> بتعمق أكتر في الفصل السابع.</span></p><p><span>لكل نوع </span><code>provider</code><span>، فيه أنواع </span><code>resources</code><span> مختلفة كتير ممكن تعملها، زي </span><code>servers</code><span>, </span><code>databases</code><span>, و </span><code>load balancers</code><span>. الـ </span><code>syntax</code><span> العام عشان تعمل </span><code>resource</code><span> في </span><code>Terraform</code><span> هو ده:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0236px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"&lt;PROVIDER&gt;_&lt;TYPE&gt;"</span> <span class="cm-string">"&lt;NAME&gt;"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  [<span class="cm-tag">CONFIG</span> <span class="cm-operator">...</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 67px;"></div><div class="CodeMirror-gutters" style="display: none; height: 67px;"></div></div></div></pre><p>&nbsp;</p><p><span>حيث </span><code>PROVIDER</code><span> هو اسم الـ </span><code>provider</code><span> (زي </span><code>aws</code><span>)، و </span><code>TYPE</code><span> هو نوع الـ </span><code>resource</code><span> اللي عايز تعمله في الـ </span><code>provider</code><span> ده (زي </span><code>instance</code><span>)، و </span><code>NAME</code><span> هو </span><code>identifier</code><span> تقدر تستخدمه في كل كود </span><code>Terraform</code><span> عشان تشاور على الـ </span><code>resource</code><span> ده (زي </span><code>my_instance</code><span>)، و </span><code>CONFIG</code><span> عبارة عن </span><code>argument</code><span> أو أكتر خاصين بالـ </span><code>resource</code><span> ده.</span></p><div class="md-alert md-alert-important important"><p><span class='md-alert-text md-alert-text-important'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</span><br></p><p><span>ملحوظة ازاي اعمل call لمثلا id بتاع resource معين داخل resource ثاني مثلا او output زي ماهنشوف لسه انت بتناديه زي &quot;</span><PROVIDER><span>_</span><TYPE><span>&quot; &quot;</span><NAME><span>&quot; بنفس الشكل بدون كلمة resource</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terrafrom"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terrafrom"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0236px; left: 7.63019px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">resource "aws_instance" "example" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ami &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = "ami-0fb653ca2d3203ac1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">instance_type = "t2.micro"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0231px; left: 7.63019px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">aws_instance.example.id</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>وهكذا </span></p></div><p><span>على سبيل المثال، عشان تعمل </span><code>deploy</code><span> لـ </span><code>server</code><span>  واحد في </span><code>AWS</code><span>، اللي معروف باسم </span><code>EC2 Instance</code><span>، استخدم الـ </span><code>resource</code><span> اللي اسمه </span><code>aws_instance</code><span> في </span><code>main.tf</code><span> بالشكل ده:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0236px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_instance"</span> <span class="cm-string">"example"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ami</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"ami-0fb653ca2d3203ac1"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">instance_type</span> <span class="cm-operator">=</span> <span class="cm-string">"t2.micro"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0236px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">provider</span> <span class="cm-string">"aws"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">region</span> <span class="cm-operator">=</span> <span class="cm-string">"eu-west-1"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_vpc"</span> <span class="cm-string">"main_vpc"</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">cidr_block</span> <span class="cm-operator">=</span> <span class="cm-string">"10.0.0.0/16"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">enable_dns_support</span> <span class="cm-operator">=</span> <span class="cm-keyword">true</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">enable_dns_hostnames</span> <span class="cm-operator">=</span> <span class="cm-keyword">true</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">tags</span> <span class="cm-operator">=</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag">Name</span> <span class="cm-operator">=</span> <span class="cm-string">"my-vpc"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_subnet"</span> <span class="cm-string">"public_subnet"</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">vpc_id</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-variable">aws_vpc</span><span class="cm-operator">.</span><span class="cm-property">main_vpc</span><span class="cm-operator">.</span><span class="cm-property">id</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">cidr_block</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-string">"10.0.1.0/24"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">availability_zone</span> <span class="cm-operator">=</span> <span class="cm-string">"eu-west-1a"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">map_public_ip_on_launch</span> <span class="cm-operator">=</span> <span class="cm-keyword">true</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">tags</span> <span class="cm-operator">=</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag">Name</span> <span class="cm-operator">=</span> <span class="cm-string">"my-subnet"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">data</span> <span class="cm-string">"aws_ami"</span> <span class="cm-string">"ami_latest"</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">most_recent</span> <span class="cm-operator">=</span> <span class="cm-keyword">true</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">owners</span> &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> [<span class="cm-string">"amazon"</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">filter</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">name</span> &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"name"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">values</span> <span class="cm-operator">=</span> [<span class="cm-string">"amzn2-ami-hvm-*-x86_64-gp2"</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"tls_private_key"</span> <span class="cm-string">"ec2_key"</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">algorithm</span> <span class="cm-operator">=</span> <span class="cm-string">"RSA"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">rsa_bits</span> &nbsp;<span class="cm-operator">=</span> <span class="cm-number">2048</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"local_file"</span> <span class="cm-string">"ec2_key_pair"</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">content</span> &nbsp;<span class="cm-operator">=</span> <span class="cm-variable">tls_private_key</span><span class="cm-operator">.</span><span class="cm-property">ec2_key</span><span class="cm-operator">.</span><span class="cm-property">private_key_pem</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">filename</span> <span class="cm-operator">=</span> <span class="cm-string">"${path.module}/ec2_key.pem"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_key_pair"</span> <span class="cm-string">"ec2_key_pair"</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">key_name</span> &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"my-ec2-key"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">public_key</span> <span class="cm-operator">=</span> <span class="cm-variable">tls_private_key</span><span class="cm-operator">.</span><span class="cm-property">ec2_key</span><span class="cm-operator">.</span><span class="cm-property">public_key_openssh</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">tags</span> <span class="cm-operator">=</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag">Name</span> <span class="cm-operator">=</span> <span class="cm-string">"my-ec2-key-pair"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_security_group"</span> <span class="cm-string">"enable_ssh"</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">vpc_id</span> <span class="cm-operator">=</span> <span class="cm-variable">aws_vpc</span><span class="cm-operator">.</span><span class="cm-property">main_vpc</span><span class="cm-operator">.</span><span class="cm-property">id</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">name</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-string">"allow_ssh"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">description</span> <span class="cm-operator">=</span> <span class="cm-string">"Allow SSH access"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ingress</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">from_port</span> &nbsp; <span class="cm-operator">=</span> <span class="cm-number">22</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">to_port</span> &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-number">22</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">protocol</span> &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-string">"tcp"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">cidr_blocks</span> <span class="cm-operator">=</span> [<span class="cm-string">"0.0.0.0/0"</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">egress</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">from_port</span> &nbsp; <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">to_port</span> &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">protocol</span> &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-string">"-1"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">cidr_blocks</span> <span class="cm-operator">=</span> [<span class="cm-string">"0.0.0.0/0"</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_instance"</span> <span class="cm-string">"ec2"</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ami</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-variable">data</span><span class="cm-operator">.</span><span class="cm-property">aws_ami</span><span class="cm-operator">.</span><span class="cm-property">ami_latest</span><span class="cm-operator">.</span><span class="cm-property">id</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">instance_type</span> <span class="cm-operator">=</span> <span class="cm-string">"t2.micro"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">subnet_id</span> &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-variable">aws_subnet</span><span class="cm-operator">.</span><span class="cm-property">public_subnet</span><span class="cm-operator">.</span><span class="cm-property">id</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">associate_public_ip_address</span> <span class="cm-operator">=</span> <span class="cm-keyword">true</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">key_name</span> &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-variable">aws_key_pair</span><span class="cm-operator">.</span><span class="cm-property">ec2_key_pair</span><span class="cm-operator">.</span><span class="cm-property">key_name</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">vpc_security_group_ids</span> <span class="cm-operator">=</span> [<span class="cm-variable">aws_security_group</span><span class="cm-operator">.</span><span class="cm-property">enable_ssh</span><span class="cm-operator">.</span><span class="cm-property">id</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">tags</span> <span class="cm-operator">=</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag">Name</span> <span class="cm-operator">=</span> <span class="cm-string">"my-ec2-instance"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_internet_gateway"</span> <span class="cm-string">"main_igw"</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">vpc_id</span> <span class="cm-operator">=</span> <span class="cm-variable">aws_vpc</span><span class="cm-operator">.</span><span class="cm-property">main_vpc</span><span class="cm-operator">.</span><span class="cm-property">id</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">tags</span> <span class="cm-operator">=</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag">Name</span> <span class="cm-operator">=</span> <span class="cm-string">"my-vpc-igw"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_route_table"</span> <span class="cm-string">"public_route_table"</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">vpc_id</span> <span class="cm-operator">=</span> <span class="cm-variable">aws_vpc</span><span class="cm-operator">.</span><span class="cm-property">main_vpc</span><span class="cm-operator">.</span><span class="cm-property">id</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">route</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">cidr_block</span> <span class="cm-operator">=</span> <span class="cm-string">"0.0.0.0/0"</span> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">gateway_id</span> <span class="cm-operator">=</span> <span class="cm-variable">aws_internet_gateway</span><span class="cm-operator">.</span><span class="cm-property">main_igw</span><span class="cm-operator">.</span><span class="cm-property">id</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">tags</span> <span class="cm-operator">=</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag">Name</span> <span class="cm-operator">=</span> <span class="cm-string">"my-public-route-table"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_route_table_association"</span> <span class="cm-string">"public_subnet_association"</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">subnet_id</span> &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-variable">aws_subnet</span><span class="cm-operator">.</span><span class="cm-property">public_subnet</span><span class="cm-operator">.</span><span class="cm-property">id</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">route_table_id</span> <span class="cm-operator">=</span> <span class="cm-variable">aws_route_table</span><span class="cm-operator">.</span><span class="cm-property">public_route_table</span><span class="cm-operator">.</span><span class="cm-property">id</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 2710px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2710px;"></div></div></div></pre><p>&nbsp;</p><p><span>الـ </span><code>resource</code><span> اللي اسمه </span><code>aws_instance</code><span> بيدعم </span><code>arguments</code><span> كتير، بس دلوقتي، أنت محتاج بس تظبط الاتنين المطلوبين:</span></p><ul><li><p><strong><code>ami</code></strong>
<span>الـ </span><code>Amazon Machine Image (AMI)</code><span> اللي هتشتغل على الـ </span><code>EC2 Instance</code><span>. ممكن تلاقي </span><code>AMIs</code><span> ببلاش أو بفلوس في الـ </span><code>AWS Marketplace</code><span> أو تعمل الـ </span><code>AMI</code><span> الخاصة بيك باستخدام أدوات زي </span><code>Packer</code><span>. الكود اللي فوق بيظبط الـ </span><code>ami parameter</code><span> على الـ </span><code>ID</code><span> بتاع </span><code>Ubuntu 20.04 AMI</code><span> في </span><code>us-east-2</code><span>. الـ </span><code>AMI</code><span> دي استخدامها مجاني. من فضلك خد بالك إن الـ </span><code>AMI IDs</code><span> بتختلف في كل </span><code>AWS region</code><span>، فلو غيرت الـ </span><code>region parameter</code><span> لحاجة غير </span><code>us-east-2</code><span>، هتحتاج تدور يدويًا على الـ </span><code>Ubuntu AMI ID</code><span> المناسب للـ </span><code>region</code><span> دي، وتعمل له </span><code>copy</code><span> في الـ </span><code>ami parameter</code><span>. في الفصل السابع، هتشوف إزاي تجيب الـ </span><code>AMI ID</code><span> أوتوماتيكيًا بالكامل.</span></p></li><li><p><strong><code>instance_type</code></strong>
<span>نوع الـ </span><code>EC2 Instance</code><span> اللي هتشغله. كل نوع من الـ </span><code>EC2 Instance</code><span> بيقدم كمية مختلفة من الـ </span><code>CPU</code><span>, </span><code>memory</code><span>, </span><code>disk space</code><span>, و </span><code>networking capacity</code><span>. صفحة الـ </span><code>EC2 Instance Types</code><span> فيها كل الخيارات المتاحة. المثال اللي فات بيستخدم </span><code>t2.micro</code><span>، اللي فيه </span><code>virtual CPU</code><span> واحد، و 1 جيجا </span><code>memory</code><span>، وهو جزء من الـ </span><code>AWS Free Tier</code><span>.</span></p></li></ul><blockquote><p><strong><span>استخدم الـ </span><code>DOCS</code><span>!</span></strong></p><p><code>Terraform</code><span> بيدعم عشرات الـ </span><code>providers</code><span>، وكل واحد فيهم بيدعم عشرات الـ </span><code>resources</code><span>، وكل </span><code>resource</code><span> ليه عشرات الـ </span><code>arguments</code><span>. مستحيل تفتكرهم كلهم. وأنت بتكتب كود </span><code>Terraform</code><span>، لازم تبص بانتظام على الـ </span><code>Terraform documentation</code><span> عشان تشوف إيه الـ </span><code>resources</code><span> المتاحة وإزاي تستخدم كل واحدة. على سبيل المثال، ده الـ </span><code>documentation</code><span> بتاع الـ </span><code>aws_instance resource</code><span>. أنا بستخدم </span><code>Terraform</code><span> من سنين ولسه ببص على الـ </span><code>docs</code><span> دي كذا مرة في اليوم!</span></p></blockquote><p><span>في الـ </span><code>terminal</code><span>، ادخل على الفولدر اللي عملت فيه </span><code>main.tf</code><span> وشغل أمر </span><code>terraform init</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0231px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$ terraform init</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Initializing the backend...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Initializing provider plugins...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- Reusing previous version of hashicorp/aws from the dependency lock file</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- Using hashicorp/aws v4.19.0 from the shared cache directory</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Terraform has been successfully initialized!</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre><p><span>الـ </span><code>binary</code><span> بتاع </span><code>terraform</code><span> فيه الوظائف الأساسية لـ </span><code>Terraform</code><span>، لكن مش بييجي معاه الكود بتاع أي </span><code>provider</code><span> من الـ </span><code>providers</code><span> (زي </span><code>AWS Provider</code><span>, </span><code>Azure provider</code><span>, </span><code>GCP provider</code><span>, إلخ)، فلما تبدأ لأول مرة تستخدم </span><code>Terraform</code><span>، لازم تشغل </span><code>terraform init</code><span> عشان تقول لـ </span><code>Terraform</code><span> يعمل </span><code>scan</code><span> للكود، ويشوف إيه الـ </span><code>providers</code><span> اللي بتستخدمها، وينزل الكود بتاعهم. بشكل افتراضي، الكود بتاع الـ </span><code>provider</code><span> بينزل في فولدر اسمه </span><code>.terraform</code><span>، وده الـ </span><code>scratch directory</code><span> بتاع </span><code>Terraform</code><span> (ممكن تحطه في </span><code>.gitignore</code><span>). </span><code>Terraform</code><span> كمان بيسجل معلومات عن كود الـ </span><code>provider</code><span> اللي نزله في ملف اسمه </span><code>.terraform.lock.hcl</code><span> (هتتعلم أكتر عن الملف ده في &quot;Versioned Modules&quot;). هتشوف استخدامات تانية لأمر </span><code>init</code><span> وفولدر </span><code>.terraform</code><span> في فصول جاية. دلوقتي، بس خد بالك إنك لازم تشغل </span><code>init</code><span> أي وقت بتبدأ فيه كود </span><code>Terraform</code><span> جديد، وإن آمن إنك تشغل </span><code>init</code><span> كذا مرة (الأمر </span><code>idempotent</code><span>).</span></p><div class="md-alert md-alert-tip tip"><p><span class='md-alert-text md-alert-text-tip'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</span><br></p><p><span>خلينا نوضح دور ملف </span><code>.terraform.lock.hcl</code><span> </span></p><p><span>تخيل معايا السيناريو ده عشان نفهم المشكلة اللي الملف ده بيحلها:</span></p><p><strong><span>السيناريو: فريق شغال من غير ملف الـ </span><code>.lock</code></strong></p><ol start='' ><li><p><strong><span>أنت (يوم الأحد):</span></strong><span> بتبدأ مشروع </span><code>Terraform</code><span> جديد. في ملف </span><code>main.tf</code><span> بتاعك، أنت قلت إنك عايز تستخدم الـ </span><code>AWS provider</code><span>. لما بتشغل </span><code>terraform init</code><span>، </span><code>Terraform</code><span> بيروح على الإنترنت ويدور على أحدث </span><code>version</code><span> من الـ </span><code>AWS provider</code><span> وينزلها. لنفترض إنها كانت </span><code>version 5.30.0</code><span>. الدنيا عندك شغالة تمام.</span></p></li><li><p><strong><span>زميلك (يوم الأربعاء):</span></strong><span> زميلك بيعمل </span><code>pull</code><span> للكود بتاعك (اللي مفيهوش ملف </span><code>.lock</code><span>). هو كمان بيشغل </span><code>terraform init</code><span>. في الوقت ده، شركة </span><code>HashiCorp</code><span> كانت نزلت </span><code>version</code><span> جديدة من الـ </span><code>AWS provider</code><span>، ولنفترض إنها </span><code>5.31.0</code><span>. </span><code>Terraform</code><span> عند زميلك هينزل الـ </span><code>version</code><span> الجديدة دي.</span></p></li><li><p><strong><span>الـ </span><code>CI/CD Server</code><span> (يوم الجمعة):</span></strong><span> الـ </span><code>pipeline</code><span> بتاعكم بيشتغل عشان يعمل </span><code>deploy</code><span> أوتوماتيك. هو كمان بيعمل </span><code>init</code><span> من الصفر. في الوقت ده، ممكن تكون نزلت </span><code>version 5.32.0</code><span>!</span></p></li></ol><p><strong><span>إيه المشكلة هنا؟</span></strong>
<span>المشكلة إنكم </span><strong><span>تلاتة بتشتغلوا على نفس الكود، بس كل واحد فيكم بيستخدم </span><code>version</code><span> مختلفة من &quot;الأدوات&quot; (الـ </span><code>provider</code><span>)</span></strong><span>.</span></p><p><span>ده ممكن يسبب كوارث:</span></p><ul><li><p><strong><span>نتائج غير متوقعة:</span></strong><span> ممكن </span><code>version 5.31.0</code><span> تكون غيرت سلوك </span><code>resource</code><span> معين بشكل بسيط. فالـ </span><code>plan</code><span> اللي بيطلع عندك بقى مختلف عن الـ </span><code>plan</code><span> اللي بيطلع عند زميلك، مع إنكم الاتنين بتستخدموا نفس الكود!</span></p></li><li><p><strong><span>أخطاء مفاجئة:</span></strong><span> ممكن </span><code>version 5.32.0</code><span> تكون فيها </span><code>breaking change</code><span> (تغيير جذري مش متوافق مع اللي قبله). فجأة، الكود اللي كان شغال تمام عندك وعند زميلك، بقى بيدي </span><code>error</code><span> على الـ </span><code>CI/CD server</code><span> ومحدش فاهم ليه.</span></p></li><li><p><strong><span>&quot;شغالة على جهازي!&quot;:</span></strong><span> هترجعوا تاني لمشكلة الـ </span><code>DevOps</code><span> الكلاسيكية دي.</span></p></li></ul><h3 id='الحل-دور-وأهمية-ملف-terraformlockhcl'><strong><span>الحل: دور وأهمية ملف </span><code>.terraform.lock.hcl</code></strong></h3><p><span>ملف الـ </span><code>lock</code><span> هو  &quot;القفل&quot; اللي الفريق كله والـ </span><code>automation</code><span> بيمشوا عليه. هو اللي بيضمن إن كل الناس بتستخدم </span><strong><span>نفس الـ </span><code>version</code><span> بالظبط</span></strong><span> من كل </span><code>provider</code><span>.</span></p><p><strong><span>بيشتغل إزاي؟</span></strong></p><ol start='' ><li><p><strong><span>أول مرة بتشغل </span><code>init</code><span>:</span></strong><span> </span><code>Terraform</code><span> بيشوف إيه الـ </span><code>providers</code><span> اللي أنت محتاجها، بينزل أحدث </span><code>version</code><span> متوافقة، وبعدين بيسجل الـ </span><code>version</code><span> دي بالظبط في ملف </span><code>.terraform.lock.hcl</code><span>. مش بس بيسجل رقم الـ </span><code>version</code><span>، ده كمان بيسجل حاجة اسمها </span><code>hash</code><span> (digital signature ) عشان يتأكد إن الملف اللي نزله هو الملف الأصلي ومحدش لعب فيه.</span>
<span>شكل الملف من جوه بيبقى حاجة زي كده:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0231px; left: 7.63019px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># This file is maintained automatically by "terraform init".</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># Manual edits may be lost in future updates.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">provider "registry.terraform.io/hashicorp/aws" {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  version &nbsp; &nbsp; = "5.30.0"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  constraints = "&gt;= 5.30.0"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  hashes = [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "h1:Abc...",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "h1:Xyz...",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 246px;"></div><div class="CodeMirror-gutters" style="display: none; height: 246px;"></div></div></div></pre><ol start='3' ><li><p><strong><span>بتعمل </span><code>commit</code><span> للملف ده في </span><code>Git</code><span>:</span></strong><span> دي أهم خطوة. أنت كده بتشارك &quot;الاتفاق&quot; ده مع باقي الفريق.</span></p></li><li><p><strong><span>لما زميلك أو الـ </span><code>CI/CD</code><span> بيشغل </span><code>init</code><span>:</span></strong><span> </span><code>Terraform</code><span> أول حاجة بيبص عليها هو ملف </span><code>.terraform.lock.hcl</code><span>. لو لقاه، مش بيروح يدور على أحدث </span><code>version</code><span> ولا حاجة. هو بيقول: &quot;تمام، الفريق اتفق إنه هيستخدم </span><code>AWS provider version 5.30.0</code><span>. أنا هنزل النسخة دي بالظبط.&quot;</span></p></li></ol><h3 id='أهميته-في-3-نقط'><strong><span>أهميته في 3 نقط</span></strong></h3><ol start='' ><li><p><strong><span>(</span><code>Consistency &amp; Predictability</code><span>):</span></strong><span> بيضمن إن كل أعضاء الفريق وكل الـ </span><code>automation pipelines</code><span> بيستخدموا نفس نسخة الـ </span><code>provider</code><span> بالمللي. ده معناه إن الـ </span><code>plan</code><span> اللي بيطلع عندك هو نفسه اللي هيطلع عند أي حد تاني.</span></p></li><li><p><strong><span>منع المفاجآت (</span><code>Preventing Unexpected Changes</code><span>):</span></strong><span> بيحميك من إن </span><code>update</code><span> جديد في </span><code>provider</code><span> معين يبوظلك الدنيا فجأة من غير ما تاخد بالك. لو عايز تعمل </span><code>upgrade</code><span> للـ </span><code>provider</code><span>، بتعمله بشكل واعي ومقصود (عن طريق أمر </span><code>terraform init -upgrade</code><span>).</span></p></li><li><p><strong><span>الأمان (</span><code>Security</code><span>):</span></strong><span> الـ </span><code>hashes</code><span> اللي جوه الملف بتتأكد إن الـ </span><code>provider</code><span> اللي </span><code>Terraform</code><span> بينزله هو نفسه اللي </span><code>HashiCorp</code><span> عملتله </span><code>release</code><span>، ومفيش أي طرف في النص غيره أو inject فيه كود خبيث (</span><code>man-in-the-middle attack</code><span>).</span></p></li></ol><p><strong><span>عشان كده، القاعدة الذهبية هي: ملف </span><code>.terraform.lock.hcl</code><span> لازم </span></strong><span>دايمًا</span><strong><span>يتعمله </span><code>commit</code><span> في الـ </span><code>version control</code><span> مع باقي ملفات الكود بتاعتك. هو جزء لا يتجزأ من الكود بتاعك زيه زي ملف </span><code>main.tf</code><span> بالظبط.</span></strong></p></div><p><span>دلوقتي بعد ما نزلت كود الـ </span><code>provider</code><span>، شغل أمر </span><code>terraform plan</code><span>:</span></p><div class="md-alert md-alert-important important"><p><span class='md-alert-text md-alert-text-important'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</span><br></p><p><span>المثل على قد ما هو تافه بس كل مثلا الكتاب هيطبقة انا عمله </span></p></div><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$ terraform plan</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(...)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Terraform will perform the following actions:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  # aws_instance.example will be created</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  + resource "aws_instance" "example" {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + ami &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = "ami-0fb653ca2d3203ac1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + arn &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + associate_public_ip_address = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + availability_zone &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + cpu_core_count &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + cpu_threads_per_core &nbsp; &nbsp; &nbsp;  = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + get_password_data &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = false</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + host_id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + instance_state &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + instance_type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = "t2.micro"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + ipv6_address_count &nbsp; &nbsp; &nbsp; &nbsp;  = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + ipv6_addresses &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + key_name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  (...)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Plan: 1 to add, 0 to change, 0 to destroy.</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 537px;"></div><div class="CodeMirror-gutters" style="display: none; height: 537px;"></div></div></div></pre><p><span>أمر </span><code>plan</code><span> بيخليك تشوف </span><code>Terraform</code><span> هيعمل إيه قبل ما يعمل أي تغييرات فعلًا. دي طريقة ممتازة عشان تعمل </span><code>sanity-check</code><span> للكود بتاعك قبل ما تطلقه على العالم. الـ </span><code>output</code><span> بتاع أمر </span><code>plan</code><span> شبه الـ </span><code>output</code><span> بتاع أمر </span><code>diff</code><span> اللي هو جزء من </span><code>Unix</code><span>, </span><code>Linux</code><span>, و </span><code>git</code><span>: أي حاجة جنبها علامة زائد (</span><code>+</code><span>) هتتعمل، أي حاجة جنبها علامة ناقص (</span><code>–</code><span>) هتتمسح، وأي حاجة جنبها علامة التيلدا (</span><code>~</code><span>) هتتعدل </span><code>in place</code><span>.</span>
<span>في الـ </span><code>output</code><span> اللي فات، تقدر تشوف إن </span><code>Terraform</code><span> بيخطط إنه يعمل </span><code>EC2 Instance</code><span> واحد ومفيش حاجة تانية، وده بالظبط اللي أنت عايزه.</span></p><p><span>عشان تعمل الـ </span><code>Instance</code><span> فعلًا، شغل أمر </span><code>terraform apply</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0231px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$ terraform apply</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(...)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Plan: 1 to add, 0 to change, 0 to destroy.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Do you want to perform these actions?</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Terraform will perform the actions described above.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Only 'yes' will be accepted to approve.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Enter a value:</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 202px;"></div><div class="CodeMirror-gutters" style="display: none; height: 202px;"></div></div></div></pre><p><span>هتلاحظ إن أمر </span><code>apply</code><span> بيوريك نفس الـ </span><code>plan output</code><span> وبيطلب منك تأكيد إذا كنت عايز فعلًا تكمل في الـ </span><code>plan</code><span> دي. فعشان كده، مع إن </span><code>plan</code><span> متاح كأمر منفصل، هو مفيد بشكل أساسي للـ </span><code>sanity checks</code><span> السريعة وأثناء الـ </span><code>code reviews</code><span> (وده موضوع هتشوفه أكتر في الفصل العاشر)، وفي معظم الوقت أنت هتشغل </span><code>apply</code><span> مباشرة وتراجع الـ </span><code>plan output</code><span> اللي هو بيوريهولك.</span></p><p><span>اكتب </span><code>yes</code><span> ودوس </span><code>Enter</code><span> عشان تعمل </span><code>deploy</code><span> للـ </span><code>EC2 Instance</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0231px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Do you want to perform these actions?</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Terraform will perform the actions described above.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Only 'yes' will be accepted to approve.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Enter a value: yes</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">aws_instance.example: Creating...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">aws_instance.example: Still creating... [10s elapsed]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">aws_instance.example: Still creating... [20s elapsed]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">aws_instance.example: Still creating... [30s elapsed]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">aws_instance.example: Creation complete after 38s [id=i-07e2a3e006d785906]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Apply complete! Resources: 1 added, 0 changed, 0 destroyed.</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 291px;"></div><div class="CodeMirror-gutters" style="display: none; height: 291px;"></div></div></div></pre><p><span>مبروك! أنت لسة عامل </span><code>deploy</code><span> لـ </span><code>EC2 Instance</code><span> في الـ </span><code>AWS account</code><span> بتاعك باستخدام </span><code>Terraform</code><span>! عشان تتأكد، روح على الـ </span><code>EC2 console</code><span> والمفروض تشوف...</span></p><p>&nbsp;</p><p><img src="imgs/image-20250615112159531.png" referrerpolicy="no-referrer" alt="image-20250615112159531"></p><p>&nbsp;</p><p><span>وفعلًا، الـ </span><code>Instance</code><span> موجودة، بس بصراحة، المثال ده مش ممتع أوي. يلا نخليه أحسن شوية. أولًا، خد بالك إن الـ </span><code>EC2 Instance</code><span> معلهاش اسم. عشان تضيفلها اسم، تقدر تضيف </span><code>tags</code><span> للـ </span><code>resource</code><span> اللي اسمه </span><code>aws_instance</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0231px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_instance"</span> <span class="cm-string">"example"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ami</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"ami-0fb653ca2d3203ac1"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">instance_type</span> <span class="cm-operator">=</span> <span class="cm-string">"t2.micro"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">tags</span> <span class="cm-operator">=</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag">Name</span> <span class="cm-operator">=</span> <span class="cm-string">"terraform-example"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 179px;"></div><div class="CodeMirror-gutters" style="display: none; height: 179px;"></div></div></div></pre><p><span>شغل </span><code>terraform apply</code><span> تاني عشان تشوف ده هيعمل إيه:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">$ </span><span class="cm-variable">terraform</span> <span class="cm-variable">apply</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">aws_instance</span><span class="cm-operator">.</span><span class="cm-atom">example:</span> <span class="cm-tag">Refreshing</span> <span class="cm-variable">state</span><span class="cm-operator">...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-operator">...</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">Terraform</span> <span class="cm-variable">will</span> <span class="cm-variable">perform</span> <span class="cm-variable">the</span> <span class="cm-variable">following</span> <span class="cm-atom">actions:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># aws_instance.example will be updated in-place</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-operator">~</span> <span class="cm-variable">resource</span> <span class="cm-string">"aws_instance"</span> <span class="cm-string">"example"</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">ami</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"ami-0fb653ca2d3203ac1"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">availability_zone</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"us-east-2b"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">instance_state</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-string">"running"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  (<span class="cm-operator">...</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-operator">+</span> <span class="cm-variable">tags</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">+</span> <span class="cm-string">"Name"</span> <span class="cm-operator">=</span> <span class="cm-string">"terraform-example"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  (<span class="cm-operator">...</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">Plan:</span> <span class="cm-number">0</span> <span class="cm-variable">to</span> <span class="cm-variable">add</span>, <span class="cm-number">1</span> <span class="cm-variable">to</span> <span class="cm-variable">change</span>, <span class="cm-number">0</span> <span class="cm-variable">to</span> <span class="cm-variable">destroy</span><span class="cm-operator">.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-property">Do</span> <span class="cm-variable">you</span> <span class="cm-variable">want</span> <span class="cm-variable">to</span> <span class="cm-variable">perform</span> <span class="cm-variable">these</span> <span class="cm-variable">actions?</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag">Terraform</span> <span class="cm-variable">will</span> <span class="cm-variable">perform</span> <span class="cm-variable">the</span> <span class="cm-variable">actions</span> <span class="cm-variable">described</span> <span class="cm-variable">above</span><span class="cm-operator">.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-property">Only</span> <span class="cm-string">'yes'</span> <span class="cm-variable">will</span> <span class="cm-variable">be</span> <span class="cm-variable">accepted</span> <span class="cm-variable">to</span> <span class="cm-variable">approve</span><span class="cm-operator">.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-property">Enter</span> <span class="cm-variable">a</span> <span class="cm-atom">value:</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 537px;"></div><div class="CodeMirror-gutters" style="display: none; height: 537px;"></div></div></div></pre><p><span>تيرافورم عنده ملف مهم جدًا اسمه الـ </span><strong><span>State File</span></strong><span>، ده يعتبر </span><strong><span>الخريطة</span></strong><span> بتاعته اللي بتربط بين الكود اللي انت كاتبه والـ resources الحقيقية اللي بناها في الكلاود، كل حاجة بيعملها بيجري يسجلها في الخريطة دي عشان يبقى عارف إن الـ resource ده تبعه وهو المسؤول عنه. فلما بتيجي تشغل أمر apply تاني، هو مش بيبدأ من الصفر، لأ ده بيمسك الخريطة بتاعته الأول ويكلّم الكلاود عشان يتأكد إن كل حاجة متسجلة عنده لسه على أرض الواقع ومحدش غير فيها حاجة، ودي هي خطوة Refreshing state… اللي بتشوفها. بعد ما بيطمن، بيعمل المقارنة المهمة، بيشوف إيه اللي انت عايزه في الكود، وإيه اللي موجود فعلًا على الكلاود، والفرق اللي بيطلعه ده هو &quot;Terraform Plan&quot; اللي بيعرضها عليك. في الحالة بتاعتك، هو لقى الـ Instance موجودة فعلًا عشان هي متسجلة في الخريطة بتاعته، بس ناقصها الـ Tag بتاع Name اللي انت لسه ضايفه في الكود، عشان كده Terraform Plan بتاعته كانت ذكية جدًا ومقتصرة على إنه هيزود الـ Tag ده بس، مش هيهد حاجة ويبنيها من جديد، ودي هي قوة تيرافورم، انت بتوصفله الشكل النهائي اللي عايزه وهو بيتصرف ويوصلك ليه بأقل مجهود وتغيير ممكن، فلما قالك هزودلك الـ Tag بس، هو كده عمل الصح، تكتب yes وإنت متطمن.</span></p><p><span>لما تعمل </span><code>refresh</code><span> للـ </span><code>EC2 console</code><span> بتاعتك، هتشوف حاجة شبه شكل 2-5.</span></p><p><img src="imgs/image-20250615120039358.png" referrerpolicy="no-referrer" alt="image-20250615120039358"></p><p>&nbsp;</p><p><span>دلوقتي بعد ما بقى عندك شوية كود </span><code>Terraform</code><span> شغال، هتبقى عايز تخزنه في </span><code>version control</code><span>. ده بيسمحلك إنك تشارك الـ </span><code>code</code><span> بتاعك مع باقي أعضاء الفريق، وتتتبع تاريخ كل تغييرات الـ </span><code>infrastructure</code><span>، وتستخدم الـ </span><code>commit log</code><span> عشان تعمل </span><code>debugging</code><span>. على سبيل المثال، ده إزاي ممكن تعمل </span><code>Git repository local</code><span>) وتستخدمه عشان تخزن ملف الـ </span><code>Terraform configuration</code><span> بتاعك وملف الـ </span><code>lock</code><span> (هتتعلم كل حاجة عن ملف الـ </span><code>lock</code><span> في الفصل التامن (</span><code>Chapter 8</code><span>)؛ دلوقتي، كل اللي محتاج تعرفه هو إنه لازم يتضاف للـ </span><code>version control</code><span> مع الكود بتاعك):</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> init</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> add main.tf .terraform.lock.hcl</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> commit <span class="cm-attribute">-m</span> <span class="cm-string">"Initial commit"</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 67px;"></div><div class="CodeMirror-gutters" style="display: none; height: 67px;"></div></div></div></pre><p><span>المفروض كمان تعمل ملف </span><code>.gitignore</code><span> بالمحتويات دي:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">.terraform</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">*.tfstate</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">*.tfstate.backup</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 67px;"></div><div class="CodeMirror-gutters" style="display: none; height: 67px;"></div></div></div></pre><p><span>ملف الـ </span><code>.gitignore</code><span> اللي فوق ده بيدي تعليمات لـ </span><code>Git</code><span> إنه يعمل </span><code>ignore</code><span> لفولدر </span><code>.terraform</code><span>، اللي </span><code>Terraform</code><span> بيستخدمه كـ </span><code>scratch directory</code><span> مؤقت، وكمان ملفات الـ </span><code>*.tfstate</code><span>، اللي </span><code>Terraform</code><span> بيستخدمها عشان يخزن الـ </span><code>state</code><span> (في الفصل التالت (</span><code>Chapter 3</code><span>)، هتشوف ليه ملفات الـ </span><code>state</code><span> المفروض متتحطش في الـ </span><code>version control</code><span>). المفروض تعمل </span><code>commit</code><span> لملف الـ </span><code>.gitignore</code><span> هو كمان:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> add .gitignore</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> commit <span class="cm-attribute">-m</span> <span class="cm-string">"Add a .gitignore file"</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>عشان تشارك الكود ده مع زمايلك في الفريق، هتبقى عايز تعمل </span><code>Git repository</code><span> مشترك تقدروا كلكم توصلوا له. طريقة عشان تعمل ده هي إنك تستخدم </span><code>GitHub</code><span>. روح على </span><code>GitHub</code><span>، اعمل </span><code>account</code><span> لو معندكش واحد، واعمل </span><code>repository</code><span> جديد. اعمل </span><code>configure</code><span> للـ </span><code>Git repository</code><span> المحلي بتاعك عشان يستخدم الـ </span><code>GitHub repository</code><span> الجديد كـ </span><code>remote endpoint</code><span> اسمه </span><code>origin</code><span>، بالشكل ده:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> remote add origin <span class="cm-builtin">git</span>@github.com:&lt;YOUR_USERNAME&gt;/&lt;YOUR_REPO_NAME&gt;.git</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>دلوقتي، أي وقت تحب تشارك الـ </span><code>commits</code><span> بتاعتك مع زمايلك، تقدر تعملهم </span><code>push</code><span> على </span><code>origin</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> push origin main</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>وأي وقت تحب تشوف التغييرات اللي زمايلك عملوها، تقدر تعملهم </span><code>pull</code><span> من </span><code>origin</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> pull origin main</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>وأنت ماشي في باقي الكتاب، وأنت بتستخدم </span><code>Terraform</code><span> عمومًا، اتأكد إنك بتعمل </span><code>git commit</code><span> و </span><code>git push</code><span> للتغييرات بتاعتك بانتظام. بالطريقة دي، مش بس هتقدر تتعاون مع أعضاء الفريق على الكود ده، لكن كمان كل تغييرات الـ </span><code>infrastructure</code><span> بتاعتك هتكون متسجلة في الـ </span><code>commit log</code><span>، ودي حاجة مفيدة جدًا للـ </span><code>debugging</code><span>. هتتعلم أكتر عن استخدام </span><code>Terraform</code><span> كفريق في الفصل العاشر (</span><code>Chapter 10</code><span>).</span></p><p>&nbsp;</p><h2 id='deploy-لـ-single-web-server'><strong><code>Deploy</code><span> لـ </span><code>single web server</code></strong></h2><p><span>الخطوة الجاية هي إننا نشغّل </span><code>web server</code><span> على الـ </span><code>Instance</code><span> دي. الهدف هو إننا نعمل </span><code>deploy</code><span> لأبسط </span><code>web architecture</code><span> ممكنة: </span><code>web server</code><span> واحد يقدر يستجيب لطلبات الـ </span><code>HTTP</code><span>، زي ما هو واضح في شكل 2-6.</span></p><p><img src="imgs/image-20250615141005122.png" referrerpolicy="no-referrer" alt="image-20250615141005122"></p><p>&nbsp;</p><p><span>في حالة استخدام حقيقية في الشغل (</span><code>real-world use case</code><span>)، أنت غالبًا هتبني الـ </span><code>web server</code><span> باستخدام </span><code>web framework</code><span> زي </span><code>Ruby on Rails</code><span> أو </span><code>Django</code><span>، بس عشان نخلي المثال ده بسيط، يلا نشغل </span><code>web server</code><span> بسيط جدًا (</span><code>dirt-simple</code><span>) بيرجع دايمًا نص &quot;Hello, World&quot;:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#!/bin/bash</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">echo</span> <span class="cm-string">"Hello, World"</span> &gt; index.xhtml</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nohup busybox httpd <span class="cm-attribute">-f</span> <span class="cm-attribute">-p</span> <span class="cm-number">8080</span> &amp;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 67px;"></div><div class="CodeMirror-gutters" style="display: none; height: 67px;"></div></div></div></pre><p><span>ده </span><code>Bash script</code><span> بيكتب نص &quot;Hello, World&quot; في ملف اسمه </span><code>index.xhtml</code><span> وبيشغل أداة اسمها </span><code>busybox</code><span> (ودي بتبقى نازلة أصلًا على </span><code>Ubuntu</code><span>) عشان يقوّم </span><code>web server</code><span> على </span><code>port 8080</code><span> عشان يعرض الملف ده. أنا حطيت الأمر بتاع </span><code>busybox</code><span> مع </span><code>nohup</code><span> وعلامة الأمبرساند (</span><code>&amp;</code><span>) عشان الـ </span><code>web server</code><span> يفضل شغال في الخلفية على طول، في حين إن الـ </span><code>Bash script</code><span> نفسه يقدر يقفل.</span></p><blockquote><p><strong><span>أرقام البورتات (</span><code>PORT NUMBERS</code><span>)</span></strong></p><p><span>السبب إن المثال ده بيستخدم </span><code>port 8080</code><span>، بدل </span><code>port 80</code><span> الافتراضي بتاع الـ </span><code>HTTP</code><span>، هو إنك عشان &quot;listen&quot; على أي </span><code>port</code><span> رقمه أقل من 1024، بتبقى محتاج صلاحيات </span><code>root user</code><span> (صلاحيات المدير). دي تعتبر مخاطرة أمنية لأن أي </span><code>attacker</code><span> هيقدر يخترق السيرفر بتاعك هياخد صلاحيات الـ </span><code>root</code><span> هو كمان.</span></p><p><span>عشان كده، الـ </span><code>best practice</code><span> هي إنك تشغل الـ </span><code>web server</code><span> بتاعك بـ </span><code>user</code><span> عادي مش </span><code>root</code><span> ليه صلاحيات محدودة. ده معناه إنك لازم تستخدم </span><code>ports</code><span> أرقامها أعلى، بس زي ما هتشوف بعدين في الفصل ده، أنت ممكن تظبط </span><code>load balancer</code><span> يستقبل الـ </span><code>traffic</code><span> على </span><code>port 80</code><span> ويوجهه للـ </span><code>ports</code><span> العالية على السيرفرات بتاعتك.</span></p></blockquote><p><span>طب إزاي تخلي الـ </span><code>EC2 Instance</code><span> تشغل الـ </span><code>script</code><span> ده؟ في العادي، زي ما اتناقشنا في &quot;أدوات الـ </span><code>Server Templating</code><span>&quot;، أنت هتستخدم أداة زي </span><code>Packer</code><span> عشان تعمل </span><code>AMI</code><span> مخصوصة يكون الـ </span><code>web server</code><span> متسطب عليها. بما إن الـ </span><code>web server</code><span> الأهبل اللي في المثال ده هو مجرد سطر واحد بيستخدم </span><code>busybox</code><span>، أنت ممكن تستخدم </span><code>AMI</code><span> بتاعة </span><code>Ubuntu 20.04</code><span> العادية وتشغل الـ </span><code>script</code><span> بتاع &quot;Hello, World&quot; كجزء من </span><code>configuration</code><span> اسمه </span><code>User Data</code><span> بتاع الـ </span><code>EC2 Instance</code><span>. لما بتشغل </span><code>EC2 Instance</code><span>، عندك اختيار إنك تمرر يا إما </span><code>shell script</code><span> أو </span><code>cloud-init directive</code><span> للـ </span><code>User Data</code><span>، والـ </span><code>EC2 Instance</code><span> هتنفذه في أول مرة بس بتقوم فيها (</span><code>very first boot</code><span>). أنت بتمرر </span><code>shell script</code><span> للـ </span><code>User Data</code><span> عن طريق إنك تظبط الـ </span><code>argument</code><span> اللي اسمه </span><code>user_data</code><span> في كود </span><code>Terraform</code><span> بتاعك بالشكل ده:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_instance"</span> <span class="cm-string">"example"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ami</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"ami-0fb653ca2d3203ac1"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">instance_type</span> <span class="cm-operator">=</span> <span class="cm-string">"t2.micro"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">user_data_replace_on_change</span> <span class="cm-operator">=</span> <span class="cm-keyword">true</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">tags</span> <span class="cm-operator">=</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag">Name</span> <span class="cm-operator">=</span> <span class="cm-string">"terraform-example"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">user_data</span> <span class="cm-operator">=</span> <span class="cm-string">&lt;&lt;-EOF</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  #!/bin/bash</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  echo "Hello, World" &gt; index.xhtml</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  nohup busybox httpd -f -p 8080 &amp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  EOF</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">}</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 358px;"></div><div class="CodeMirror-gutters" style="display: none; height: 358px;"></div></div></div></pre><p>&nbsp;</p><div class="md-alert md-alert-tip tip"><p><span class='md-alert-text md-alert-text-tip'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</span><br></p><p><span>لما بتشغل سيرفر جديد على الكلاود (زي EC2 instance)، أنت محتاج تديله أوامر عشان يجهز نفسه. فيه طريقتين مشهورين تعمل بيهم كده في الـ </span><code>User Data</code><span>:</span></p><h3 id='1-الـ-shell-script-العادي'><strong><span>1. الـ </span><code>Shell Script</code><span> العادي</span></strong></h3><p><span>ده ببساطة إنك تكتب الأوامر اللي عايزها تتنفذ بالترتيب، واحد ورا التاني، زي ما بتكتبهم في الـ </span><code>terminal</code><span> بالظبط. هو بينفذ اللي بتقوله بالحرف. لو حصل </span><code>error</code><span> في أمر منهم، ممكن يوقف كل حاجة أو يكمل وهو مش فاهم فيبوظ حاجة تانية.</span></p><p><strong><span>الأسلوب ده اسمه </span><code>Imperative</code><span> (أسلوب الأوامر):</span></strong><span> أنت بتقوله &quot;إزاي&quot; يعمل الحاجة خطوة بخطوة.</span></p><h3 id='2-الـ-cloud-init-directive'><strong><span>2. الـ </span><code>cloud-init directive</code></strong></h3><p><span>ده مش مجرد أوامر ورا بعض. ده ملف </span><code>configuration</code><span> بصيغة </span><code>YAML</code><span>، متقسم لأقسام جاهزة (اسمها </span><code>modules</code><span>). بدل ما تكتب الأمر بنفسك، أنت بتحدد &quot;إيه&quot; اللي أنت عايزه في كل قسم، وهو بيتصرف.</span></p><p><span>مثلاً:</span></p><ul><li><p><span>بدل ما تكتب </span><code>apt-get update</code><span>، بتروح على قسم </span><code>package_update</code><span> وتخليه </span><code>true</code><span>.</span></p></li><li><p><span>بدل ما تكتب </span><code>apt-get install nginx</code><span>، بتروح على قسم </span><code>packages</code><span> وتضيف </span><code>nginx</code><span> في لستة.</span></p></li><li><p><span>بدل ما تكتب </span><code>echo &quot;...&quot; &gt; /path/to/file</code><span>، بتروح على قسم </span><code>write_files</code><span> وتحدد اسم الملف ومحتواه.</span></p></li><li><p><span>بدل ما تكتب </span><code>systemctl restart my-service</code><span>، بتروح على قسم </span><code>runcmd</code><span> وتحط الأمر ده.</span></p></li></ul><p><strong><span>الأسلوب ده اسمه </span><code>Declarative</code><span>:</span></strong><span> أنت بتوصف الحالة النهائية اللي عايز السيرفر يوصلها، وبتسيب </span><code>cloud-init</code><span> يوصلها بالطريقة الصح.</span></p><p><strong><span>إيه هو </span><code>cloud-init</code><span> أصلًا؟</span></strong></p><p><code>cloud-init</code><span> ده برنامج بيكون متسطب جاهز على معظم صور الـ </span><code>Linux</code><span> الرسمية (الـ </span><code>AMIs</code><span>). وظيفته إنه أول ما السيرفر يقوم لأول مرة، يقرأ التعليمات اللي في الـ </span><code>User Data</code><span> وينفذها بذكاء.</span></p><p><strong><span>ليه هو أذكى وأقوى من الـ </span><code>Shell Script</code><span> العادي؟</span></strong></p><ol start='' ><li><p><strong><span>التنظيم والهيكلة:</span></strong><span> ملف </span><code>YAML</code><span> واضح ومتقسم، أسهل في القراية والصيانة من </span><code>script</code><span> طويل كله أوامر سايحة على بعض.</span></p></li><li><p><strong><span>إمكانيات مدمجة (</span><code>modules</code><span>):</span></strong><span> بيقدم &quot;وحدات&quot; جاهزة بتعمل أشهر المهام من غير ما تكتب الكود بنفسك، زي:</span></p><ul><li><p><span>تسطيب برامج (</span><code>packages</code><span>).</span></p></li><li><p><span>تحديث النظام (</span><code>package_update</code><span>, </span><code>package_upgrade</code><span>).</span></p></li><li><p><span>إنشاء </span><code>users</code><span> و </span><code>groups</code><span>.</span></p></li><li><p><span>كتابة ملفات (</span><code>write_files</code><span>).</span></p></li><li><p><span>تغيير الـ </span><code>hostname</code><span>.</span></p></li><li><p><span>إضافة </span><code>SSH keys</code><span>.</span></p></li><li><p><span>تشغيل أوامر معينة (</span><code>runcmd</code><span>).</span></p></li><li><p><span>وحاجات تانية كتير.</span></p></li></ul></li><li><p><strong><span>الذكاء والـ </span><code>Idempotence</code><span>:</span></strong><span> بعض الـ </span><code>modules</code><span> بتاعته، لو شغلتها تاني بالغلط، بتشوف إن الشغل اتعمل خلاص ومبتعملش حاجة تانية. ده بيحميك من مشاكل ممكن تحصل لو </span><code>script</code><span> عادي اشتغل مرتين.</span></p></li></ol><hr /><h3 id='مثال-عملي-الفرق-بين-الطريقتين'><strong><span>مثال عملي: الفرق بين الطريقتين</span></strong></h3><p><strong><span>الطريقة الأولى: </span><code>Shell Script</code><span> في الـ </span><code>User Data</code></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.63019px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">user_data = &lt;&lt;-EOF</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  #!/bin/bash</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  apt-get update -y</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  apt-get upgrade -y</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  apt-get install -y nginx git</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  echo "&lt;h1&gt;Hello from my web server!&lt;/h1&gt;" &gt; /var/www/html/index.html</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  systemctl start nginx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  systemctl enable nginx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  EOF</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 224px;"></div><div class="CodeMirror-gutters" style="display: none; height: 224px;"></div></div></div></pre><p><span>شغال وزي الفل، بس سايح على بعضه.</span></p><p><span>**الطريقة الثانية: </span><code>cloud-init directive</code><span> </span></p><p><span>عشان تستخدمه، لازم تبدأ الـ </span><code>User Data</code><span> بتاعك بـ </span><code>#cloud-config</code><span>.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.63019px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">user_data = &lt;&lt;-EOF</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  #cloud-config</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  package_update: true</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  package_upgrade: true</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  packages:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  - nginx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  - git</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  write_files:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  - path: /var/www/html/index.html</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  owner: root:root</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  permissions: '0644'</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  content: |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;h1&gt;Hello from my web server!&lt;/h1&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  runcmd:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  - [ systemctl, start, nginx ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  - [ systemctl, enable, nginx ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  EOF</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 381px;"></div><div class="CodeMirror-gutters" style="display: none; height: 381px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>شفت الفرق؟</span></strong></p><p><span>الكود التاني (</span><code>cloud-init</code><span>) </span><strong><span>أكثر وضوحًا وتنظيمًا </span></strong><span>. أنت بتوصف اللي أنت عايزه (</span><code>declarative</code><span>) مش بتأمر بخطوات (</span><code>imperative</code><span>).</span></p><p><span>الـ </span><code>cloud-init directive</code><span> هي الطريقة الأحدث والأكثر احترافية وقوة عشان تجهز السيرفرات بتاعتك أول ما تقوم. بتديلك طريقة </span><code>declarative</code><span> منظمة باستخدام </span><code>YAML</code><span>، وده بيخلي المهام المعقدة أسهل في الكتابة والقراءة و maintance، بدل ما تكتب </span><code>shell scripts</code><span> طويلة ومعرضة للأخطاء.</span></p></div><p><span>حاجتين تاخد بالك منهم في الكود اللي فات:</span></p><ul><li><p><span>الـ </span><code>&lt;&lt;-EOF</code><span> و </span><code>EOF</code><span> دول طريقة كتابة في </span><code>Terraform</code><span> اسمها </span><code>heredoc</code><span>، ودي بتسمحلك تكتب كذا سطر ورا بعض من غير ما تحتاج تحط </span><code>\n</code><span> في كل حتة.</span></p></li><li><p><span>الـ </span><code>parameter</code><span> اللي اسمه </span><code>user_data_replace_on_change</code><span> متظبط على </span><code>true</code><span> عشان لما تغير في الـ </span><code>user_data</code><span> وتشغل </span><code>apply</code><span>، </span><code>Terraform</code><span> يهدم الـ </span><code>instance</code><span> الأصلية ويبني واحدة جديدة تمامًا. السلوك الافتراضي بتاع </span><code>Terraform</code><span> هو إنه يحدث الـ </span><code>instance</code><span> الأصلية في مكانها (</span><code>in place</code><span>)، بس بما إن الـ </span><code>User Data</code><span> بيشتغل مرة واحدة بس في أول </span><code>boot</code><span>، والـ </span><code>instance</code><span> بتاعتك الأصلية عدت بعملية الـ </span><code>boot</code><span> دي خلاص، أنت محتاج تجبره يعمل </span><code>instance</code><span> جديدة عشان تضمن إن الـ </span><code>User Data</code><span> </span><code>script</code><span> الجديد بتاعك يتنفذ فعلًا.</span></p></li></ul><p><span>لسه فاضل حاجة واحدة تعملها قبل ما الـ </span><code>web server</code><span> ده يشتغل. بشكل افتراضي، </span><code>AWS</code><span> مش بتسمح بأي </span><code>traffic</code><span> داخل أو خارج من الـ </span><code>EC2 Instance</code><span>. عشان تسمح للـ </span><code>EC2 Instance</code><span> إنها تستقبل </span><code>traffic</code><span> على </span><code>port 8080</code><span>، أنت محتاج تعمل </span><code>security group</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_security_group"</span> <span class="cm-string">"instance"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"terraform-example-instance"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ingress</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">from_port</span> &nbsp; <span class="cm-operator">=</span> <span class="cm-number">8080</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">to_port</span> &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-number">8080</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">protocol</span> &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-string">"tcp"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">cidr_blocks</span> <span class="cm-operator">=</span> [<span class="cm-string">"0.0.0.0/0"</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 224px;"></div><div class="CodeMirror-gutters" style="display: none; height: 224px;"></div></div></div></pre><h3 id='الجزء-الأول-تعريف-الـ-security-group-وتحديد-قواعده'><strong><span>الجزء الأول: تعريف الـ </span><code>Security Group</code><span> وتحديد قواعده</span></strong></h3><p><span>الـ </span><code>Security Group</code><span> هو </span><code>firewall</code><span> افتراضي بيشتغل على مستوى الـ </span><code>EC2 Instance</code><span> عشان يتحكم في الـ </span><code>traffic</code><span> اللي داخل وخارج. الكود ده بيقوم بتعريف </span><code>resource</code><span> من النوع ده.</span></p><ol start='' ><li><p><strong><span>إنشاء الـ </span><code>resource</code><span>:</span></strong></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">resource "aws_security_group" "instance" { ... }</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p>&nbsp;</p><p><span>السطر ده بيعرف </span><code>resource</code><span> جديد من نوع </span><code>aws_security_group</code><span> داخل </span><code>Terraform</code><span>. الاسم </span><code>instance</code><span> هو اسم محلي بنستخدمه عشان نشاور على الـ </span><code>resource</code><span> ده في باقي الكود.</span></p><ol start='2' ><li><p><strong><span>تحديد قواعد الـ </span><code>traffic</code><span>:</span></strong><span> داخل الـ </span><code>block</code><span> </span><code>{...}</code><span>، بنحدد القواعد. في المثال ده، بنعرف قاعدة دخول (</span><code>ingress</code><span>):</span></p></li></ol><ul><li><p><strong><code>cidr_blocks = [&quot;0.0.0.0/0&quot;]</code></strong><span>: دي بتحدد مصدر الـ </span><code>traffic</code><span> المسموح به. القيمة </span><code>0.0.0.0/0</code><span> تعني &quot;أي </span><code>IP address</code><span> على الإنترنت&quot;.</span></p></li><li><p><strong><code>from_port = 8080</code></strong><span> و </span><strong><code>to_port = 8080</code></strong><span>: دي بتحدد الـ </span><code>port</code><span> المسموح باستقبال الـ </span><code>traffic</code><span> عليه.</span></p></li><li><p><strong><code>protocol = &quot;tcp&quot;</code></strong><span>: دي بتحدد نوع البروتوكول المسموح به.</span></p></li></ul><h3 id='الجزء-الثاني-الأهم-إزاي-نربط-الـ-security-group-بالـ-instance'><strong><span>الجزء الثاني (الأهم): إزاي نربط الـ </span><code>Security Group</code><span> بالـ </span><code>Instance</code><span>؟</span></strong></h3><p><span>لغاية دلوقتي، الـ </span><code>Security Group</code><span> اللي اتعرف ده مجرد </span><code>resource</code><span> منفصل. هو مش مطبق على أي </span><code>EC2 Instance</code><span> بشكل تلقائي. لازم نعمل الربط ده بشكل صريح.</span></p><p><strong><span>المشكلة:</span></strong><span> إزاي الـ </span><code>aws_instance</code><span> </span><code>resource</code><span> يعرف إنه المفروض يستخدم الـ </span><code>Security Group</code><span> اللي عملناه؟</span></p><p><span>ماينفعش نستخدم الاسم  </span><code>&quot;instance&quot;</code><span>، لأن ده مجرد </span><code>label</code><span> جوه كود </span><code>Terraform</code><span>. الـ AWS API بيتطلب  (</span><code>unique identifier</code><span>) للـ </span><code>Security Group</code><span>، وهو الـ </span><strong><code>ID</code></strong><span> بتاعه (اللي بيكون شكله </span><code>sg-0123...</code><span>).</span></p><p><strong><span>الحل: استخدام الـ </span><code>Resource Reference</code></strong></p><p><code>Terraform</code><span> بيوفر آلية اسمها </span><code>Resource Reference</code><span> بتخلي الـ </span><code>resources</code><span> تقدر توصل للـ </span><code>attributes</code><span> بتاعة بعضها بشكل ديناميكي.</span></p><p><strong><span>صيغة الـ </span><code>Reference</code><span> بتكون كالتالي:</span></strong></p><p><code>&lt;RESOURCE_TYPE&gt;.&lt;LOCAL_NAME&gt;.&lt;ATTRIBUTE_NAME&gt;</code></p><p><span>لما نطبق الصيغة دي على حالتنا:</span></p><ol start='' ><li><p><strong><code>RESOURCE_TYPE</code></strong><span>: </span><code>aws_security_group</code></p></li><li><p><strong><code>LOCAL_NAME</code></strong><span>: </span><code>instance</code></p></li><li><p><strong><code>ATTRIBUTE_NAME</code></strong><span>: </span><code>id</code></p></li></ol><p><span>فالـ </span><code>reference</code><span> الكامل بيكون: </span><code>aws_security_group.instance.id</code></p><p><strong><span>السطر ده معناه:</span></strong><span> &quot;يا </span><code>Terraform</code><span>، التعبير ده بيشير إلى الـ </span><code>attribute</code><span> اللي اسمه </span><code>id</code><span> والخاص بالـ </span><code>resource</code><span> اللي نوعه </span><code>aws_security_group</code><span> واسمه  </span><code>instance</code><span>&quot;.</span></p><h3 id='الجزء-الثالث-التجميع-النهائي'><strong><span>الجزء الثالث: التجميع النهائي</span></strong></h3><p><span>دلوقتي بنستخدم الـ </span><code>reference</code><span> ده جوه </span><code>resource</code><span> الـ </span><code>aws_instance</code><span> عشان نعمل الربط:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_instance"</span> <span class="cm-string">"example"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">vpc_security_group_ids</span> <span class="cm-operator">=</span> [ <span class="cm-variable">aws_security_group</span><span class="cm-operator">.</span><span class="cm-property">instance</span><span class="cm-operator">.</span><span class="cm-property">id</span> ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>إيه اللي بيحصل هنا؟</span></strong></p><ul><li><p><code>vpc_security_group_ids</code><span>: ده هو الـ </span><code>argument</code><span> في الـ </span><code>aws_instance</code><span> </span><code>resource</code><span> اللي بيستقبل لستة من الـ </span><code>IDs</code><span> بتاعة الـ </span><code>Security Groups</code><span> اللي هتطبق على الـ </span><code>instance</code><span>.</span></p></li><li><p><code>[...]</code><span>: الأقواس دي بتدل على إننا بنمرر </span><code>list</code><span>، وده بيسمح بربط أكتر من </span><code>Security Group</code><span> لو احتجنا.</span></p></li><li><p><code>aws_security_group.instance.id</code><span>: وقت التنفيذ، </span><code>Terraform</code><span> بيستبدل الـ </span><code>reference</code><span> ده بالقيمة الفعلية للـ </span><code>ID</code><span> بتاع الـ </span><code>Security Group</code><span> بعد ما يتم إنشاؤه.</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_instance"</span> <span class="cm-string">"example"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ami</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-string">"ami-0fb653ca2d3203ac1"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">instance_type</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-string">"t2.micro"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">vpc_security_group_ids</span> <span class="cm-operator">=</span> [<span class="cm-variable">aws_security_group</span><span class="cm-operator">.</span><span class="cm-property">instance</span><span class="cm-operator">.</span><span class="cm-property">id</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">user_data_replace_on_change</span> <span class="cm-operator">=</span> <span class="cm-keyword">true</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">tags</span> <span class="cm-operator">=</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag">Name</span> <span class="cm-operator">=</span> <span class="cm-string">"terraform-example"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">user_data</span> <span class="cm-operator">=</span> <span class="cm-string">&lt;&lt;-EOF</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  #!/bin/bash</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  echo "Hello, World" &gt; index.xhtml</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  nohup busybox httpd -f -p 8080 &amp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  EOF</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">}</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 381px;"></div><div class="CodeMirror-gutters" style="display: none; height: 381px;"></div></div></div></pre><p><span>لما بتضيف </span><code>reference</code><span> من </span><code>resource</code><span> للتاني، أنت بتعمل </span><code>implicit dependency</code><span> (اعتمادية ضمنية). </span><code>Terraform</code><span> بيفهم الاعتماديات دي، ويبني منهم </span><code>dependency graph</code><span> ، ويستخدمها عشان يحدد أوتوماتيكيًا هيبني أنهي </span><code>resource</code><span> قبل التاني. على سبيل المثال، لو كنت بتعمل </span><code>deploy</code><span> للكود ده من الصفر، </span><code>Terraform</code><span> كان هيعرف إنه محتاج يعمل الـ </span><code>security group</code><span> قبل الـ </span><code>EC2 Instance</code><span>، لأن الـ </span><code>EC2 Instance</code><span> بتشاور على الـ </span><code>ID</code><span> بتاع الـ </span><code>security group</code><span>. أنت حتى ممكن تخلي </span><code>Terraform</code><span> يوريك خريطة الاعتماديات دي بإنك تشغل أمر </span><code>graph</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$ terraform graph</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">digraph {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  compound = "true"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  newrank = "true"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  subgraph "root" {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "[root] aws_instance.example" [label = "aws_instance.example", shape = "box"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "[root] aws_security_group.instance" [label = "aws_security_group.instance", shape = "box"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "[root] provider.aws" [label = "provider.aws", shape = "diamond"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "[root] aws_instance.example" -&gt; "[root] aws_security_group.instance"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "[root] aws_security_group.instance" -&gt; "[root] provider.aws"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "[root] meta.count-boundary (EachMode fixup)" -&gt; "[root] aws_instance.example"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "[root] provider.aws (close)" -&gt; "[root] aws_instance.example"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "[root] root" -&gt; "[root] meta.count-boundary (EachMode fixup)"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "[root] root" -&gt; "[root] provider.aws (close)"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 426px;"></div><div class="CodeMirror-gutters" style="display: none; height: 426px;"></div></div></div></pre><p><span>الـ </span><code>output</code><span> بلغة  رسوم بيانية اسمها </span><code>DOT</code><span>، اللي ممكن تحولها لصورة، شبه الـ </span><code>dependency graph</code><span> اللي في شكل 2-7، بإنك تستخدم برنامج ديسكتوب زي </span><code>Graphviz</code><span> أو موقع زي </span><code>GraphvizOnline</code><span>.</span></p><p><img src="imgs/image-20250615231153016.png" referrerpolicy="no-referrer" alt="image-20250615231153016"></p><div class="md-alert md-alert-warning warning"><p><span class='md-alert-text md-alert-text-warning'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Warning</span><br></p><p><span>كان من المفترض ان object الخاص بـ security group يمرر ليه vpc هو نسي هنا</span></p><p><span>بس انا خدت باللي </span></p><p><img src="imgs/image-20250615231342057.png" referrerpolicy="no-referrer" alt="image-20250615231342057"></p><p><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSVaxowbtibZQ8zsm_8nQ6XlhbvITUq_Z-C7g&amp;s" referrerpolicy="no-referrer" alt="طيب يا سيدي شكرا كفاية"></p></div><p>&nbsp;</p><p>&nbsp;</p><p><span>عشان تفهم إيه اللي بيحصل لما بتشغل </span><code>terraform apply</code><span>، لازم الأول تفهم إزاي </span><code>Terraform</code><span> بيفكر. </span><code>Terraform</code><span> مش بيقرأ الكود بتاعك سطر بسطر وينفذه بالترتيب زي الـ </span><code>shell script</code><span> العادي. بدل كده، هو بيعمل حاجة أذكى بكتير. أول خطوة بيعملها هي إنه بيبني خريطة لكل الـ </span><code>resources</code><span> اللي عندك وعلاقتها ببعض، الخريطة دي اسمها </span><strong><code>dependency graph</code></strong></p><p><span>الخريطة دي بتتبني إزاي؟ بتتبني من خلال الـ </span><code>references</code><span> اللي أنت كاتبها في الكود. لما كتبت </span><code>vpc_security_group_ids = [aws_security_group.instance.id]</code><span>، أنت بكده قلت لـ </span><code>Terraform</code><span> صراحةً إن الـ </span><code>aws_instance</code><span> </span><code>resource</code><span> بيعتمد على وجود الـ </span><code>aws_security_group</code><span> </span><code>resource</code><span>. بمعنى تاني، الـ </span><code>instance</code><span> مش هينفع تتعمل إلا بعد ما الـ </span><code>security group</code><span> يتعمل الأول والـ </span><code>ID</code><span> بتاعه يكون متاح.</span></p><p><span>بمجرد ما </span><code>Terraform</code><span> يبني الـ </span><code>dependency graph</code><span> الكاملة دي، بيبتدي ينفذ. وهنا بتظهر قوته: أي </span><code>resources</code><span> مش معتمدة على أي حاجة تانية، </span><code>Terraform</code><span> بيقدر يبدأ في إنشائها كلها في نفس الوقت. العملية دي اسمها </span><code>parallel execution</code><span> . هو مش بيستنى حاجة تخلص عشان يبدأ في اللي بعدها إلا لو كانت معتمدة عليها بشكل مباشر. ده بيخلي عملية التنفيذ سريعة وفعالة جدًا.</span></p><p><span>كل ده ممكن يحصل لأن </span><code>Terraform</code><span> لغة </span><strong><code>declarative</code></strong><span> . أنت مش بتقوله &quot;اعمل كذا، ثم اعمل كذا&quot;. أنت بتوصف له &quot;الحالة النهائية&quot; اللي أنت عايز توصلها، وهو اللي بيتولى مهمة التخطيط وتحديد أفضل وأسرع مسار للوصول للحالة دي بناءً على الـ </span><code>dependency graph</code><span>.</span></p><p><span>نيجي بقى للنقطة المهمة: لما تشغل أمر </span><code>apply</code><span> بعد ما تكون عملت تغيير في الكود. في حالتنا، أنت غيرت في الـ </span><code>user_data</code><span>. بسبب إنك كاتب السطر </span><code>user_data_replace_on_change = true</code><span>، أنت قايل لـ </span><code>Terraform</code><span> بشكل صريح: &quot;أي تغيير في محتوى الـ </span><code>user_data</code><span> ده، بيتطلب استبدال الـ </span><code>instance</code><span> بالكامل&quot;.</span></p><p><span>ليه بيعمل استبدال (</span><code>replace</code><span>) ومش مجرد تعديل (</span><code>update</code><span>)؟ لأن AWS API نفسها ماعندهاش طريقة إنها &quot;تعيد تشغيل&quot; الـ </span><code>user_data script</code><span> على </span><code>instance</code><span> شغالة بالفعل. الـ </span><code>user_data</code><span> مصمم إنه يشتغل مرة واحدة بس عند أول </span><code>boot</code><span>. فالطريقة الوحيدة المضمونة عشان تطبق الـ </span><code>script</code><span> الجديد هي إنك تدمر الـ </span><code>instance</code><span> القديمة وتنشئ واحدة جديدة تمامًا بالـ </span><code>script</code><span> الجديد.</span></p><p><span>عشان كده، لما تشغل </span><code>apply</code><span>، </span><code>Terraform</code><span> هيقارن الحالة اللي أنت عايزها (في الكود) بالحالة الفعلية (اللي على AWS)، هيلاقي إن الـ </span><code>user_data</code><span> اتغير، وبناءً على القاعدة اللي أنت حاططها، هيقرر إن الحل هو الاستبدال. فالـ </span><code>plan</code><span> اللي هيعرضهولك هيقول إنه محتاج يعمل </span><code>1 to add, 1 to destroy</code><span>، يعني هينشئ الـ </span><code>instance</code><span> الجديدة الأول، وبعد ما تشتغل ويتأكد إنها تمام، هيدمر القديمة. ده بيضمن إن الخدمة بتاعتك مايحصلش فيها انقطاع كبير. السلوك ده هو أساس مبدأ الـ </span><code>Immutable Infrastructure</code><span> اللي </span><code>Terraform</code><span> بيشجع عليه.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$ terraform apply</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(...)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Terraform will perform the following actions:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  # aws_instance.example must be replaced</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  -/+ resource "aws_instance" "example" {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ami &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  = "ami-0fb653ca2d3203ac1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  ~ availability_zone &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  = "us-east-2c" -&gt; (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  ~ instance_state &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = "running" -&gt; (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  instance_type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  = "t2.micro"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  (...)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + user_data &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  = "c765373..." # forces replacement</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  ~ volume_tags &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  = {} -&gt; (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  ~ vpc_security_group_ids &nbsp; &nbsp; &nbsp; = [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  - "sg-871fa9ec",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ] -&gt; (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  (...)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  # aws_security_group.instance will be created</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  + resource "aws_security_group" "instance" {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + arn &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + description &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  = "Managed by Terraform"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + egress &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + ingress &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  = [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  + {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  + cidr_blocks &nbsp; &nbsp;  = [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  + "0.0.0.0/0",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  + description &nbsp; &nbsp;  = ""</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  + from_port &nbsp; &nbsp; &nbsp;  = 8080</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  + ipv6_cidr_blocks = []</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  + prefix_list_ids  = []</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  + protocol &nbsp; &nbsp; &nbsp; &nbsp; = "tcp"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  + security_groups  = []</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  + self &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = false</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  + to_port &nbsp; &nbsp; &nbsp; &nbsp;  = 8080</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = "terraform-example-instance"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + owner_id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + revoke_rules_on_delete &nbsp; = false</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  + vpc_id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = (known after apply)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Plan: 2 to add, 0 to change, 1 to destroy.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Do you want to perform these actions?</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Terraform will perform the actions described above.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Only 'yes' will be accepted to approve.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Enter a value:</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1187px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1187px;"></div></div></div></pre><p><span>علامة </span><code>- /+</code><span> في الـ </span><code>plan output</code><span> معناها &quot;استبدال&quot; (</span><code>replace</code><span>)؛ دور على جملة &quot;</span><code>forces replacement</code><span>&quot; في الـ </span><code>output</code><span> عشان تعرف إيه اللي بيجبر </span><code>Terraform</code><span> يعمل استبدال. بما إنك ظبطت </span><code>user_data_replace_on_change</code><span> على </span><code>true</code><span> وغيرت الـ </span><code>user_data</code><span> </span><code>parameter</code><span>، ده هيجبره يعمل </span><code>replacement</code><span>، وده معناه إن الـ </span><code>EC2 Instance</code><span> الأصلية هتتمسح (</span><code>terminated</code><span>) وواحدة جديدة تمامًا هتتعمل. ده مثال على مبدأ الـ </span><code>immutable infrastructure</code><span> اللي اتكلمنا عنه في &quot;أدوات الـ </span><code>Server Templating</code><span>&quot;. ويستاهل نذكر إنه أثناء ما الـ </span><code>web server</code><span> بيتبدل، أي مستخدمين للسيرفر ده هيحصلهم </span><code>downtime</code><span> ؛ هتشوف إزاي تعمل </span><code>zero-downtime deployment</code><span> (يعني </span><code>deploy</code><span> من غير ما الخدمة تقع) بـ </span><code>Terraform</code><span> في الفصل الخامس.</span></p><p><span>بما إن الـ </span><code>plan</code><span> شكلها تمام، اكتب </span><code>yes</code><span>، وهتشوف الـ </span><code>EC2 Instance</code><span> الجديدة بتاعتك وهي بتتعمل، زي ما هو واضح في شكل 2-8.</span></p><p>&nbsp;</p><p><img src="imgs/image-20250615232111628.png" referrerpolicy="no-referrer" alt="image-20250615232111628"></p><p>&nbsp;</p><p><span>لو دوست على الـ </span><code>Instance</code><span> الجديدة بتاعتك، هتقدر تلاقي الـ </span><code>public IP address</code><span> بتاعها في لوحة الوصف (</span><code>description panel</code><span>) اللي تحت في الشاشة. ادي للـ </span><code>Instance</code><span> دقيقة أو دقيقتين عشان تقوم، وبعدين استخدم </span><code>web browser</code><span> أو أداة زي </span><code>curl</code><span> عشان تعمل </span><code>HTTP request</code><span> للـ </span><code>IP address</code><span> ده على </span><code>port 8080</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ curl</span> http://&lt;EC2_INSTANCE_PUBLIC_IP&gt;:8080</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Hello, World</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>يا سلام! كده بقى عندك </span><code>web server</code><span> شغال في </span><code>AWS</code><span>!</span></p><blockquote><p><strong><span>أمان الشبكة (</span><code>NETWORK SECURITY</code><span>)</span></strong></p><p><span>عشان نخلي كل الأمثلة في الكتاب ده بسيطة، هي مش بس بتعمل </span><code>deploy</code><span> في الـ </span><code>Default VPC</code><span> بتاعتك (زي ما ذكرنا قبل كده)، لكن كمان بتعمل </span><code>deploy</code><span> في الـ </span><code>default subnets</code><span> بتاعة الـ </span><code>VPC</code><span> دي. الـ </span><code>VPC</code><span> بتتقسم لواحد أو أكتر من الـ </span><code>subnets</code><span>، كل واحد ليه الـ </span><code>IP addresses</code><span> الخاصة بيه. الـ </span><code>subnets</code><span> اللي في الـ </span><code>Default VPC</code><span> كلها </span><code>public subnets</code><span>، وده معناه إنها بتاخد </span><code>IP addresses</code><span> ممكن الوصول ليها من الإنترنت العام. عشان كده أنت قادر تختبر الـ </span><code>EC2 Instance</code><span> بتاعتك من جهازك في البيت.</span></p><p><span>إنك تشغل </span><code>server</code><span> في </span><code>public subnet</code><span> ده كويس كتجربة سريعة، بس في الاستخدام الحقيقي، ده بيعتبر مخاطرة أمنية. الـ </span><code>Hackers</code><span> في كل حتة في العالم بيعملوا </span><code>scan</code><span> على </span><code>IP addresses</code><span> بشكل عشوائي باستمرار عشان يدوروا على أي نقطة ضعف. لو السيرفرات بتاعتك مكشوفة للعامة، كل اللي محتاجه هو إنك تسيب بالغلط </span><code>port</code><span> واحد من غير حماية، أو تشغل كود قديم فيه ثغرة (</span><code>vulnerability</code><span>) معروفة، وحد يقدر يخترق ويدخل.</span></p></blockquote><blockquote><p><span>عشان كده، في أنظمة الـ </span><code>production</code><span>، لازم تعمل </span><code>deploy</code><span> لكل السيرفرات بتاعتك، وبالتأكيد كل الـ </span><code>data stores</code><span> بتاعتك، في </span><code>private subnets</code><span>، اللي ليها </span><code>IP addresses</code><span> لا يمكن الوصول ليها إلا من جوه الـ </span><code>VPC</code><span> نفسها، ومش من الإنترنت العام. السيرفرات الوحيدة اللي المفروض تشغلها في </span><code>public subnets</code><span> هي عدد قليل من الـ </span><code>reverse proxies</code><span> والـ </span><code>load balancers</code><span> اللي بتقفلها وتأمّنها على قد ما تقدر (هتشوف مثال إزاي تعمل </span><code>deploy</code><span> لـ </span><code>load balancer</code><span> بعدين في الفصل ده).</span></p></blockquote><h2 id='deploy-لـ-configurable-web-server'><strong><code>Deploy</code><span> لـ </span><code>configurable web server</code></strong></h2><p><span>ممكن تكون خدت بالك إن كود الـ </span><code>web server</code><span> فيه </span><code>port 8080</code><span> متكرر في الـ </span><code>security group</code><span> وفي الـ </span><code>User Data configuration</code><span> كمان. ده بيخالف مبدأ مهم جدًا اسمه </span><code>Don’t Repeat Yourself (DRY)</code><span> أو &quot;لا تكرر نفسك&quot;: كل معلومة لازم يكون ليها مكان واحد بس واضح وموثوق فيه جوه السيستم. لو عندك رقم الـ </span><code>port</code><span> في مكانين، سهل جدًا إنك تعدله في مكان وتنسى تعدله في المكان التاني.</span></p><p><span>عشان يخليك تقدر تخلي الكود بتاعك </span><code>DRY</code><span> أكتر وقابل للتعديل (</span><code>configurable</code><span>)، </span><code>Terraform</code><span> بيسمحلك تعرّف </span><code>input variables</code><span>. دي طريقة تعريف متغير:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">variable "NAME" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  [CONFIG ...]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 67px;"></div><div class="CodeMirror-gutters" style="display: none; height: 67px;"></div></div></div></pre><p><span>جوه الـ </span><code>variable declaration</code><span> ممكن تحط الـ </span><code>parameters</code><span> الاختيارية دي:</span></p><ul><li><p><strong><code>description</code></strong>
<span>دايمًا فكرة كويسة إنك تستخدم الـ </span><code>parameter</code><span> ده عشان توثق (</span><code>document</code><span>) المتغير ده بيستخدم في إيه. زمايلك في الفريق هيقدروا يشوفوا الوصف ده مش بس وهما بيقروا الكود، لكن كمان وهما بيشغلوا أوامر </span><code>plan</code><span> أو </span><code>apply</code><span> (هتشوف مثال على ده كمان شوية).</span></p></li><li><p><strong><code>default</code></strong>
<span>فيه كذا طريقة تدي بيها قيمة للمتغير، منها إنك تمررها وأنت بتشغل الأمر (</span><code>using the -var option</code><span>)، أو عن طريق ملف (</span><code>using the -var-file option</code><span>)، أو عن طريق </span><code>environment variable</code><span> (</span><code>Terraform</code><span> بيدور على </span><code>environment variables</code><span> بالاسم ده </span><code>TF_VAR_&lt;variable_name&gt;</code><span>). لو مفيش أي قيمة اتبعثت، المتغير هيستخدم القيمة الافتراضية (</span><code>default value</code><span>) دي. لو مفيش قيمة افتراضية، </span><code>Terraform</code><span> هيسأل المستخدم يدخل واحدة وهو شغال. </span>
<span>هشرح بالتفصيل فى النقطة اللي بعدها ازاي المتغيرات بتتمرر فى Terraform</span></p></li></ul><div class="md-alert md-alert-note note"><p><span class='md-alert-text md-alert-text-note'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</span><br></p><p>&nbsp;</p><h3 id='إزاي-terraform-بيلاقي-قيمة-للمتغير'><strong><span>إزاي </span><code>Terraform</code><span> بيلاقي قيمة للمتغير؟ </span></strong></h3><p><span>لما بتعمل متغير في </span><code>Terraform</code><span>، هو بيبدأ رحلة بحث عن قيمته، وبيمشي بترتيب أولويات محدد جدًا عامل زي الهرم. هو بيبدأ من القمة، ولو ملقاش قيمة، بينزل للمستوى اللي بعده، وهكذا.</span></p><p><strong><span>القمة (الأولوية القصوى): وأنت بتشغل الأمر مباشرةً</span></strong></p><p><span>دي أقوى طريقة، وبتعمل </span><code>override</code><span> (بتتجاوز) أي طريقة تانية.</span></p><ol start='' ><li><p><strong><span>باستخدام </span><code>-var</code><span>:</span></strong>
<span>بتقول لـ </span><code>Terraform</code><span> بشكل صريح: &quot;للأمر ده بالذات، استخدم القيمة دي&quot;.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.63019px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">terraform apply -var="server_port=9090"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p>&nbsp;</p><ol start='2' ><li><p><strong><span>باستخدام </span><code>-var-file</code><span>:</span></strong>
<span>لو عندك متغيرات كتير، بتحطهم في ملف (مثلًا </span><code>prod.tfvars</code><span>) وتديه لـ </span><code>Terraform</code><span>.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.63019px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># جوه ملف prod.tfvars:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># server_port = 80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># instance_type = "t2.large"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># في الـ terminal:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">terraform apply -var-file="prod.tfvars"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>المستوى التاني: ملفات المتغيرات الأوتوماتيكية</span></strong></p><p><span>لو </span><code>Terraform</code><span> ملقاش حاجة في الـ </span><code>command line</code><span>، بيروح يدور على ملفات بأسماء معينة ويقرأها أوتوماتيك.</span></p><ul><li><p><strong><span>ملف </span><code>terraform.tfvars</code><span> أو </span><code>auto.tfvars.*</code><span>:</span></strong>
<span>لو عملت ملف بالاسم ده وحطيت فيه قيم المتغيرات، </span><code>Terraform</code><span> هيقرأه لوحده من غير ما تقوله. دي الطريقة المفضلة عشان تحط قيم مختلفة لكل </span><code>environment</code><span> (زي </span><code>dev</code><span>, </span><code>staging</code><span>, </span><code>prod</code><span>).</span></p></li></ul><hr /><p><strong><span>المستوى التالت:  </span><code>Environment Variables</code></strong></p><p><span>لو لسه ملقاش قيمة، بيبص على الـ </span><code>environment variables</code><span> بتاعة الـ </span><code>shell</code><span> اللي أنت فيها.</span></p><ul><li><p><code>Terraform</code><span> بيدور على </span><code>variable</code><span> اسمه بيبدأ بـ </span><code>TF_VAR_</code><span>.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.63022px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">export</span> <span class="cm-def">TF_VAR_server_port</span><span class="cm-operator">=</span><span class="cm-number">8080</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.63019px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">terraform apply </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">```</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">دي طريقة مفيدة جدًا في الـ `CI/CD pipelines`.</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 67px;"></div><div class="CodeMirror-gutters" style="display: none; height: 67px;"></div></div></div></pre><hr /><p><strong><span>المستوى الرابع: القيمة الـdefault في الكود (</span><code>default</code><span>)</span></strong></p><p><span>لو عدى على كل اللي فات ده ولسه المتغير ملوش قيمة، بيروح يبص جوه الكود نفسه على بلوك الـ </span><code>variable</code><span>.</span></p><ul><li><p><strong><span>هل فيه </span><code>default</code><span>؟</span></strong><span> لو لقى قيمة الـdefault، بيستخدمها.</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.63019px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">variable "server_port" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  description = "The port the server will use for HTTP requests"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  type &nbsp; &nbsp; &nbsp;  = number</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  default &nbsp; &nbsp; = 8080 # هيستخدم دي لو كل اللي فات فشل</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre><p>&nbsp;</p><hr /><p><strong><span>القاع (الحل الأخير): هيسألك في وشك!</span></strong></p><p><span>لو المتغير معندوش أي قيمة من أي مصدر من المصادر اللي فاتت دي كلها، </span><strong><span>وكمان معندوش </span><code>default</code><span> value</span></strong><span>، </span><code>Terraform</code><span> بيستسلم وبيوقف كل حاجة وبيسألك مباشرةً:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.63019px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$ terraform apply</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">var.server_port</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  The port the server will use for HTTP requests</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Enter a value: </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre><p><span>وهيفضل واقف مستني إجابتك عشان يكمل.</span></p><hr /><p><strong><span>بالترتيب:</span></strong></p><ol start='' ><li><p><strong><span>الأقوى:</span></strong><span> </span><code>-var</code><span> و </span><code>-var-file</code><span>.</span></p></li><li><p><strong><span>بعده:</span></strong><span> ملفات </span><code>terraform.tfvars</code><span> و </span><code>*.auto.tfvars</code><span>.</span></p></li><li><p><strong><span>بعده:</span></strong><span> </span><code>Environment Variables</code><span> (اللي بتبدأ بـ </span><code>TF_VAR_</code><span>).</span></p></li><li><p><strong><span>بعده:</span></strong><span> الـ </span><code>default</code><span> value جوه الكود.</span></p></li><li><p><strong><span>لو مفيش أي حاجة من دول:</span></strong><span> هيسألك</span></p></li></ol></div><p>&nbsp;</p><p><strong><code>type</code></strong></p><p><span>ده بيسمحلك تفرض قيود على نوع (</span><code>type</code><span>) المتغيرات اللي المستخدم بيبعتها. </span><code>Terraform</code><span> بيدعم قيود أنواع كتير، منها </span><code>string</code><span> (نص)، </span><code>number</code><span> (رقم)، </span><code>bool</code><span> ، </span><code>list</code><span>، </span><code>map</code><span> ، </span><code>set</code><span>، </span><code>object</code><span> ، </span><code>tuple</code><span>، و </span><code>any</code><span> (أي حاجة). دايمًا فكرة كويسة إنك تحدد </span><code>type</code><span> عشان تكتشف الأخطاء البسيطة. لو محددتش </span><code>type</code><span>، </span><code>Terraform</code><span> بيفترض إن النوع هو </span><code>any</code><span>.</span></p><p><strong><code>validation</code></strong>
<span>ده بيسمحلك تعرف قواعد تحقق (</span><code>validation</code><span>) خاصة بيك للمتغير، بتكون أعمق من مجرد فحص النوع، زي إنك تفرض قيمة قصوى أو دنيا لرقم. هتشوف مثال على الـ </span><code>validations</code><span> في الفصل الثامن.</span></p><p><strong><code>sensitive</code></strong>
<span>لو ظبطت الـ </span><code>parameter</code><span> ده على </span><code>true</code><span> لمتغير، </span><code>Terraform</code><span> مش هيعرض قيمته في الـ </span><code>log</code><span> لما تشغل </span><code>plan</code><span> أو </span><code>apply</code><span>. لازم تستخدم ده على أي </span><code>secrets</code><span> بتبعتها لكود </span><code>Terraform</code><span> بتاعك عن طريق متغيرات: زي الباسوردات، </span><code>API keys</code><span>، إلخ. هتكلم أكتر عن secrets في الفصل السادس.</span></p><p><span>ده مثال لـ </span><code>input variable</code><span> بيتأكد إن القيمة اللي بتبعتها هي رقم:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">variable "number_example" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  description = "An example of a number variable in Terraform"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  type &nbsp; &nbsp; &nbsp;  = number</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  default &nbsp; &nbsp; = 42</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre><p><span>وده مثال لمتغير بيتأكد إن القيمة هي لستة:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0241px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">variable "list_example" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  description = "An example of a list in Terraform"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  type &nbsp; &nbsp; &nbsp;  = list(string) # هنا حددنا إنها لستة من النصوص</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  default &nbsp; &nbsp; = ["a", "b", "c"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre><p><span>ممكن كمان تدمج قيود الأنواع. على سبيل المثال، ده </span><code>input variable</code><span> للستة بيشترط إن كل العناصر اللي في اللستة تكون أرقام:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">variable "list_numeric_example" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  description = "An example of a numeric list in Terraform"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  type &nbsp; &nbsp; &nbsp;  = list(number)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  default &nbsp; &nbsp; = [1, 2, 3]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre><p><span>وده </span><code>map</code><span>بيشترط إن كل القيم تكون نصوص:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">variable "map_example" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  description = "An example of a map in Terraform"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  type &nbsp; &nbsp; &nbsp;  = map(string)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  default = {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  key1 = "value1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  key2 = "value2"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  key3 = "value3"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 202px;"></div><div class="CodeMirror-gutters" style="display: none; height: 202px;"></div></div></div></pre><p><span>تقدر كمان تعمل   </span><code>structural types</code><span> أكتر تعقيدًا باستخدام </span><code>object type constraint</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">variable "object_example" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  description = "An example of a structural type in Terraform"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  type = object({</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  name &nbsp;  = string</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  age &nbsp; &nbsp; = number</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  tags &nbsp;  = list(string)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  enabled = bool</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  })</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  default = {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  name &nbsp;  = "value1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  age &nbsp; &nbsp; = 42</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  tags &nbsp;  = ["a", "b", "c"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  enabled = true</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 336px;"></div></div></div></pre><p><span>المثال اللي فات بيعمل </span><code>input variable</code><span> هيشترط إن القيمة تكون </span><code>object</code><span> فيه الـ </span><code>keys</code><span> اللي اسمها </span><code>name</code><span> (ولازم يكون </span><code>string</code><span>)، </span><code>age</code><span> (ولازم يكون </span><code>number</code><span>)، </span><code>tags</code><span> (ولازم تكون لستة من الـ </span><code>strings</code><span>)، و </span><code>enabled</code><span> (ولازم تكون </span><code>Boolean</code><span> ). لو حاولت تظبط المتغير ده على قيمة مش مطابقة للنوع ده، </span><code>Terraform</code><span> فورًا هيديك </span><code>type error</code><span>. المثال الجاي بيوضح محاولة إننا نظبط </span><code>enabled</code><span> على </span><code>string</code><span> بدل </span><code>Boolean</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">variable "object_example_with_error" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  description = "An example of a structural type in Terraform with an error"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  type = object({</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  name &nbsp;  = string</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  age &nbsp; &nbsp; = number</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  tags &nbsp;  = list(string)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  enabled = bool</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  })</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  default = {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  name &nbsp;  = "value1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  age &nbsp; &nbsp; = 42</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  tags &nbsp;  = ["a", "b", "c"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  enabled = "invalid" # هنا الغلطة</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 358px;"></div><div class="CodeMirror-gutters" style="display: none; height: 358px;"></div></div></div></pre><p><span>هيجيلك الـ </span><code>error</code><span> ده:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.026px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$ terraform apply</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Error: Invalid default value for variable</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">on variables.tf line 78, in variable "object_example_with_error":</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">78: &nbsp; default = {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">79: &nbsp; &nbsp; name &nbsp;  = "value1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">80: &nbsp; &nbsp; age &nbsp; &nbsp; = 42</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">81: &nbsp; &nbsp; tags &nbsp;  = ["a", "b", "c"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">82: &nbsp; &nbsp; enabled = "invalid"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">83: &nbsp; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">This default value is not compatible with the variable's type constraint: a</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">bool is required.</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 269px;"></div><div class="CodeMirror-gutters" style="display: none; height: 269px;"></div></div></div></pre><p><span>نرجع بقى لمثال الـ </span><code>web server</code><span>، اللي أنت محتاجه هو متغير يخزن رقم الـ </span><code>port</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">variable "server_port" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  description = "The port the server will use for HTTP requests"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  type &nbsp; &nbsp; &nbsp;  = number</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>خد بالك إن الـ </span><code>input variable</code><span> اللي اسمه </span><code>server_port</code><span> معندوش </span><code>default</code><span>، فلو شغلت أمر </span><code>apply</code><span> دلوقتي، </span><code>Terraform</code><span> هيسألك بشكل تفاعلي (</span><code>interactively</code><span>) تدخل قيمة للـ </span><code>server_port</code><span> وهيوريك الـ </span><code>description</code><span> بتاع المتغير:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$ terraform apply</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">var.server_port</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  The port the server will use for HTTP requests</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Enter a value:</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre><p><span>لو مش عايز تتعامل مع السؤال التفاعلي ده، ممكن تدي قيمة للمتغير عن طريق الـ </span><code>command-line option</code><span> اللي اسمه </span><code>-var</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ terraform</span> plan <span class="cm-attribute">-var</span> <span class="cm-string">"server_port=8080"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>ممكن كمان تظبط المتغير عن طريق </span><code>environment variable</code><span> اسمه </span><code>TF_VAR_&lt;name&gt;</code><span>، حيث </span><code>&lt;name&gt;</code><span> هو اسم المتغير اللي بتحاول تظبطه:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.026px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ export</span> <span class="cm-def">TF_VAR_server_port</span><span class="cm-operator">=</span><span class="cm-number">8080</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ terraform</span> plan</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>ولو مش عايز كل مرة تفتكر تكتب </span><code>arguments</code><span> زيادة وأنت بتشغل </span><code>plan</code><span> أو </span><code>apply</code><span>، ممكن تحدد قيمة افتراضية (</span><code>default value</code><span>):</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">variable "server_port" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  description = "The port the server will use for HTTP requests"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  type &nbsp; &nbsp; &nbsp;  = number</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  default &nbsp; &nbsp; = 8080</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre><p><span>عشان تستخدم القيمة بتاعة </span><code>input variable</code><span> في كود </span><code>Terraform</code><span> بتاعك، ممكن تستخدم نوع جديد من الـ </span><code>expressions</code><span> اسمه </span><code>variable reference</code><span>، وده الـ </span><code>syntax</code><span> بتاعه:</span></p><p><code>var.&lt;VARIABLE_NAME&gt;</code></p><p><span>على سبيل المثال، ده إزاي ممكن تظبط الـ </span><code>parameters</code><span> اللي اسمها </span><code>from_port</code><span> و </span><code>to_port</code><span> بتاعة الـ </span><code>security group</code><span> على قيمة المتغير </span><code>server_port</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">resource "aws_security_group" "instance" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name = "terraform-example-instance"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ingress {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  from_port &nbsp; = var.server_port</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  to_port &nbsp; &nbsp; = var.server_port</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  protocol &nbsp;  = "tcp"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  cidr_blocks = ["0.0.0.0/0"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 224px;"></div><div class="CodeMirror-gutters" style="display: none; height: 224px;"></div></div></div></pre><p><span>فكرة كويسة كمان إنك تستخدم نفس المتغير وأنت بتظبط الـ </span><code>port</code><span> في الـ </span><code>User Data script</code><span>. عشان تستخدم </span><code>reference</code><span> جوه </span><code>string</code><span>، أنت محتاج تستخدم نوع جديد من الـ </span><code>expressions</code><span> اسمه </span><code>interpolation</code><span>، وده الـ </span><code>syntax</code><span> بتاعه:</span></p><p><code>&quot;${...}&quot;</code></p><p><span>تقدر تحط أي </span><code>reference</code><span> صالح جوه القوسين دول، و</span><code>Terraform</code><span> هيحوله لـ </span><code>string</code><span>. على سبيل المثال، ده إزاي ممكن تستخدم </span><code>var.server_port</code><span> جوه الـ </span><code>string</code><span> بتاع الـ </span><code>User Data</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.026px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">user_data = &lt;&lt;-EOF</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  #!/bin/bash</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  echo "Hello, World" &gt; index.xhtml</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  nohup busybox httpd -f -p ${var.server_port} &amp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  EOF</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre><h3 id='output-variables-إزاي-تخلي-terraform-يكلمك-ويديك-النتائج'><strong><code>Output Variables</code><span>: إزاي تخلي </span><code>Terraform</code><span> يكلمك ويديك النتائج</span></strong></h3><p><code>Terraform</code><span> بيسمح لك إنك تعرّف &quot;متغيرات إخراج&quot; أو </span><code>output variables</code><span>. دي طريقة عشان تخلي </span><code>Terraform</code><span> يعرض لك معلومات معينة بعد ما يخلص شغله. طريقة كتابتها بتكون كالتالي:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">output "&lt;NAME&gt;" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  value = &lt;VALUE&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  [CONFIG ...]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><ul><li><p><strong><code>NAME</code></strong><span>: ده اسم متغير الإخراج اللي أنت بتختاره.</span></p></li><li><p><strong><code>VALUE</code></strong><span>: دي القيمة اللي أنت عايز </span><code>Terraform</code><span> يعرضها. ممكن تكون أي تعبير (</span><code>expression</code><span>) </span><code>Terraform</code><span> بيفهمه، زي إنك تشاور على </span><code>attribute</code><span> معين في </span><code>resource</code><span>.</span></p></li><li><p><strong><code>CONFIG</code></strong><span>: دي شوية إعدادات إضافية اختيارية:</span></p><ul><li><p><strong><code>description</code></strong><span>:</span>
<span>دايما فكرة كويسة إنك تستخدم الـ </span><code>parameter</code><span> ده عشان تكتب شرح بسيط يوصف نوع البيانات اللي المتغير ده بيعرضها.</span></p></li><li><p><strong><code>sensitive</code></strong><span>:</span>
<span>لو خليت القيمة دي </span><code>true</code><span>، فأنت بكده بتقول لـ </span><code>Terraform</code><span>: &quot;ماتعرضش قيمة المتغير ده في الـ </span><code>logs</code><span> في نهاية أمر </span><code>plan</code><span> أو </span><code>apply</code><span>&quot;. ده مفيد جدًا لو القيمة دي فيها حاجة سرية زي باسورد أو مفتاح خاص. خد بالك، لو متغير الإخراج ده بيشاور على متغير إدخال (</span><code>input variable</code><span>) أو </span><code>attribute</code><span> في </span><code>resource</code><span> معمول له </span><code>sensitive = true</code><span> أصلًا، </span><code>Terraform</code><span> هيجبرك إنك تعمل متغير الإخراج ده هو كمان </span><code>sensitive = true</code><span> عشان يأكد عليك إنك قاصد تعرض قيمة سرية.</span></p></li><li><p><strong><code>depends_on</code></strong><span>:</span>
<span>في العادي، </span><code>Terraform</code><span> بيفهم  (</span><code>dependencies</code><span>) بين الـ </span><code>resources</code><span> بتاعتك لوحده من خلال الـ </span><code>references</code><span> اللي في الكود. لكن في حالات نادرة، بتحتاج تديله تلميح إضافي. مثلاً، ممكن تكون عايز تعرض الـ </span><code>IP address</code><span> بتاع سيرفر، بس الـ </span><code>IP</code><span> ده مش هيكون شغال إلا لما الـ </span><code>security group</code><span> (الفايروول) يتظبط الأول. في الحالة دي، ممكن تستخدم </span><code>depends_on</code><span> عشان تقول لـ </span><code>Terraform</code><span> صراحةً إن فيه اعتمادية بين متغير الإخراج بتاع الـ </span><code>IP</code><span> وبين الـ </span><code>resource</code><span> بتاع الـ </span><code>security group</code><span>.</span></p></li></ul></li></ul><p><strong><span>مثال عملي:</span></strong></p><p><span>بدل ما تحتاج تدخل على الـ </span><code>EC2 console</code><span> كل مرة عشان تدور على الـ </span><code>IP</code><span> بتاع السيرفر اللي عملته، ممكن تخلي الـ </span><code>IP</code><span> ده يظهرلك كـ </span><code>output variable</code><span> بالشكل ده:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.026px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">output "public_ip" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  value &nbsp; &nbsp; &nbsp; = aws_instance.example.public_ip</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  description = "The public IP address of the web server"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>الكود ده بيستخدم </span><code>attribute reference</code><span> تاني، بس المرة دي بيشاور على الـ </span><code>public_ip</code><span> </span><code>attribute</code><span> بتاع الـ </span><code>aws_instance</code><span> </span><code>resource</code><span>. لو شغلت أمر </span><code>apply</code><span> تاني، </span><code>Terraform</code><span> مش هيعمل أي تغييرات (لأنك مغيرتش في أي </span><code>resources</code><span>)، بس في الآخر خالص هيعرض لك الـ </span><code>output</code><span> الجديد:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ terraform</span> apply</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(...)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Apply complete! Resources: <span class="cm-number">0</span> added, <span class="cm-number">0</span> changed, <span class="cm-number">0</span> destroyed.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Outputs:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">public_ip <span class="cm-operator">=</span> <span class="cm-string">"54.174.13.5"</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre><p><span>زي ما أنت شايف، متغيرات الإخراج بتظهر في الـ </span><code>console</code><span> بعد ما تشغل </span><code>terraform apply</code><span>. دي حاجة مفيدة للي هيستخدم الكود بتاعك (مثلاً، دلوقتي أنت عارف إيه هو الـ </span><code>IP</code><span> اللي المفروض تختبره بعد ما الـ </span><code>web server</code><span> اشتغل).</span></p><p><span>ممكن كمان تستخدم أمر </span><code>terraform output</code><span> عشان تشوف كل الـ </span><code>outputs</code><span> من غير ما تحتاج تعمل </span><code>apply</code><span> تاني:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ terraform</span> output</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">public_ip <span class="cm-operator">=</span> <span class="cm-string">"54.174.13.5"</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>ولو عايز تشوف قيمة </span><code>output</code><span> معين، ممكن تكتب اسمه بعد الأمر:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ terraform</span> output public_ip</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"54.174.13.5"</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>دي حركة مفيدة جدًا في الـ </span><code>scripting</code><span>. مثلاً، ممكن تعمل </span><code>deployment script</code><span> بيشغل </span><code>terraform apply</code><span> عشان يعمل </span><code>deploy</code><span> للـ </span><code>web server</code><span>، وبعدين يستخدم </span><code>terraform output public_ip</code><span> عشان ياخد الـ </span><code>IP</code><span> بتاعه، وبعدين يشغل أمر </span><code>curl</code><span> على الـ </span><code>IP</code><span> ده كاختبار سريع (</span><code>smoke test</code><span>) عشان يتأكد إن الـ </span><code>deployment</code><span> نجح.</span></p><p><span>متغيرات الإدخال والإخراج (</span><code>Input</code><span> and </span><code>output variables</code><span>) هي كمان مكونات أساسية عشان تبني كود بنية تحتية قابل للتخصيص وإعادة الاستخدام، وده موضوع هنشوفه بالتفصيل في الفصل الرابع.</span></p><p>&nbsp;</p><p><strong><code>Deploy</code><span> لـ </span><code>cluster</code><span> من الـ </span><code>web servers</code></strong></p><blockquote><div class="md-alert md-alert-caution caution"><p><span class='md-alert-text md-alert-text-caution'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Caution</span><br></p><p><span>ملحوظة مهمة </span><code>aws_launch_configuration</code><span> اللي مشروح عليه معدش موجود او مستخدام اللي بيستخدم بداله هو </span><code>aws_launch_template</code><span> بيأدي نفس الدور تمام عشان بس متجربش ويطلع معاك غلط </span></p><p><span>لازم تاخد بالك </span><code>aws_launch_template</code><span> افيد بكتير من من </span><code>aws_launch_configuration</code></p><p>&nbsp;</p></div></blockquote><p><span>إنك تشغل سيرفر واحد دي بداية كويسة، بس في العالم الحقيقي، السيرفر الواحد ده يعتبر </span><strong><code>single point of failure</code></strong><span> (نقطة فشل وحيدة). لو السيرفر ده وقع، أو بقى عليه ضغط زيادة عن اللزوم من كتر الـ </span><code>traffic</code><span>، المستخدمين مش هيعرفوا يدخلوا على موقعك. الحل هو إنك تشغل </span><code>cluster</code><span> (مجموعة) من السيرفرات، وتوجه الـ </span><code>traffic</code><span> بعيدًا عن السيرفرات اللي بتقع، وتعدل حجم الـ </span><code>cluster</code><span> بالزيادة أو النقصان بناءً على حجم الـ </span><code>traffic</code><span>.</span></p><p><span>إنك تدير </span><code>cluster</code><span> زي ده بشكل يدوي ده شغل كتير جدًا. لحسن الحظ، أنت ممكن تخلي </span><code>AWS</code><span> هي اللي تتكفل بالموضوع ده بالنيابة عنك عن طريق استخدام </span><strong><code>Auto Scaling Group (ASG)</code></strong><span>، زي ما هو واضح في شكل 2-9. الـ </span><code>ASG</code><span> بتشيل عنك مهام كتير بشكل أوتوماتيكي تمامًا، منها:</span></p><ul><li><p><span>تشغيل </span><code>cluster</code><span> من الـ </span><code>EC2 Instances</code><span>.</span></p></li><li><p><span>مراقبة &quot;صحة&quot; (</span><code>health</code><span>) كل </span><code>Instance</code><span>.</span></p></li><li><p><span>استبدال أي </span><code>Instance</code><span> تقع أو تفشل.</span></p></li><li><p><span>تعديل حجم الـ </span><code>cluster</code><span> كاستجابة للضغط (</span><code>load</code><span>).</span></p></li></ul><p>&nbsp;</p><p>&nbsp;</p><p><img src="imgs/image-20250616023431188.png" referrerpolicy="no-referrer" alt="image-20250616023431188"></p><p>&nbsp;</p><p>&nbsp;</p><p><span>بص يا سيدي، لما بتستخدم </span><code>aws_instance</code><span> في الكود، أنت بتقول لـ </span><code>Terraform</code><span> &quot;اعملي سيرفر واحد بس دلوقتي&quot;. ده </span><code>resource</code><span> مباشر بيطلع منتج نهائي واحد وهو سيرفر </span><code>EC2</code><span>.</span></p><p><span>لما بتيجي تستخدم </span><code>Auto Scaling Group</code><span> أو </span><code>ASG</code><span>، أنت مش عايز تبني سيرفر واحد، أنت عايز تعمل &quot;نظام&quot; يقدر يبني ويمسح سيرفرات كتير أوتوماتيك. النظام ده عشان يشتغل، محتاج يعرف &quot;مواصفات&quot; السيرفر اللي هيبنيه كل مرة.</span></p><p><span>الـ </span><code>aws_launch_configuration</code><span> هو بالظبط &quot;ملف المواصفات&quot; ده. هو مش سيرفر حقيقي، هو مجرد </span><code>resource</code><span> في </span><code>Terraform</code><span> وظيفته يخزن الإعدادات دي. الـ </span><code>ASG</code><span> بياخد ملف المواصفات ده كمرجع، وأي سيرفر جديد بيعمله، بيبنيه طبق الأصل من المواصفات دي.</span></p><h4 id='ليه-الكود-بيتغير'><strong><span>ليه الكود بيتغير؟</span></strong></h4><p><span>لأنك بتكتب &quot;ملف مواصفات&quot; مش بتعمل &quot;سيرفر&quot; فعلي، فيه شوية فروقات منطقية في الكود:</span></p><p><strong><span>1. أسامي بتتغير عشان تكون أدق:</span></strong></p><ul><li><p><span>الـ </span><code>argument</code><span> اللي كان اسمه </span><code>ami</code><span>، بقى اسمه </span><strong><code>image_id</code></strong><span>.</span></p><ul><li><p><strong><span>السبب:</span></strong><span> أنت هنا مش بتعمل نسخة (</span><code>instance</code><span>) من الـ </span><code>AMI</code><span>، أنت بس بتحدد (</span><code>image_id</code><span>) اللي هيتكتب في ملف المواصفات عشان يتسخدم بعدين.</span></p></li></ul></li><li><p><span>الـ </span><code>argument</code><span> اللي كان اسمه </span><code>vpc_security_group_ids</code><span>، بقى اسمه </span><strong><code>security_groups</code></strong><span>.</span></p><ul><li><p><strong><span>السبب:</span></strong><span> الاسم الجديد أبسط، وبيعبر عن إنك بتحدد &quot;لستة&quot; الـ </span><code>security groups</code><span> اللي هتتطبق على أي سيرفر يتعمل من المواصفات دي.</span></p></li></ul></li></ul><p><strong><span>2. حاجات بتتشال لأن مكانها مش هنا:</span></strong></p><ul><li><p><strong><span>الـ </span><code>tags</code><span> بتتشال:</span></strong></p><ul><li><p><strong><span>السبب:</span></strong><span> الـ </span><code>Tag</code><span> ده عامل زي &quot;استيكر&quot; بتلزقه على حاجة عشان تعلمها. مينفعش تلزق استيكر على &quot;ملف مواصفات&quot;. الاستيكر بيتلزق على السيرفر الحقيقي نفسه لما يطلع. عشان كده، الـ </span><code>tags</code><span> بتتعرف جوه الـ </span><code>ASG</code><span> نفسه، وهو اللي بياخدها ويلزقها على كل سيرفر بيعمله.</span></p></li></ul></li><li><p><strong><code>user_data_replace_on_change</code><span> بتتشال:</span></strong></p><ul><li><p><strong><span>السبب:</span></strong><span> الـ </span><code>parameter</code><span> ده كان حل لمشكلة في </span><code>aws_instance</code><span> عشان تجبره يمسح السيرفر ويبني واحد جديد لو غيرت الـ </span><code>user_data</code><span>.</span></p></li><li><p><span>هنا ده ملوش لازمة، لأن الـ </span><code>ASG</code><span> بطبيعته شغال بمبدأ &quot;امسح وهات جديد&quot;. لو أنت عايز تحدث السيرفرات، بتروح تعمل </span><code>launch_configuration</code><span> جديد خالص بمواصفات جديدة، وبعدين تقول للـ </span><code>ASG</code><span> &quot;اشتغل بالملف الجديد ده&quot;. الـ </span><code>ASG</code><span> لوحده هيبدأ يمسح السيرفرات القديمة ويعمل جديدة بالمواصفات المحدثة. ففكرة الاستبدال دي هي أساس شغل الـ </span><code>ASG</code><span> أصلًا.</span></p></li></ul></li></ul><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">resource "aws_launch_configuration" "example" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  image_id &nbsp; &nbsp; &nbsp;  = "ami-0fb653ca2d3203ac1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  instance_type &nbsp; = "t2.micro"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  security_groups = [aws_security_group.instance.id]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  user_data = &lt;&lt;-EOF</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  #!/bin/bash</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  echo "Hello, World" &gt; index.xhtml</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  nohup busybox httpd -f -p ${var.server_port} &amp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  EOF</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 246px;"></div><div class="CodeMirror-gutters" style="display: none; height: 246px;"></div></div></div></pre><p><span>دلوقتي تقدر تعمل الـ </span><code>ASG</code><span> نفسه باستخدام </span><code>aws_autoscaling_group</code><span> </span><code>resource</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">resource "aws_autoscaling_group" "example" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  launch_configuration = aws_launch_configuration.example.name</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  min_size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = 2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  max_size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = 10</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  tag {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  key &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = "Name"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  value &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = "terraform-asg-example"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  propagate_at_launch = true</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 246px;"></div><div class="CodeMirror-gutters" style="display: none; height: 246px;"></div></div></div></pre><p>&nbsp;</p><div class="md-alert md-alert-caution caution"><p><span class='md-alert-text md-alert-text-caution'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Caution</span><br></p><p><span>ذي ما قولت aws_launch_configuration معدش موجود</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.63019px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_autoscaling_group"</span> <span class="cm-string">"example"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">desired_capacity</span> &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">min_size</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">max_size</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-number">10</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">vpc_zone_identifier</span> &nbsp;<span class="cm-operator">=</span> [<span class="cm-variable">aws_subnet</span><span class="cm-operator">.</span><span class="cm-property">net1</span><span class="cm-operator">.</span><span class="cm-property">id</span>,<span class="cm-variable">aws_subnet</span><span class="cm-operator">.</span><span class="cm-property">net2</span><span class="cm-operator">.</span><span class="cm-property">id</span>] &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">launch_template</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-variable">id</span> &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-variable">aws_launch_template</span><span class="cm-operator">.</span><span class="cm-property">example</span><span class="cm-operator">.</span><span class="cm-property">id</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-variable">version</span> <span class="cm-operator">=</span> <span class="cm-string">"$Latest"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tag</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-variable">key</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"Name"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-variable">value</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"terraform-asg-example"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-variable">propagate_at_launch</span> <span class="cm-operator">=</span> <span class="cm-keyword">true</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_launch_template"</span> <span class="cm-string">"example"</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">name_prefix</span> &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"example-"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">image_id</span> &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-string">"ami-0fb653ca2d3203ac1"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">instance_type</span> <span class="cm-operator">=</span> <span class="cm-string">"t2.micro"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">vpc_security_group_ids</span> <span class="cm-operator">=</span> [<span class="cm-variable">aws_security_group</span><span class="cm-operator">.</span><span class="cm-property">instance</span><span class="cm-operator">.</span><span class="cm-property">id</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">user_data</span> <span class="cm-operator">=</span> <span class="cm-variable">base64encode</span>(<span class="cm-string">&lt;&lt;-EOF</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #!/bin/bash</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo "Hello, World" &gt; index.xhtml</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nohup busybox httpd -f -p ${var.server_port} &amp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EOF</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 761px;"></div><div class="CodeMirror-gutters" style="display: none; height: 761px;"></div></div></div></pre><p><span>لازم يبقوا 2 subnet فى vpc_zone_identifier على الاقل </span></p></div><p><span>الكود بتاع الـ </span><code>Auto Scaling Group (ASG)</code><span> اللي عملناه بيقوله: &quot;شغّل ما بين سيرفرين و 10 سيرفرات، وابدأ بسيرفرين. أي سيرفر تعمله، الزق عليه </span><code>tag</code><span> اسمه </span><code>terraform-asg-example</code><span>.&quot;</span></p><h4 id='المشكلة-الخناقة-بين-الـ-asg-والـ-launch-configuration'><strong><span>المشكلة: الخناقة بين الـ </span><code>ASG</code><span> والـ </span><code>Launch Configuration</code></strong></h4><p><span>لاحظ إن الـ </span><code>ASG</code><span> بيستخدم </span><code>reference</code><span>  عشان يعرف هو هيشتغل بإنهي </span><code>launch configuration</code><span> (ملف المواصفات). يعني كود الـ </span><code>ASG</code><span> بيقول</span>
<span>: </span><code>launch_configuration = aws_launch_configuration.example.name</code><span>.</span></p><p><strong><span>هنا بقى بتحصل المشكلة:</span></strong></p><ol start='' ><li><p><strong><span>طبيعة الـ </span><code>Launch Configuration</code><span>:</span></strong><span> ملفات المواصفات دي تعتبر </span><code>immutable</code><span>، يعني </span><strong><span>غير قابلة للتعديل</span></strong><span>. لو غيرت فيها حرف واحد (مثلًا غيرت نوع السيرفر)، </span><code>Terraform</code><span> مبيعرفش &quot;يعدل&quot; الملف القديم. الحل الوحيد عنده هو إنه يمسح القديم ويعمل واحد جديد بالاسم الجديد.</span></p></li><li><p><strong><span>الترتيب المنطقي لـ </span><code>Terraform</code><span>:</span></strong><span> في العادي، لما </span><code>Terraform</code><span> بيجي يبدل </span><code>resource</code><span>، هو بيمشي بالترتيب ده:</span></p><ul><li><p><strong><span>أولًا:</span></strong><span> يمسح الـ </span><code>resource</code><span> القديم.</span></p></li><li><p><strong><span>ثانيًا:</span></strong><span> يعمل الـ </span><code>resource</code><span> الجديد.</span></p></li></ul></li><li><p><strong><span>الخناقة:</span></strong><span> تخيل إنك غيرت نوع السيرفر في الـ </span><code>launch_configuration</code><span> بتاعك وشغلت </span><code>apply</code><span>. </span><code>Terraform</code><span> هيحاول يمشي بالترتيب بتاعه:</span></p><ul><li><p><span>هيجي يمسح الـ </span><code>launch_configuration</code><span> القديم.</span></p></li><li><p><span>الـ </span><code>ASG</code><span> هيزعق ويقول: </span><strong><span>&quot;لأ استنى! أنت بتمسح إيه؟ أنا لسه بستخدم </span><code>launch_configuration</code><span> ده وبشاور عليه. مينفعش تمسحه وهو لسه قيد الاستخدام.&quot;</span></strong></p></li><li><p><strong><span>النتيجة:</span></strong><span> </span><code>Terraform</code><span> هيقف ويطلع </span><code>error</code><span>، وعمرك ما هتعرف تحدث السيرفرات بتاعتك.</span></p></li></ul></li></ol><h4 id='الحل-خاصية-lifecycle'><strong><span>الحل: خاصية </span><code>lifecycle</code><span> </span></strong></h4><p><span>عشان نحل الخناقة دي، بنستخدم خاصية متقدمة في </span><code>Terraform</code><span> اسمها </span><code>lifecycle</code><span>. الخاصية دي بتسمحلك تغير السلوك الافتراضي بتاع </span><code>Terraform</code><span> في عمليات الإنشاء والتعديل والمسح.</span></p><p><span>الحل بتاعنا موجود في </span><code>setting</code><span> معين جوه الـ </span><code>lifecycle</code><span> اسمه </span><code>create_before_destroy</code><span>.</span></p><p><strong><span>إيه اللي </span><code>create_before_destroy = true</code><span> بتعمله؟</span></strong></p><p><span>ببساطة، هي بتقول لـ </span><code>Terraform</code><span>: </span><strong><span>&quot;لما تيجي تبدل الـ resource ده، اعكس الترتيب بتاعك. متخافش.&quot;</span></strong></p><p><span>فالترتيب الجديد بيبقى كالآتي:</span></p><ol start='' ><li><p><strong><span>أولًا:</span></strong><span> يعمل الـ </span><code>launch_configuration</code><span> </span><strong><span>الجديد</span></strong><span> بالمواصفات الجديدة.</span></p></li><li><p><strong><span>ثانيًا:</span></strong><span> يروح للكود بتاع الـ </span><code>ASG</code><span> ويحدّث الـ </span><code>reference</code><span> اللي فيه، ويخليه يشاور على الـ </span><code>launch_configuration</code><span> الجديد اللي لسه معمولة.</span></p></li><li><p><strong><span>ثالثًا (والأهم):</span></strong><span> دلوقتي الـ </span><code>ASG</code><span> مبقاش بيستخدم الـ </span><code>launch_configuration</code><span> القديم. بقى حر ومحدش مرتبط بيه.</span></p></li><li><p><strong><span>رابعًا:</span></strong><span> </span><code>Terraform</code><span> يروح يمسح الـ </span><code>launch_configuration</code><span> القديم وهو مطمن.</span></p></li></ol><p><span>بالطريقة دي، عملية التحديث بتم بسلاسة ومن غير أي </span><code>errors</code><span>.</span></p><p><span>بتضيف بلوك الـ </span><code>lifecycle</code><span> ده جوه الـ </span><code>aws_launch_configuration</code><span> بتاعك بالشكل ده عشان تحل المشكلة:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">resource "aws_launch_configuration" "example" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  # ... كل المواصفات بتاعتك ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  lifecycle {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  create_before_destroy = true</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.026px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">resource "aws_launch_configuration" "example" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  image_id &nbsp; &nbsp; &nbsp;  = "ami-0fb653ca2d3203ac1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  instance_type &nbsp; = "t2.micro"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  security_groups = [aws_security_group.instance.id]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  user_data = &lt;&lt;-EOF</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  #!/bin/bash</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  echo "Hello, World" &gt; index.xhtml</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  nohup busybox httpd -f -p ${var.server_port} &amp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  EOF</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  # launch configuration مع auto scaling group.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  lifecycle {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  create_before_destroy = true</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 358px;"></div><div class="CodeMirror-gutters" style="display: none; height: 358px;"></div></div></div></pre><p>&nbsp;</p><p><span>علشان الـ </span><code>Auto Scaling Group (ASG)</code><span> يشتغل، لازم تقوله هيبني السيرفرات بتاعته فين. المكان ده هو الـ </span><code>subnets</code><span>. مينفعش تسيبها فاضية.</span></p><p><strong><span>ليه لازم نحدد كذا </span><code>subnet</code><span>؟</span></strong>
<span>علشان كل </span><code>subnet</code><span> بيبقى في منطقة  (</span><code>Availability Zone</code><span> أو </span><code>AZ</code><span>) مختلفة. لما توزع سيرفراتك على كذا </span><code>subnet</code><span>، لو منطقة كهرباء كاملة فصلت، الخدمة بتاعتك هتفضل شغالة من المناطق التانية.</span></p><p><strong><span>الطريقة الغلط:</span></strong><span> إنك تكتب أرقام الـ </span><code>subnet IDs</code><span> بإيدك في الكود. لو خدت الكود ده شغلته في </span><code>account</code><span> تاني، الأرقام دي هتبقى غلط والكود هيضرب.</span></p><p><strong><span>الطريقة الصح:</span></strong><span> نستخدم حاجة في </span><code>Terraform</code><span> اسمها </span><code>Data Source</code><span>.</span></p><h4 id='إيه-هو-الـ-data-source'><strong><span>إيه هو الـ </span><code>Data Source</code><span>؟</span></strong></h4><p><span>الـ </span><code>Data Source</code><span> وظيفته إنه يقرأ معلومات موجودة أصلًا من </span><code>AWS</code><span>، من غير ما يبني أو يغير أي حاجة. هو أداة &quot;للقراءة فقط&quot;. أنت بتستخدمه عشان تسأل </span><code>AWS</code><span> عن حاجة، وهو بيرجعلك بالمعلومات دي عشان تستخدمها في الكود بتاعك.</span></p><h4 id='الخطوات-عشان-نستخدمه'><strong><span>الخطوات عشان نستخدمه</span></strong></h4><p><strong><span>الخطوة الأولى: هنجيب الـ </span><code>ID</code><span> بتاع الـ </span><code>Default VPC</code></strong></p><p><span>قبل ما نعرف الـ </span><code>subnets</code><span>، لازم نعرف الأول هي تبع أنهي </span><code>VPC</code><span>. هنستخدم </span><code>data source</code><span> عشان نجيب معلومات الـ </span><code>Default VPC</code><span>.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="hcl"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="hcl"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.026px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">data "aws_vpc" "default" {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  default = true</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 67px;"></div><div class="CodeMirror-gutters" style="display: none; height: 67px;"></div></div></div></pre><p><span>انت بتجيب بيانات vpc اللي هي </span><code>default=True</code><span> هو هنا كدا بيعمل filter  ومن الطبيعي مفيش الا واحدة بتكون default ممكن تعمل filter على اساسا ثاني ممكن تكون عندك vpc.id او اي tags لسه هنشوف طرق filtertion</span>
<span>خلي باللك زي اللي قبله كل الناتج اتحط فى متغير data.aws_vpc.default</span></p><p><span>دلوقتي لو عايز استدعي شئ تبع متغير default هعمل كده </span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.026px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">data.aws_vpc.default.id</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p>&nbsp;</p><p>&nbsp;</p><p><strong><span>الخطوة الثانية: هنجيب كل الـ </span><code>Subnets</code><span> اللي جوه الـ </span><code>VPC</code><span> دي</span></strong></p><p><span>بعد ما جبنا </span><code>ID</code><span> الـ </span><code>VPC</code><span> في الخطوة اللي فاتت، هنستخدمه عشان نجيب كل الـ </span><code>subnets</code><span> اللي جواها.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">data</span> <span class="cm-string">"aws_subnets"</span> <span class="cm-string">"default"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">filter</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">name</span> &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"vpc-id"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">values</span> <span class="cm-operator">=</span> [<span class="cm-variable">data</span><span class="cm-operator">.</span><span class="cm-property">aws_vpc</span><span class="cm-operator">.</span><span class="cm-property">default</span><span class="cm-operator">.</span><span class="cm-property">id</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><ul><li><p><span>هنا انا حددت كل subnets تمام وحطاطهم فى argument اسمه </span><code>data.aws_subnets.default</code></p></li><li><p><span>وبعدها بعمل filter بحيث بختار بناء على خصية لوحدها وهي </span><code>vpc-id</code></p></li><li><p><span>هنا يجي السؤال ازاي هو عرف انه هيطلع single object او list ده عن طريق انك ذكرت aws_subnets مش aws_subnet عشان كده هتشوف بعد كده ان الناتج ده list على عكس المثال اللي فات </span><code>aws_vpc</code><span> لما اذكر الجمع يبقى انا عايز list مش واحد</span></p></li></ul><p><strong><span>الخطوة الثالثة والأخيرة: ندي اللستة دي للـ </span><code>ASG</code></strong></p><p><span>دلوقتي عندنا لستة الـ </span><code>subnet IDs</code><span> جاهزة. كل اللي هنعمله إننا نديها للـ </span><code>ASG</code><span>.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.026px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_autoscaling_group"</span> <span class="cm-string">"example"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># ... باقي الإعدادات زي launch_configuration و min/max_size ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">vpc_zone_identifier</span> <span class="cm-operator">=</span> <span class="cm-variable">data</span><span class="cm-operator">.</span><span class="cm-property">aws_subnets</span><span class="cm-operator">.</span><span class="cm-property">default</span><span class="cm-operator">.</span><span class="cm-property">ids</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># ... باقي الـ tags ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre><ul><li><p><span>الـ </span><code>argument</code><span> اللي اسمه </span><code>vpc_zone_identifier</code><span> هو اللي بياخد لستة الـ </span><code>subnet IDs</code><span>.</span></p></li><li><p><code>data.aws_subnets.default.ids</code><span>: هنا بنديله اللستة اللي جبناها من الـ </span><code>data source</code><span> التاني.</span></p></li></ul><p><span>بالطريقة دي، الكود بتاعك مبقاش معتمد على </span><code>IDs</code><span> ثابتة. لو شغلته في أي مكان، هو لوحده هيسأل </span><code>AWS</code><span> على الـ </span><code>VPC</code><span> والـ </span><code>subnets</code><span> الصح ويستخدمهم.</span></p><p>&nbsp;</p><p>&nbsp;</p><h3 id='deploy-لـ-load-balancer'><strong><code>Deploy</code><span> لـ </span><code>Load Balancer</code></strong></h3><p><span>لحد دلوقتي، أنت تقدر تعمل </span><code>deploy</code><span> للـ </span><code>ASG</code><span> بتاعك، بس هتقابلك مشكلة صغيرة: بقى عندك كذا سيرفر، كل واحد فيهم ليه الـ </span><code>IP address</code><span> بتاعه، بس أنت في العادي بتبقى عايز تدي للمستخدمين النهائيين بتوعك عنوان واحد بس يستخدموه.</span></p><p><span>طريقة عشان تحل المشكلة دي هي إنك تعمل </span><code>deploy</code><span> لـ </span><code>load balancer</code><span> عشان يوزع الـ </span><code>traffic</code><span> على السيرفرات بتاعتك، وتدي لكل المستخدمين بتوعك الـ </span><code>IP</code><span> (أو بمعنى أدق، اسم الـ </span><code>DNS</code><span>) بتاع الـ </span><code>load balancer</code><span>.</span></p><p><span>إنك تعمل </span><code>load balancer</code><span> يكون </span><code>highly available</code><span>  و </span><code>scalable</code><span> (يقدر يكبر ويصغر حسب الضغط) ده شغل كتير جدًا. مرة تانية، أنت ممكن تخلي </span><code>AWS</code><span> هي اللي تتكفل بالموضوع ده بالنيابة عنك، المرة دي عن طريق استخدام خدمة </span><code>Amazon&#39;s Elastic Load Balancer (ELB)</code><span>.</span></p><p><img src="imgs/image-20250618191724446.png" referrerpolicy="no-referrer" alt="image-20250618191724446"><span>\</span></p><p><code>AWS</code><span> بتقدم ثلاث أنواع من الـ </span><code>load balancers</code><span>:</span></p><ul><li><p><strong><code>Application Load Balancer (ALB)</code></strong>
<span>ده أنسب اختيار لتوزيع الـ </span><code>traffic</code><span> بتاع </span><code>HTTP</code><span> و </span><code>HTTPS</code><span>. بيشتغل على مستوى الـ </span><code>application layer (Layer 7)</code><span> بتاع نموذج </span><code>OSI</code><span>. ده معناه إنه بيفهم الطلبات بتاعة الويب نفسها، زي الـ </span><code>URLs</code><span> والـ </span><code>headers</code><span>، وبيقدر يوجه الـ </span><code>traffic</code><span> بناءً عليها.</span></p></li><li><p><strong><code>Network Load Balancer (NLB)</code></strong>
<span>ده أنسب اختيار لتوزيع الـ </span><code>traffic</code><span> بتاع </span><code>TCP</code><span> و </span><code>UDP</code><span> و </span><code>TLS</code><span>. بيقدر يكبر ويصغر (</span><code>scale</code><span>) كاستجابة للضغط أسرع من الـ </span><code>ALB</code><span> (الـ </span><code>NLB</code><span> مصمم إنه يستحمل عشرات الملايين من الطلبات في الثانية). بيشتغل على مستوى الـ </span><code>transport layer (Layer 4)</code><span> بتاع نموذج </span><code>OSI</code><span>. ده معناه إنه مش بيبص جوه الطلب، هو بس بيوجه &quot;الباكيتات&quot; بسرعة عالية جدًا.</span></p></li><li><p><strong><code>Classic Load Balancer (CLB)</code></strong>
<span>ده الـ </span><code>load balancer</code><span> القديم (</span><code>legacy</code><span>) اللي كان موجود قبل ما الـ </span><code>ALB</code><span> والـ </span><code>NLB</code><span> يظهروا. بيقدر يتعامل مع </span><code>traffic</code><span> الـ </span><code>HTTP</code><span>, </span><code>HTTPS</code><span>, </span><code>TCP</code><span>, و </span><code>TLS</code><span> بس بإمكانيات (</span><code>features</code><span>) أقل بكتير منهم. بيشتغل على المستويين </span><code>application layer (L7)</code><span> و </span><code>transport layer (L4)</code><span> من نموذج </span><code>OSI</code><span>. </span><strong><span>نصيحة: متستخدموش في أي حاجة جديدة.</span></strong></p></li></ul><p><span>معظم التطبيقات دلوقتي المفروض تستخدم يا إما </span><code>ALB</code><span> يا إما </span><code>NLB</code><span>. وبما إن مثال الـ </span><code>web server</code><span> البسيط اللي بنشتغل عليه هو تطبيق </span><code>HTTP</code><span> ومحتاجش أداء خرافي، فالـ </span><code>ALB</code><span> هو أنسب اختيار ليه.</span></p><p><span>الـ </span><code>ALB</code><span> بيتكون من كذا جزء أساسي:</span></p><ul><li><p><strong><code>Listener</code><span> :</span></strong>
<span>ده الجزء اللي بيستقبل الـ </span><code>traffic</code><span>. وظيفته إنه &quot;listen&quot; على </span><code>port</code><span> (زي 80) وبروتوكول (زي </span><code>HTTP</code><span>) معين.</span></p></li><li><p><strong><code>Listener rule</code><span> :</span></strong>
<span>دي &quot;قواعد المرور&quot; بتاعة الـ </span><code>Listener</code><span>. بتاخد الطلبات اللي بتيجي، ولو لقت طلب بيطابق شرط معين (زي إنه رايح على </span><code>path</code><span> معين زي </span><code>/images</code><span>، أو جاي لـ </span><code>hostname</code><span> معين زي </span><code>api.example.com</code><span>)، بتوجهه لـ </span><code>target group</code><span> محددة.</span></p></li><li><p><strong><code>Target groups</code><span> :</span></strong>
<span>دي المجموعة اللي فيها السيرفرات بتاعتك اللي هتستقبل الـ </span><code>traffic</code><span> في الآخر. الـ </span><code>target group</code><span> كمان مسؤول عن إنه يعمل </span><code>health checks</code><span>  على السيرفرات دي، وميبعتش أي </span><code>traffic</code><span> غير للسيرفرات السليمة (</span><code>healthy nodes</code><span>) بس.</span></p></li></ul><p><img src="imgs/image-20250618195830507.png" referrerpolicy="no-referrer" alt="ص"></p><p>&nbsp;</p><p><span>### </span></p><p><strong><span>أول خطوة إننا نكريت الـ </span><code>ALB</code><span> نفسه باستخدام الـ </span><code>aws_lb resource</code><span>:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_lb"</span> <span class="cm-string">"example"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">name</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"terraform-asg-example"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">load_balancer_type</span> <span class="cm-operator">=</span> <span class="cm-string">"application"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">subnets</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-variable">data</span><span class="cm-operator">.</span><span class="cm-property">aws_subnets</span><span class="cm-operator">.</span><span class="cm-property">default</span><span class="cm-operator">.</span><span class="cm-property">ids</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre><p><span>خد بالك إن الـ </span><code>parameter</code><span> بتاع الـ </span><code>subnets</code><span> ده بيظبط الـ </span><code>load balancer</code><span> علشان يستخدم كل الـ </span><code>subnets</code><span> اللي موجودة في الـ </span><code>Default VPC</code><span> بتاعك، وده عن طريق استخدام الـ </span><code>aws_subnets data source</code><span>.</span></p><p><span>الـ </span><code>AWS load balancers</code><span> مش بيتكون من </span><code>server</code><span> واحد، لأ ده بيبقى كذا </span><code>server</code><span> ممكن يشتغلوا في </span><code>subnets</code><span> منفصلة (يعني ممكن في </span><code>datacenters</code><span> مختلفة خالص). </span><code>AWS</code><span> بتزود وتنقص عدد الـ </span><code>servers</code><span> بتاعت الـ </span><code>load balancer</code><span> دي أوتوماتيك على حسب الـ </span><code>traffic</code><span> اللي جاي عليها، وبتظبط موضوع الـ </span><code>failover</code><span> لو واحد من الـ </span><code>servers</code><span> دي وقع، فإنت كده بتاخد </span><code>scalability</code><span> و </span>
<code>high availability</code><span> كا </span><code>out of the box</code><span>.</span></p><div class="md-alert md-alert-tip tip"><p><span class='md-alert-text md-alert-text-tip'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</span><br></p><p><span>&quot;Out of the box&quot; معناها إن الميزة دي موجودة وجاهزة للاستخدام </span><strong><span>من غير ما تحتاج تعمل أي إعدادات إضافية أو مجهود منك</span></strong><span>. يعني هي بتيجي مع المنتج أو الخدمة دي بشكل أساسي ومدمج.</span></p></div><p><strong><span>دلوقتي بقى، هنعرف </span><code>listener</code><span> للـ </span><code>ALB</code><span> ده باستخدام الـ </span><code>aws_lb_listener resource</code><span>:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.026px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_lb_listener"</span> <span class="cm-string">"http"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">load_balancer_arn</span> <span class="cm-operator">=</span> <span class="cm-variable">aws_lb</span><span class="cm-operator">.</span><span class="cm-property">example</span><span class="cm-operator">.</span><span class="cm-property">arn</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">port</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-number">80</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">protocol</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-string">"HTTP"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># By default, return a simple 404 page</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">default_action</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">type</span> <span class="cm-operator">=</span> <span class="cm-string">"fixed-response"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">fixed_response</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">content_type</span> <span class="cm-operator">=</span> <span class="cm-string">"text/plain"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">message_body</span> <span class="cm-operator">=</span> <span class="cm-string">"404: page not found"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">status_code</span> <span class="cm-operator">=</span> <span class="cm-number">404</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 314px;"></div><div class="CodeMirror-gutters" style="display: none; height: 314px;"></div></div></div></pre><p><span>الـ </span><code>listener</code><span> ده بيظبط الـ </span><code>ALB</code><span> إنه </span><strong><span>يسمع</span></strong><span> على الـ </span><code>HTTP port</code><span> الأساسي، اللي هو </span><code>port 80</code><span>، ويستخدم </span><code>HTTP</code><span> كـ </span><code>protocol</code><span>، ويبعت صفحة 404 بسيطة كـ </span><code>default response</code><span> لأي </span><code>requests</code><span> مش ماشية مع أي </span><code>listener rules</code><span>.</span></p><p><span>خد بالك إن </span><code>by default</code><span>، كل الـ </span><code>AWS resources</code><span>، ومن ضمنهم الـ </span><code>ALBs</code><span>، مش بتسمح بأي </span><code>traffic</code><span> يخش أو يخرج منها، عشان كده محتاجين نـ </span><code>create</code><span> ألـ </span><code>security group</code><span> جديد مخصوص للـ </span><code>ALB</code><span>. الـ </span><code>security group</code><span> ده لازم </span><strong><span>يسمع</span></strong><span> الـ </span><code>incoming requests</code><span> على </span><code>port 80</code><span> عشان تعرف تاكسس الـ </span><code>load balancer</code><span> عن طريق الـ </span><code>HTTP</code><span>، ولازم </span><strong><span>يسمع</span></strong><span> كمان الـ </span><code>outgoing requests</code><span> على كل الـ </span><code>ports</code><span> عشان الـ </span><code>load balancer</code><span> يقدر يعمل </span><code>health checks</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.026px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_security_group"</span> <span class="cm-string">"alb"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"terraform-example-alb"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># Allow inbound HTTP requests</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ingress</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">from_port</span> &nbsp; <span class="cm-operator">=</span> <span class="cm-number">80</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">to_port</span> &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-number">80</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">protocol</span> &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-string">"tcp"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">cidr_blocks</span> <span class="cm-operator">=</span> [<span class="cm-string">"0.0.0.0/0"</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># Allow all outbound requests</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">egress</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">from_port</span> &nbsp; <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">to_port</span> &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">protocol</span> &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-string">"-1"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">cidr_blocks</span> <span class="cm-operator">=</span> [<span class="cm-string">"0.0.0.0/0"</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 381px;"></div><div class="CodeMirror-gutters" style="display: none; height: 381px;"></div></div></div></pre><p><span>هتحتاج تقول للـ </span><code>aws_lb resource</code><span> إنه يستخدم الـ </span><code>security group</code><span> ده عن طريق الـ </span><code>security_groups argument</code><span>:</span></p><p><span>هترجع للـ </span><code>resource</code><span> بتاع الـ </span><code>aws_lb</code><span> اللي اسمه </span><code>example</code><span>، وهتضيف السطر ده:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_lb"</span> <span class="cm-string">"example"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">name</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"terraform-asg-example"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">load_balancer_type</span> <span class="cm-operator">=</span> <span class="cm-string">"application"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">subnets</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-variable">data</span><span class="cm-operator">.</span><span class="cm-property">aws_subnets</span><span class="cm-operator">.</span><span class="cm-property">default</span><span class="cm-operator">.</span><span class="cm-property">ids</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">security_groups</span> &nbsp; &nbsp;<span class="cm-operator">=</span> [<span class="cm-variable">aws_security_group</span><span class="cm-operator">.</span><span class="cm-property">alb</span><span class="cm-operator">.</span><span class="cm-property">id</span>] <span class="cm-comment"># السطر اللي ضفناه</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><p><span>الخطوة اللي بعدها، محتاج تـ </span><code>create</code><span> للـ </span><code>target group</code><span> للـ </span><code>ASG</code><span> بتاعك باستخدام الـ </span><code>aws_lb_target_group resource</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_lb_target_group"</span> <span class="cm-string">"asg"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">name</span> &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"terraform-asg-example"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">port</span> &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-variable">var</span><span class="cm-operator">.</span><span class="cm-property">server_port</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">protocol</span> <span class="cm-operator">=</span> <span class="cm-string">"HTTP"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">vpc_id</span> &nbsp; <span class="cm-operator">=</span> <span class="cm-variable">data</span><span class="cm-operator">.</span><span class="cm-property">aws_vpc</span><span class="cm-operator">.</span><span class="cm-property">default</span><span class="cm-operator">.</span><span class="cm-property">id</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">health_check</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">path</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-string">"/"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">protocol</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-string">"HTTP"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">matcher</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"200"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">interval</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-number">15</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">timeout</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">healthy_threshold</span> &nbsp; <span class="cm-operator">=</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">unhealthy_threshold</span> <span class="cm-operator">=</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 336px;"></div></div></div></pre><p>&nbsp;</p><p><span>الـ </span><code>target group</code><span> ده هيعمل </span><code>health check</code><span> للـ </span><code>Instances</code><span> بتاعتك عن طريق إنه هيبعت </span><code>HTTP request</code><span> كل شوية لكل </span><code>Instance</code><span>، وهيعتبر الـ </span><code>Instance</code><span> ده </span><code>healthy</code><span> بس لو الـ </span><code>Instance</code><span> رجّع </span><code>response</code><span> ماشي مع الـ </span><code>matcher</code><span> اللي إنت ظابطه (يعني مثلاً ممكن تظبط الـ </span><code>matcher</code><span> إنه يدور على </span><code>200 OK response</code><span>). لو الـ </span><code>Instance</code><span> مفشلش يرد، يمكن عشان الـ </span><code>Instance</code><span> ده وقع أو بقى عليه </span><code>load</code><span> كتير، ساعتها هياخد علامة </span><code>unhealthy</code><span>، والـ </span><code>target group</code><span> هيوقف أوتوماتيك إنه يبعتله </span><code>traffic</code><span> عشان يقلل أي مشاكل تحصل للي بيستخدموا الـ </span><code>website</code><span> بتاعك.</span></p><div class="md-alert md-alert-important important"><p><span class='md-alert-text md-alert-text-important'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</span><br></p><p><span>vpc_id   = data.aws_vpc.default.id </span>
<span>بيحدد انه تبع vpc ولكن مش بيحدد انما ملوش دعوة هو هيوجه requests فين</span></p></div><p><span>طب الـ </span><code>target group</code><span> ده هيعرف منين يبعت الـ </span><code>requests</code><span> لأنهي </span><code>EC2 Instances</code><span> بالظبط؟ ممكن تعمل </span><code>attach</code><span> لـ </span><code>static list</code><span> من الـ </span><code>EC2 Instances</code><span> للـ </span><code>target group</code><span> ده باستخدام الـ </span><code>aws_lb_target_group_attachment resource</code><span>، بس مع الـ </span><code>ASG</code><span>، الـ </span><code>Instances</code><span> ممكن تقوم أو تتقفل في أي وقت، فـ </span><code>static list</code><span> مش هينفع. بدل كده، ممكن تستفيد من الـ </span><code>integration</code><span> القوي جداً بين الـ </span><code>ASG</code><span> والـ </span><code>ALB</code><span>. ارجع للـ </span><code>aws_autoscaling_group resource</code><span>، وظبط الـ </span><code>argument</code><span> اللي اسمه </span><code>target_group_arns</code><span> عشان يشاور على الـ </span><code>target group</code><span> الجديد بتاعك:</span></p><div class="md-alert md-alert-note note"><p><span class='md-alert-text md-alert-text-note'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</span><br></p><p><span>ممكن تحط اكثر من target group عادي جدا</span></p></div><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.026px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_autoscaling_group"</span> <span class="cm-string">"example"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">launch_configuration</span> <span class="cm-operator">=</span> <span class="cm-variable">aws_launch_configuration</span><span class="cm-operator">.</span><span class="cm-property">example</span><span class="cm-operator">.</span><span class="cm-property">name</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">vpc_zone_identifier</span> &nbsp;<span class="cm-operator">=</span> <span class="cm-variable">data</span><span class="cm-operator">.</span><span class="cm-property">aws_subnets</span><span class="cm-operator">.</span><span class="cm-property">default</span><span class="cm-operator">.</span><span class="cm-property">ids</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">target_group_arns</span> &nbsp; &nbsp;<span class="cm-operator">=</span> [<span class="cm-variable">aws_lb_target_group</span><span class="cm-operator">.</span><span class="cm-property">asg</span><span class="cm-operator">.</span><span class="cm-property">arn</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">health_check_type</span> &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-string">"ELB"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">min_size</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">max_size</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-number">10</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">tag</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">key</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"Name"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">value</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"terraform-asg-example"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">propagate_at_launch</span> <span class="cm-operator">=</span> <span class="cm-keyword">true</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 291px;"></div><div class="CodeMirror-gutters" style="display: none; height: 291px;"></div></div></div></pre><p><span>لازم كمان تعمل </span><code>update</code><span> للـ </span><code>health_check_type</code><span> تخليه </span><code>&quot;ELB&quot;</code><span>. الـ </span><code>health_check_type</code><span> الـ </span><code>default</code><span> هو </span><code>&quot;EC2&quot;</code><span>، وده </span><code>health check</code><span> بسيط جداً بيعتبر الـ </span><code>Instance unhealthy</code><span>  بس لو الـ </span><code>AWS hypervisor</code><span> قال إن الـ </span><code>VM</code><span> وقع خالص أو مش واصل. الـ </span><code>health check</code><span> بتاع الـ </span><code>&quot;ELB&quot;</code><span> أقوى، لأنه بيدي تعليمات للـ </span><code>ASG</code><span> إنه يستخدم الـ </span><code>health check</code><span> بتاع الـ </span><code>target group</code><span> عشان يعرف الـ </span><code>Instance</code><span> ده </span><code>healthy</code><span> ولا لأ، ويبدل الـ </span><code>Instances</code><span> أوتوماتيك لو الـ </span><code>target group</code><span> قال إنهم </span><code>unhealthy</code><span>. كده الـ </span><code>Instances</code><span> هتتبدل مش بس لو وقعت خالص، كمان لو بطلت ترد على الـ </span><code>requests</code><span> مثلاً عشان الـ </span><code>memory</code><span> خلصت فيها أو </span><code>process</code><span> مهم وقع.</span></p><p><span>أخيراً، جه وقت إننا نربط كل الحاجات دي ببعضها عن طريق إننا نـ </span><code>create</code><span> لـ </span><code>listener rules</code><span> باستخدام الـ </span><code>aws_lb_listener_rule resource</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_lb_listener_rule"</span> <span class="cm-string">"asg"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">listener_arn</span> <span class="cm-operator">=</span> <span class="cm-variable">aws_lb_listener</span><span class="cm-operator">.</span><span class="cm-property">http</span><span class="cm-operator">.</span><span class="cm-property">arn</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">priority</span> &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-number">100</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">condition</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">path_pattern</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">values</span> <span class="cm-operator">=</span> [<span class="cm-string">"*"</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">action</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">type</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"forward"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">target_group_arn</span> <span class="cm-operator">=</span> <span class="cm-variable">aws_lb_target_group</span><span class="cm-operator">.</span><span class="cm-property">asg</span><span class="cm-operator">.</span><span class="cm-property">arn</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 291px;"></div><div class="CodeMirror-gutters" style="display: none; height: 291px;"></div></div></div></pre><p><span>الـ </span><code>code</code><span> اللي فوق ده بيضيف </span><code>listener rule</code><span> بيبعت الـ </span><code>requests</code><span> اللي ماشية مع أي </span><code>path</code><span> للـ </span><code>target group</code><span> اللي فيه الـ </span><code>ASG</code><span> بتاعك.</span></p><p><span>في آخر حاجة محتاج تعملها قبل ما تعمل </span><code>deploy</code><span> للـ </span><code>load balancer</code><span>—هتبدل الـ </span><code>output</code><span> القديم بتاع الـ </span><code>public_ip</code><span> بتاع الـ </span><code>EC2 Instance</code><span> الواحد اللي كان عندك قبل كده بـ </span><code>output</code><span> بيطلع الـ </span><code>DNS name</code><span> بتاع الـ </span><code>ALB</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">output</span> <span class="cm-string">"alb_dns_name"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">value</span> &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-variable">aws_lb</span><span class="cm-operator">.</span><span class="cm-property">example</span><span class="cm-operator">.</span><span class="cm-property">dns_name</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">description</span> <span class="cm-operator">=</span> <span class="cm-string">"The domain name of the load balancer"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>اعمل </span><code>run</code><span> لـ </span><code>terraform apply</code><span>، واقرأ الـ </span><code>plan output</code><span>. هتلاقي إن الـ </span><code>EC2 Instance</code><span> الواحد بتاعك الأصلي بيتمسح، وبداله، </span><code>Terraform</code><span> هيكريتلك </span><code>launch configuration</code><span> و </span><code>ASG</code><span> و </span><code>ALB</code><span> و </span><code>security group</code><span>. لو الـ </span><code>plan</code><span> شكله تمام، اكتب </span><code>yes</code><span> وادوس </span><code>Enter</code><span>. لما الـ </span><code>apply</code><span> يخلص، المفروض تشوف الـ </span><code>alb_dns_name output</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Outputs:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">alb_dns_name = "terraform-asg-example-123.us-east-2.elb.amazonaws.com"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>خد الـ </span><code>URL</code><span> ده كوبي. هياخد كام دقيقة كده لحد ما الـ </span><code>Instances</code><span> تقوم وتظهر </span><code>healthy</code><span> في الـ </span><code>ALB</code><span>. في الوقت ده، ممكن تشوف إيه اللي إنت عملتله </span><code>deploy</code><span>. افتح الـ </span><code>ASG section</code><span> في الـ </span><code>EC2 console</code><span>، وهتلاقي إن الـ </span><code>ASG</code><span> اتعمل، زي ما باين في </span><code>Figure 2-12</code><span>.</span></p><p>&nbsp;</p><p><span>متنساش تعمل destroy</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">terraform destroy</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><hr /><div class="md-alert md-alert-tip tip"><p><span class='md-alert-text md-alert-text-tip'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</span><br></p><blockquote><p><span>**إيه هي </span><code>-auto-approve</code><span>؟ </span></p></blockquote><p><span>لما بتشغل أمر </span><code>terraform apply</code><span> في العادي، </span><code>Terraform</code><span> بيعمل إيه؟</span></p><p><strong><span>بيحسب  </span><code>Plan</code><span>:</span></strong><span> بيشوف إيه اللي هيتعمل، أو هيتعدل، أو هيتمسح.</span></p><p><strong><span>يعرض عليك Plan:</span></strong><span> بيوريك كل التغييرات اللي ناوي يعملها بالتفصيل.</span></p><p><strong><span>بيسألك :</span></strong></p><blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.63019px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Do you want to perform these actions?</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Terraform will perform the actions described above.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Only 'yes' will be accepted to approve.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Enter a value:</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre></blockquote><p>&nbsp;</p><p><code>Terraform</code><span> بيوقف كل حاجة وبيستناك أنت بنفسك تكتب كلمة </span><code>yes</code><span> وتدوس </span><code>Enter</code><span> عشان يتأكد إنك موافق على الـPlane دي.</span></p><p><strong><span>ليه بيعمل كده؟</span></strong>
<span>دي خطوة أمان مهمة جدًا عشان متعملش </span><code>apply</code><span> لتغيير خطير بالصدفة. هو بيجبرك تراجع الـPlane بعينك وتدي موافقة صريحة.</span></p><p><strong><span>طب إيه المشكلة؟</span></strong></p><p><span>الطريقة دي ممتازة لما تكون أنت اللي بتشغل الأمر بإيدك من على جهازك. لكن تخيل إن </span><code>Terraform</code><span> بيشتغل في سيناريو مؤتمت بالكامل، زي:</span></p><ul><li><p><strong><code>CI/CD pipeline</code><span> (زي </span><code>Jenkins</code><span>, </span><code>GitLab CI</code><span>, </span><code>GitHub Actions</code><span>):</span></strong><span> الـ </span><code>pipeline</code><span> ده عبارة عن </span><code>server</code><span> بيشغل الأوامر لوحده لما بتعمل </span><code>push</code><span> للكود. مفيش بني آدم قاعد قدام الشاشة عشان يكتب </span><code>yes</code><span>!</span></p></li><li><p><strong><code>Script</code><span> :</span></strong><span> أنت عامل </span><code>bash script</code><span> بيعمل </span><code>deploy</code><span> لمجموعة حاجات ورا بعض.</span></p></li></ul><p><span>في الحالات دي، الـ </span><code>pipeline</code><span> أو الـ </span><code>script</code><span> هيشتغل، وهيوصل لمرحلة سؤال </span><code>yes</code><span>، وهيفضل واقف ومستني رد... إلى الأبد. والعملية كلها هتفشل بسبب </span><code>timeout</code><span>.</span></p><p><strong><span>الحل: </span><code>-auto-approve</code></strong></p><p><span>الـ </span><code>flag</code><span> اللي اسمه </span><code>-auto-approve</code><span> هو ببساطة طريقة تقول بيها لـ </span><code>Terraform</code><span>:</span></p><p><strong><span>&quot;اسمع، أنا واثق في الـPlane اللي هتطلع. نفذها على طول من غير ما تسألني.&quot;</span></strong></p><p><span>لما بتشغل الأمر بالشكل ده:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.63019px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">terraform apply <span class="cm-attribute">-auto-approve</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><code>Terraform</code><span> هيعمل نفس الخطوات، بس هيتخطى خطوة السؤال:</span></p><ol start='' ><li><p><strong><span>بيحسب  </span><code>Plan</code><span>.</span></strong></p></li><li><p><strong><span>يعرض عليك الـPlan  (في الـ </span><code>log</code><span> بتاع الـ </span><code>pipeline</code><span>).</span></strong></p></li><li><p><strong><span>ينفذها فورًا</span></strong><span> كأنه فيه حد كتبله </span><code>yes</code><span> أوتوماتيك.</span></p></li></ol><p><strong><span>تحذير مهم جدًا</span></strong></p><ul><li><p><strong><span>لا تستخدم </span><code>-auto-approve</code><span> أبدًا وأنت شغال على جهازك </span></strong><span> (إلا لو عارف 100% أنت بتعمل إيه). دي ممكن تسبب كوارث لو أنت مش مراجع الـ </span><code>plan</code><span> كويس. ممكن تمسح </span><code>production database</code><span> بالغلط!</span></p></li><li><p><strong><span>استخدمها فقط في البيئات اللي حصل له automation</span></strong><span> اللي فيها خطوات </span><code>review</code><span> و </span><code>approval</code><span> قبل ما الـ </span><code>pipeline</code><span> يوصل لمرحلة الـ </span><code>apply</code><span>. الـ </span><code>best practice</code><span> في الـ </span><code>CI/CD</code><span> هو إن الـ </span><code>pipeline</code><span> يعمل </span><code>terraform plan</code><span> الأول، ويعرض الـPlane دي على حد من الفريق عشان يعملها </span><code>approve</code><span> (مثلًا عن طريق </span><code>pull request review</code><span>)، وبعد ما الـ </span><code>approval</code><span> يتم، الـ </span><code>pipeline</code><span> يكمل ويشغل </span><code>terraform apply -auto-approve</code><span>.</span></p></li></ul><p>&nbsp;</p></div><p>&nbsp;</p><p>&nbsp;</p><div class="md-alert md-alert-important important"><p><span class='md-alert-text md-alert-text-important'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</span><br></p><p><strong><span>أمر </span><code>plan</code><span> مش مجرد &quot;بروفة&quot;... ده &quot;عقد اتفاق&quot;!</span></strong></p><p><span>إحنا اتعاملنا مع أمر </span><code>terraform plan</code><span> على إنه طريقة سريعة نشوف بيها تيرافورم هيعمل إيه. بس في الشغل الحقيقي، الأمر ده أهميته أكبر من كده بكتير. فكر فيه كأنه </span><strong><span>official contract</span></strong><span> بينك وبين تيرافورم.</span></p><p><strong><span>إزاي تحول البروفة لـ official contract؟</span></strong></p><p><span>أنت ممكن تحفظ الـ </span><code>plan</code><span> دي في ملف، وبعدين تقول لـ </span><code>Terraform</code><span> ينفذ الملف ده بالحرف، من غير ما يفكر تاني.</span></p><ol start='' ><li><p><strong><span>الخطوة الأولى: اعمل خطة واحفظها</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 16.0417px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">terraform plan <span class="cm-attribute">-out</span><span class="cm-operator">=</span><span class="cm-string">"my-plan-file"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>الأمر ده بيعمل كل حاجة زي </span><code>plan</code><span> العادي، بس بدل ما يعرض النتيجة على الشاشة بس، بيحفظها في ملف اسمه </span><code>my-plan-file</code><span>. الملف ده متشفّر ومينفعش تعدله، وهو بيحتوي على كل التغييرات اللي تيرافورم قرر يعملها بالظبط.</span></p></li><li><p><strong><span>الخطوة الثانية: نفذ العقد</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.026px; left: 16.0417px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">terraform apply <span class="cm-string">"my-plan-file"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>لما بتشغل </span><code>apply</code><span> وتديله اسم الملف، تيرافورم مش بيعمل </span><code>plan</code><span> من جديد. هو بيفتح &quot;contract&quot; اللي اتفقتوا عليه، وينفذه زي ما هو بالمللي، ومش هيسألك حتى تكتب </span><code>yes</code><span> لأنه بيعتبر إنك وافقت خلاص لما حفظت الخطة.</span></p></li></ol><p><strong><span>طب إيه فايدة اللفة دي؟</span></strong></p><p><span>دي أساس الشغل في الفرق الكبيرة والـ </span><code>automation pipelines</code><span>!</span></p><ul><li><p><strong><span>ضمان الثبات (Consistency):</span></strong><span> تخيل إنك عملت </span><code>plan</code><span> الساعة 9 الصبح، والدنيا كانت تمام. بس مجتش فرصة تعمل </span><code>apply</code><span> إلا الساعة 11. في الساعتين دول، ممكن يكون زميلك غير حاجة في الـ </span><code>infrastructure</code><span> من غير ما تعرف. لو شغلت </span><code>apply</code><span> عادي، النتيجة اللي هتطلع هتكون مختلفة عن الـ </span><code>plan</code><span> اللي شفتها الصبح. لكن لو كنت حافظ الـ </span><code>plan</code><span> في ملف، </span><code>Terraform</code><span> هينفذ plan  الأصلية، ولو لقى إن الواقع اتغير، هيديك </span><code>error</code><span> ويقولك &quot;استنى، contract ده مبقاش ينفع، الواقع اتغير! او state القديمة اللي كان مبني عليها اتغيرت&quot;.</span></p></li><li><p><strong><span>الـ </span><code>Code Review</code><span>:</span></strong><span> في الشغل، الممارسة السليمة هي إنك لما تعمل تغيير، الـ </span><code>CI/CD pipeline</code><span> بتاعك بيشغل </span><code>terraform plan -out=&quot;plan.file&quot;</code><span> أوتوماتيك، وبعدين يعرض عليك محتوى الخطة دي عشان تراجعها أنت وفريقك. لو كله تمام ووافقتوا عليها، الـ </span><code>pipeline</code><span> بيكمل وينفذ نفس الملف ده بأمر </span><code>terraform apply &quot;plan.file&quot;</code><span>. كده أنتم كلكم بتبقوا متأكدين 100% إن اللي اتنفذ هو هو بالظبط اللي اتراجِع واتوافق عليه.</span></p></li></ul></div><hr /><p><span>### </span></p><div class="md-alert md-alert-tip tip"><p><span class='md-alert-text md-alert-text-tip'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</span><br></p><p><strong><span>خلي الكود بتاعك نضيف ومنظم (لسه هنكلم فيها بالتفصيل)</span></strong></p><p><span>لحد دلوقتي، إحنا بنكتب كل حاجة في ملف </span><code>main.tf</code><span> واحد. وده شغال وزي الفل في الأمثلة الصغيرة. لكن لما المشروع يكبر، الملف ده هيبقى زحمة جدًا وصعب تقراه.</span></p><p><code>Terraform</code><span> ذكي كفاية إنه بيقرأ كل ملفات الـ </span><code>.tf</code><span> اللي في نفس الفولدر كأنهم ملف واحد كبير. فإحنا ممكن نستغل الميزة دي ونقسم الكود بتاعنا على كذا ملف عشان يبقى أنضف وأسهل في الصيانة.</span></p><p><strong><span>دي تقسيمة كويسة تبدأ بيها:</span></strong></p><ul><li><p><code>main.tf</code><span>: خليه للـ </span><code>resources</code><span> الأساسية بتاعتك (زي الـ </span><code>EC2 instances</code><span>, </span><code>ASG</code><span>, </span><code>Load Balancer</code><span>). ده قلب المشروع.</span></p></li><li><p><code>variables.tf</code><span>: حط فيه كل الـ </span><code>input variables</code><span> بتاعتك. أي حاجة بتبدأ بـ </span><code>variable &quot;...&quot;</code><span> مكانها هنا.</span></p></li><li><p><code>outputs.tf</code><span>: حط فيه كل الـ </span><code>output variables</code><span> بتاعتك. أي حاجة بتبدأ بـ </span><code>output &quot;...&quot;</code><span> مكانها هنا.</span></p></li><li><p><code>providers.tf</code><span>: حط فيه الـ </span><code>provider configuration</code><span> (زي بلوك </span><code>provider &quot;aws&quot; { ... }</code><span>).</span></p></li><li><p><code>data.tf</code><span>: حط فيه أي </span><code>data sources</code><span> بتستخدمها (زي </span><code>data &quot;aws_vpc&quot; ...</code><span>).</span></p></li></ul><p><span>لما تعمل كده، أي حد جديد هيدخل على المشروع هيفهم على طول يروح يبص فين لو عايز يعرف إيه هي المتغيرات المتاحة أو إيه هي المخرجات اللي الكود بيطلعها. ده بيخلي حياتك وحياة فريقك أسهل بكتير.</span></p></div><p><span>#### </span></p><div class="md-alert md-alert-note note"><p><span class='md-alert-text md-alert-text-note'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</span><br></p><p><strong><span>متتخضش لما تشوف كلام أحمر!</span></strong></p><p><span>مفيش مهندس في الدنيا الكود بتاعه بيشتغل من أول مرة. طبيعي جدًا إنك تغلط وتشوف </span><code>error</code><span> لونه أحمر بيملى الشاشة. الأهم من إنك متغلطش، هو إنك تعرف تصلح الغلط إزاي.</span></p><p><strong><span>لما تيرافورم يزعقلك، اعمل الخطوات دي بالترتيب:</span></strong></p><ol start='' ><li><p><strong><span>خد نفس عميق واقرأ الـ </span><code>Error</code><span>:</span></strong><span> </span><code>Terraform</code><span> في معظم الوقت بيقولك المشكلة فين بالظبط. بص على الرسالة كويس، هتلاقيه كاتبلك:</span></p><ul><li><p><span>اسم الملف ورقم السطر اللي فيه المشكلة.</span></p></li><li><p><span>شرح للغلطة (مثلًا: &quot;اسم الـ </span><code>argument</code><span> ده غلط&quot;، أو &quot;القيمة دي مش </span><code>string</code><span>&quot;).</span></p></li><li><p><span>اقرأ الرسالة من تحت لفوق، غالبًا أصل المشكلة بيكون في آخر كام سطر.</span></p></li></ul></li><li><p><strong><span>استخدم أمر </span><code>validate</code><span>:</span></strong><span> قبل ما تعمل </span><code>plan</code><span> أو </span><code>apply</code><span>، ممكن تشغل الأمر ده:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.63022px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">terraform validate</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>الأمر ده مش بيعمل أي حاجة على </span><code>AWS</code><span>، هو بس بيبص على الكود بتاعك ويتأكد إن مفيش أخطاء إملائية أو مشاكل في الـ </span><code>syntax</code><span>. ده زي </span><code>spell checker</code><span> للكود بتاعك.</span></p></li><li><p><strong><span>ارجع للـ </span><code>Documentation</code><span> (صاحبك الصدوق):</span></strong><span> زي ما الكاتب قال، الـ </span><code>docs</code><span> هي أهم أداة عندك. لو الـ </span><code>error</code><span> بيقولك إن فيه مشكلة في </span><code>resource</code><span> اسمه </span><code>aws_lb_target_group</code><span>، روح على جوجل واكتب &quot;terraform aws_lb_target_group&quot;. أول نتيجة هتكون الصفحة الرسمية بتاعته. قارن الكود بتاعك بالمثال اللي في الصفحة، غالبًا هتلاقي إنك ناسي </span><code>argument</code><span> مهم أو كاتبه غلط.</span></p></li></ol><p><span>الغلطات جزء من عملية التعلم. كل </span><code>error</code><span> بتصلحه، بيخليك تفهم </span><code>Terraform</code><span> أكتر.</span></p></div><p><span>#### </span></p><p>&nbsp;</p><hr /><blockquote><p>&nbsp;</p><div class="md-alert md-alert-tip tip"><p><span class='md-alert-text md-alert-text-tip'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</span><br></p></div><p><strong><span>تيرافورم عنده </span><code>Template Engine</code><span> داخلي بيخلي الكود بتاعك برنس!</span></strong></p><p><span>خلينا نرجع بالزمن شوية للـ </span><code>User Data script</code><span> بتاعنا. كان شكله كده:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">user_data</span> <span class="cm-operator">=</span> <span class="cm-string">&lt;&lt;-EOF</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #!/bin/bash</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo "Hello, World" &gt; index.xhtml</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nohup busybox httpd -f -p ${var.server_port} &amp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EOF</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre><p><span>ده جميل وبسيط. بس في الشغل الحقيقي، الـ </span><code>script</code><span> بتاعك مش هيبقى سطرين. تخيل إنك محتاج تعمل سيرفر بيعمل الحاجات دي أول ما يقوم:</span></p><ol start='' ><li><p><span>يعمل </span><code>update</code><span> للـ </span><code>packages</code><span> بتاعته.</span></p></li><li><p><span>يسطب </span><code>Nginx</code><span> (ويب سيرفر حقيقي).</span></p></li><li><p><span>يسطب </span><code>Git</code><span>.</span></p></li><li><p><span>يعمل </span><code>clone</code><span> للكود بتاع الأبليكيشن بتاعك من </span><code>GitHub</code><span>.</span></p></li><li><p><span>يكتب ملف </span><code>configuration</code><span> مخصوص للأبليكيشن ده، والملف ده محتاج يعرف عنوان الـ </span><code>database</code><span> اللي هيتكلم معاها.</span></p></li></ol><p><span>لو جينا نكتب ده جوه ملف الـ </span><code>.tf</code><span>، هيبقى شكله كارثي كده:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.026px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># !! مثال للكود الوحش اللي مش عايزين نكتبه !!</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">user_data</span> <span class="cm-operator">=</span> <span class="cm-string">&lt;&lt;-EOF</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  #!/bin/bash</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  # Update and install dependencies</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  apt-get update -y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  apt-get install -y nginx git</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  # Clone the application code</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  git clone https://github.com/my-company/my-awesome-app.git /var/www/html</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  # Create a config file for the app</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  echo "DATABASE_HOST=${var.db_address}" &gt; /var/www/html/config.env</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  echo "DATABASE_PORT=${var.db_port}" &gt;&gt; /var/www/html/config.env</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  # Restart Nginx to apply changes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  systemctl restart nginx</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  EOF</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 448px;"></div><div class="CodeMirror-gutters" style="display: none; height: 448px;"></div></div></div></pre><p><strong><span>إيه المشاكل اللي هنا؟</span></strong></p><ul><li><p><strong><span>قراية الكود بقت صعبة جدًا:</span></strong><span> ملف الـ </span><code>Terraform</code><span> بتاعك بقى عبارة عن كوكتيل من لغتين: </span><code>HCL</code><span> و </span><code>Bash</code><span>.</span></p></li><li><p><strong><span>مفيش </span><code>Syntax Highlighting</code><span>:</span></strong><span> الـ </span><code>text editor</code><span> بتاعك هيتلخبط، ومش هيعرف يلونلك كود الـ </span><code>Bash</code><span> صح، وده بيصعّب اكتشاف الأخطاء.</span></p></li><li><p><strong><span>إعادة الاستخدام مستحيلة:</span></strong><span> لو عايز تستخدم نفس الـ </span><code>script</code><span> ده في حتة تانية، لازم تعمل </span><code>copy-paste</code><span> للكود ده كله.</span></p></li></ul><p><span>باختصار، أنت كده بتخلط &quot;إيه هي البنية التحتية&quot; (كود تيرافورم) مع &quot;إزاي أجهز السيرفر&quot; (كود الباش)، وده بيعمل فوضى.</span></p><h3 id='الحل-افصل-العالمين'><strong><span>الحل: افصل العالمين!</span></strong></h3><p><code>Terraform</code><span> بيديلك حل عبقري: خلي كل لغة في ملفها الخاص والمحترم. خلي كود </span><code>Terraform</code><span> في ملفات </span><code>.tf</code><span>، وخلي كود </span><code>Bash</code><span> في ملف </span><code>.sh</code><span>.</span></p><p><span>إزاي هنعمل كده؟ عن طريق استخدام  </span><code>function</code><span> اسمها </span><code>templatefile</code><span>. الدالة دي بتشغل </span><strong><code>Template Engine</code></strong><span> داخلي، وظيفته إنه يقرأ ملف، ويدور على أي متغيرات جواه، ويبدلها بالقيم اللي أنت بتديها لها.</span></p><p><strong><span>الخطوات بسيطة:</span></strong></p><p><strong><span>1. اعمل ملف الـ &quot;Template&quot; بتاعك:</span></strong>
<span>اعمل ملف جديد اسمه </span><code>setup-webserver.sh</code><span>. الملف ده هيبقى فيه كود الـ </span><code>Bash</code><span> بتاعك نضيف وواضح.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.026px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#!/bin/bash</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apt-get update <span class="cm-attribute">-y</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apt-get install <span class="cm-attribute">-y</span> nginx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># هنا بنعمل placeholder اسمه "greeting_message"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">echo</span> <span class="cm-string">"&lt;h1&gt;</span><span class="cm-def">${greeting_message}</span><span class="cm-string">&lt;/h1&gt;"</span> &gt; /var/www/html/index.html</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">systemctl <span class="cm-builtin">restart</span> nginx</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 179px;"></div><div class="CodeMirror-gutters" style="display: none; height: 179px;"></div></div></div></pre><p><span>لاحظ المتغير </span><code>&quot;${greeting_message}&quot;</code><span>. ده مش كود تيرافورم، ده مجرد </span><strong><span>&quot;مكان محجوز&quot;</span></strong><span> أو </span><code>placeholder</code><span> جوه الـ </span><code>template</code><span> بتاعنا.</span></p><p><strong><span>2. في ملف </span><code>main.tf</code><span>، استدعي الـ </span><code>template</code><span> ده:</span></strong>
<span>بدل كل الزحمة اللي فاتت، الـ </span><code>user_data</code><span> بتاعك هيبقى سطر واحد شيك جدًا:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="terraform"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="terraform"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.0221px; left: 7.6302px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">resource</span> <span class="cm-string">"aws_instance"</span> <span class="cm-string">"web_server"</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ami</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-string">"ami-..."</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">instance_type</span> <span class="cm-operator">=</span> <span class="cm-string">"t2.micro"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">user_data</span> <span class="cm-operator">=</span> <span class="cm-variable">templatefile</span>(<span class="cm-string">"${path.module}/setup-webserver.sh"</span>, {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">greeting_message</span> <span class="cm-operator">=</span> <span class="cm-string">"Hello from our smart template!"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  })</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 202px;"></div><div class="CodeMirror-gutters" style="display: none; height: 202px;"></div></div></div></pre><p><span>هتشوف لسه قصة path.module دي الفصل اللي بعد الجي بس لو ضروري دلوقتي وانت مش بتستخدم module فى دي directory اللي فيه عليها main.tf</span></p><p><strong><span>شفت إيه اللي حصل؟</span></strong></p><ul><li><p><code>templatefile(...)</code><span> هي الدالة  اللي بتشغل الـ </span><code>Template Engine</code><span>.</span></p></li><li><p><span>الجزء الأول </span><code>(&quot;${path.module}/setup-webserver.sh&quot;)</code><span> بيحدد مكان ملف الـ </span><code>template</code><span>.</span></p></li><li><p><span>الجزء التاني </span><code>({ ... })</code><span> هو الـ </span><code>map</code><span> اللي فيه عملية التبديل. السطر </span><code>greeting_message = &quot;...&quot;</code><span> معناه: &quot;روح جوه الـ </span><code>template</code><span>، دور على أي حاجة اسمها </span><code>${greeting_message}</code><span>، وشيلها وحط مكانها الجملة دي&quot;.</span></p></li></ul><p><strong><span>ليه دي طريقة أحسن بمليون مرة؟</span></strong></p><ol start='' ><li><p><strong><span>النظافة والتنظيم:</span></strong><span> الكود بقى مقروء. ملفات الـ </span><code>Terraform</code><span> بتتكلم </span><code>Terraform</code><span>، وملفات الـ </span><code>Bash</code><span> بتتكلم </span><code>Bash</code><span>.</span></p></li><li><p><strong><span>الصيانة:</span></strong><span> لو عايز تعدل في الـ </span><code>script</code><span>، هتروح تعدل في ملف </span><code>.sh</code><span> واحد بس.</span></p></li><li><p><strong><span>إعادة الاستخدام:</span></strong><span> تقدر تستخدم نفس ملف </span><code>setup-webserver.sh</code><span> في 10 أماكن مختلفة، وكل مرة تبعتله </span><code>greeting_message</code><span> مختلفة، وهو هيشتغل زي الفل.</span></p></li><li><p><strong><span>التعاون:</span></strong><span> ممكن تدي ملف الـ </span><code>.sh</code><span> لواحد متخصص في الـ </span><code>Linux</code><span> والـ </span><code>scripting</code><span> عشان يظبطهولك، وهو مش محتاج يفهم أي حاجة عن </span><code>Terraform</code><span>.</span></p></li></ol><p><span>استخدام الـ </span><code>Template Engine</code><span> بينقل كودك من مجرد أوامر ثابتة، لكود ديناميكي وذكي و reusable. دي واحدة من أهم المهارات اللي هتفرق معاك جدًا وأنت بتبني </span><code>infrastructure</code><span> معقدة.</span></p><p><span>فى function اسمها file ولكن دي بتنقل بس مش بتعمل اكثر من كده </span></p></blockquote><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><div class="md-alert md-alert-caution caution"><p><span class='md-alert-text md-alert-text-caution'><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Caution</span><br></p><p><strong><span>متنساش تطفي النور وأنت خارج!</span></strong></p><p><span>الـ </span><code>AWS Free Tier</code><span> عظيمة، بس ليها حدود. والأمثلة دي لو سبتها شغالة أيام، ممكن تبدأ تسحب من فلوسك الحقيقية. عشان كده، لازم تتعود على عادة مهمة جدًا:</span></p><p><strong><span>لما تخلص تجربة، دمر كل حاجة!</span></strong></p><p><span>الأمر ده هو صديق محفظتك:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 17.026px; left: 7.63019px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">terraform destroy</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>الأمر ده هيمسح كل الـ </span><code>resources</code><span> اللي </span><code>Terraform</code><span> عملها في المشروع ده. شغله دايمًا بعد ما تخلص مذاكرة أو تجربة عشان تضمن إن مفيش فواتير مفاجئة هتجيلك آخر الشهر.</span></p><p><strong><span>نصيحة للمحترفين:</span></strong><span> روح على الـ </span><code>AWS Console</code><span>، وابحث عن خدمة اسمها </span><code>Billing</code><span>، ومن هناك تقدر تعمل حاجة اسمها </span><strong><code>Billing Alarm</code></strong><span>. ده منبه تقدر تظبطه إنه يبعتلك إيميل لو فاتورتك عدت مبلغ معين (مثلًا 5 دولار). دي شبكة أمان ممتازة عشان تحمي نفسك من أي تكاليف مش متوقعة.</span></p></div></div></div>

<link href="https://fonts.googleapis.com/css2?family=Vazirmatn&display=swap" rel="stylesheet">

<style>
    /* تطبيق الخط على كل الصفحة */
    body {
        font-family: "Vazirmatn", sans-serif;
        font-optical-sizing: auto;
        font-weight: 400;
        font-style: normal;
    }
    h1 h2 h3 h4 h5 h6 {
        font-family: "Vazirmatn", sans-serif;
        font-optical-sizing: auto;
        font-weight: 400;
        font-style: normal;
    }
    </style>

</body>
</html>